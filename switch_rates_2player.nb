(* Content-type: application/mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 7.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       145,          7]
NotebookDataLength[    344172,       9595]
NotebookOptionsPosition[    328860,       9162]
NotebookOutlinePosition[    329298,       9179]
CellTagsIndexPosition[    329255,       9176]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Evolving Environmental Change - 2 individuals/patch", "Title",
 CellChangeTimes->{{3.68283925649305*^9, 3.682839275163673*^9}}],

Cell[CellGroupData[{

Cell["Basic functions", "Section",
 CellChangeTimes->{{3.685193445396308*^9, 3.6851934471079817`*^9}, {
  3.68519440129674*^9, 3.685194401847404*^9}}],

Cell[BoxData[
 RowBox[{"Clear", "[", "\"\<Global`*\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.682840018157737*^9, 3.682840024116688*^9}}],

Cell["\<\
Survival dependent on the switch rate modulation factor. Maximum survival \
(continous time mortality rate = 1) when zs=0, otherwise mortality > 1.\
\>", "Text",
 CellChangeTimes->{{3.685194414430983*^9, 3.6851944637739887`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"nu", "[", "zs_", "]"}], ":=", 
  RowBox[{"1", "+", 
   RowBox[{"k", " ", 
    SuperscriptBox["zs", "2"]}]}]}]], "Input",
 CellChangeTimes->{{3.6851069335929203`*^9, 3.685106959273797*^9}, {
  3.685192127968128*^9, 3.685192128706066*^9}, {3.685192408972494*^9, 
  3.685192411226541*^9}, {3.685192450467156*^9, 3.6851924877054367`*^9}, {
  3.685192519607628*^9, 3.685192520288231*^9}, {3.685192561967499*^9, 
  3.6851926076533413`*^9}}],

Cell[TextData[{
 "Function to export ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 " to C and string:"
}], "Text",
 CellChangeTimes->{{3.685194596178875*^9, 3.685194618402176*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"tc", "[", "x_", "]"}], ":=", 
  RowBox[{"ToString", "[", 
   RowBox[{"CForm", "[", "x", "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.685194583927676*^9, 3.685194593421216*^9}, {
  3.685195371913392*^9, 3.6851953740144253`*^9}}],

Cell["Directory for exports from C", "Text",
 CellChangeTimes->{{3.685203539576831*^9, 3.6852035474156237`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"cdir", "=", 
   RowBox[{
   "$HomeDirectory", "<>", 
    "\"\</Projects/switch_rates/src/numerical/2player/\>\""}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.685203598214878*^9, 3.6852036640129433`*^9}}],

Cell["Substitution list", "Text",
 CellChangeTimes->{{3.685204081176705*^9, 3.6852040883981543`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"subslist", "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"1", ",", "m"}], "]"}], "\[Rule]", 
     RowBox[{"zs", "[", "1", "]"}]}], ",", 
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"1", ",", "a"}], "]"}], "\[Rule]", 
     RowBox[{"zs", "[", "1", "]"}]}], ",", 
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"2", ",", "m"}], "]"}], "\[Rule]", 
     RowBox[{"zs", "[", "2", "]"}]}], ",", 
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"2", ",", "a"}], "]"}], "\[Rule]", 
     RowBox[{"zs", "[", "2", "]"}]}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.685204075096592*^9, 3.685204116313858*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"zs", "[", 
     RowBox[{"1", ",", "m"}], "]"}], "\[Rule]", 
    RowBox[{"zs", "[", "1", "]"}]}], ",", 
   RowBox[{
    RowBox[{"zs", "[", 
     RowBox[{"1", ",", "a"}], "]"}], "\[Rule]", 
    RowBox[{"zs", "[", "1", "]"}]}], ",", 
   RowBox[{
    RowBox[{"zs", "[", 
     RowBox[{"2", ",", "m"}], "]"}], "\[Rule]", 
    RowBox[{"zs", "[", "2", "]"}]}], ",", 
   RowBox[{
    RowBox[{"zs", "[", 
     RowBox[{"2", ",", "a"}], "]"}], "\[Rule]", 
    RowBox[{"zs", "[", "2", "]"}]}]}], "}"}]], "Output",
 CellChangeTimes->{3.685204116791028*^9, 3.685205503477003*^9}]
}, Open  ]],

Cell["\<\
Export system of equations to C code\
\>", "Text",
 CellChangeTimes->{{3.685212481064468*^9, 3.685212494054912*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"recur2c", "[", 
   RowBox[{
   "lhs_", ",", "rhs_", ",", "variables_", ",", "bound_", ",", 
    "convergence_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "str", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"str", "=", "\"\<\>\""}], ";", "\[IndentingNewLine]", 
     RowBox[{"Assert", "[", 
      RowBox[{
       RowBox[{"Length", "[", "lhs", "]"}], "\[Equal]", 
       RowBox[{"Length", "[", "rhs", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Assert", "[", 
      RowBox[{
       RowBox[{"Length", "[", "lhs", "]"}], "\[Equal]", 
       RowBox[{"Length", "[", "variables", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"first", " ", "declare", " ", "rhs"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"iter", "=", "1"}], ",", 
       RowBox[{"iter", "\[LessEqual]", 
        RowBox[{"Length", "[", "lhs", "]"}]}], ",", 
       RowBox[{"iter", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"str", "=", 
         RowBox[{"str", "<>", "\"\<double \>\"", "<>", 
          RowBox[{"tc", "[", 
           RowBox[{"lhs", "[", 
            RowBox[{"[", "iter", "]"}], "]"}], "]"}], "<>", 
          "\"\<;\\n\\n\>\""}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"then", " ", "iterate"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"str", "=", 
      RowBox[{
      "str", "<>", 
       "\"\<for(int iter = 0; iter < 1e08; ++iter) {\\n\\n\>\""}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"iter", "=", "1"}], ",", 
       RowBox[{"iter", "\[LessEqual]", 
        RowBox[{"Length", "[", "rhs", "]"}]}], ",", 
       RowBox[{"iter", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"str", "=", 
         RowBox[{"str", "<>", 
          RowBox[{"tc", "[", 
           RowBox[{"lhs", "[", 
            RowBox[{"[", "iter", "]"}], "]"}], "]"}], "<>", "\"\< = \>\"", "<>", 
          RowBox[{"tc", "[", "bound", "]"}], "<>", "\"\<(\>\"", "<>", 
          RowBox[{"tc", "[", 
           RowBox[{"rhs", "[", 
            RowBox[{"[", "iter", "]"}], "]"}], "]"}], "<>", 
          "\"\<);\\n\\n\>\""}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"evaluate", " ", "convergence"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"convergence", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"str", "=", 
         RowBox[{"str", "<>", "\"\<if (\\n\\n\>\""}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"iter", "=", "1"}], ",", 
          RowBox[{"iter", "\[LessEqual]", 
           RowBox[{"Length", "[", "rhs", "]"}]}], ",", 
          RowBox[{"iter", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"str", "=", 
            RowBox[{"str", "<>", "\"\<fabs(\>\"", "<>", 
             RowBox[{"tc", "[", 
              RowBox[{"lhs", "[", 
               RowBox[{"[", "iter", "]"}], "]"}], "]"}], "<>", "\"\< - \>\"", 
             "<>", 
             RowBox[{"tc", "[", 
              RowBox[{"variables", "[", 
               RowBox[{"[", "iter", "]"}], "]"}], "]"}], "<>", 
             "\"\<)\>\""}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"iter", "<", 
              RowBox[{"Length", "[", "rhs", "]"}]}], ",", 
             RowBox[{"str", "=", 
              RowBox[{"str", "<>", "\"\<&&\\n\\n\>\""}]}]}], "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"str", "=", 
         RowBox[{"str", "<>", "\"\<)\\n\\n{break;}\\n\\n\>\""}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"update", " ", "values"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"iter", "=", "1"}], ",", 
       RowBox[{"iter", "\[LessEqual]", 
        RowBox[{"Length", "[", "rhs", "]"}]}], ",", 
       RowBox[{"iter", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"str", "=", 
         RowBox[{"str", "<>", 
          RowBox[{"tc", "[", 
           RowBox[{"variables", "[", 
            RowBox[{"[", "iter", "]"}], "]"}], "]"}], "<>", "\"\< = \>\"", "<>", 
          RowBox[{"tc", "[", 
           RowBox[{"lhs", "[", 
            RowBox[{"[", "iter", "]"}], "]"}], "]"}], "<>", 
          "\"\<;\\n\\n\>\""}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"end", " ", "iteration"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"str", " ", "=", 
      RowBox[{"str", "<>", "\"\<}\\n\\n\>\""}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"(*", " ", 
      RowBox[{"export", " ", "to", " ", "gsl_vector"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"iter", "=", "1"}], ",", 
       RowBox[{"iter", "\[LessEqual]", 
        RowBox[{"Length", "[", "rhs", "]"}]}], ",", 
       RowBox[{"iter", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"str", "=", 
         RowBox[{"str", "<>", "\"\<gsl_vector_set(f,\>\"", "<>", 
          RowBox[{"tc", "[", 
           RowBox[{"iter", "-", "1"}], "]"}], "<>", "\"\<,\>\"", "<>", 
          RowBox[{"tc", "[", 
           RowBox[{"variables", "[", 
            RowBox[{"[", "iter", "]"}], "]"}], "]"}], "<>", 
          "\"\<);\\n\>\""}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "str", "]"}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.685209614910993*^9, 3.685209661145727*^9}, {
  3.685209694142723*^9, 3.685209863273239*^9}, {3.685210764292458*^9, 
  3.685210987028152*^9}, {3.685211248559246*^9, 3.685211367200728*^9}, {
  3.685211408176893*^9, 3.68521144977796*^9}, {3.685211490328933*^9, 
  3.685211491803747*^9}, {3.685211528790462*^9, 3.685211535122222*^9}, {
  3.685211647585174*^9, 3.685211647652994*^9}, {3.6852118011456337`*^9, 
  3.6852118024652767`*^9}, {3.685212205485675*^9, 3.6852122517039757`*^9}, {
  3.6852123539821568`*^9, 3.68521235460798*^9}, {3.685212389002179*^9, 
  3.685212389854944*^9}, {3.685212439952259*^9, 3.685212444685377*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Patch frequencies", "Section",
 CellChangeTimes->{{3.682839290907461*^9, 3.682839293683313*^9}, {
  3.685106951853847*^9, 3.685106952468895*^9}}],

Cell["\<\
2 players per patch: 2 environments with each individual either adapted or \
maladapted yielding 2x3 combinations\
\>", "Text",
 CellChangeTimes->{{3.682839352322534*^9, 3.682839377921241*^9}}],

Cell[CellGroupData[{

Cell["Basic functions", "Subsection",
 CellChangeTimes->{{3.682839734424313*^9, 3.682839735832242*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"patches", "=", 
  RowBox[{
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"f", "[", 
      RowBox[{"ei", ",", 
       RowBox[{"statex", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"statex", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"ei", ",", "1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"statex", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "a"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"a", ",", "m"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], "]"}], "//", 
   "Flatten"}]}]], "Input",
 CellChangeTimes->{{3.683222237011471*^9, 3.683222280771747*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{"1", ",", "a", ",", "a"}], "]"}], ",", 
   RowBox[{"f", "[", 
    RowBox[{"1", ",", "a", ",", "m"}], "]"}], ",", 
   RowBox[{"f", "[", 
    RowBox[{"1", ",", "m", ",", "m"}], "]"}], ",", 
   RowBox[{"f", "[", 
    RowBox[{"2", ",", "a", ",", "a"}], "]"}], ",", 
   RowBox[{"f", "[", 
    RowBox[{"2", ",", "a", ",", "m"}], "]"}], ",", 
   RowBox[{"f", "[", 
    RowBox[{"2", ",", "m", ",", "m"}], "]"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.6832222759161987`*^9, 3.683222281683762*^9}, 
   3.683227218136971*^9, 3.683227252466351*^9, 3.6849993032342567`*^9, {
   3.685007559979795*^9, 3.685007579715004*^9}, 3.685008286419301*^9, 
   3.685008494743064*^9, 3.68500996763317*^9, 3.685011903429612*^9, 
   3.6850121476347237`*^9, 3.685012776888669*^9, 3.685012967781156*^9, 
   3.685013033025296*^9, 3.6850131272772627`*^9, 3.685013245109236*^9, 
   3.6850135999341373`*^9, 3.685013682735832*^9, 3.6850137754977293`*^9, 
   3.6850748796888723`*^9, 3.685075735769313*^9, 3.685075868415422*^9, 
   3.6850759787426233`*^9, 3.6850760657339487`*^9, 3.685076249278241*^9, 
   3.685076349549931*^9, 3.685076431412888*^9, 3.685076813206607*^9, 
   3.68507689822722*^9, 3.6850772992828608`*^9, 3.6850773553793497`*^9, 
   3.685077412155895*^9, 3.685077799456902*^9, 3.685078087792465*^9, 
   3.685081063136734*^9, 3.6850811518396893`*^9, 3.6850814422704773`*^9, 
   3.685081849194378*^9, 3.685081945689837*^9, 3.685085951250333*^9, 
   3.6850860370932217`*^9, 3.685086083981477*^9, 3.6850861808714247`*^9, 
   3.685086579923284*^9, {3.685086627706616*^9, 3.685086646912017*^9}, 
   3.685092453386024*^9, 3.685092915850807*^9, 3.68509295922782*^9, 
   3.685093413421948*^9, 3.685094211018045*^9, 3.685094964086812*^9, 
   3.685095985992957*^9, 3.685096026822175*^9, 3.685096260466878*^9, 
   3.6850994564972143`*^9, 3.68510464846751*^9, 3.685104835054796*^9, 
   3.6851049937330723`*^9, 3.6851065041455927`*^9, 3.6851923778078003`*^9, 
   3.685192714003703*^9, 3.6851932592139606`*^9, 3.685193930704368*^9, 
   3.685195318748199*^9, 3.685195391031385*^9, 3.685203477955783*^9, 
   3.685204014003182*^9, 3.6852055035136127`*^9, 3.68521304605175*^9}]
}, Open  ]],

Cell[TextData[{
 "Determine phenotype of adult living in envt ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["e", "i"], TraditionalForm]]],
 " and having state x (a,m)"
}], "Text",
 CellChangeTimes->{{3.682839984971283*^9, 3.6828400101313667`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"phen", "[", 
    RowBox[{"ei_", ",", "state_"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Count", "[", 
         RowBox[{
          RowBox[{"{", "state", "}"}], ",", "a"}], "]"}], ">", "0"}], "&&", 
       RowBox[{"ei", "\[Equal]", "1"}]}], "||", 
      RowBox[{
       RowBox[{
        RowBox[{"Count", "[", 
         RowBox[{
          RowBox[{"{", "state", "}"}], ",", "m"}], "]"}], ">", "0"}], "&&", 
       RowBox[{"ei", "\[Equal]", "2"}]}]}], ",", "1", ",", "2"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.68284001348737*^9, 3.682840037124978*^9}}],

Cell[TextData[{
 "Probability ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["p", "a"], "(", 
    RowBox[{
     SubscriptBox["e", "1"], ",", 
     SubscriptBox["state", "1"], ",", 
     SubscriptBox["state", "2"]}], ")"}], TraditionalForm]]],
 " that a locally ",
 StyleBox["adapted",
  FontSlant->"Italic"],
 " juvenile occupies a vacant position in a environment ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["e", "1"], TraditionalForm]]],
 "-patch previously containing two adult breeders in state1 and state2"
}], "Text",
 CellChangeTimes->{{3.6828397381281157`*^9, 3.682839819678378*^9}, {
  3.68284056184733*^9, 3.6828405665666933`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"pa", "[", 
   RowBox[{"ei_", ",", "state1_", ",", "state2_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"1", "-", "d"}], ")"}], 
    FractionBox["1", "2"], 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"ei", "\[Equal]", "1"}], ",", 
      RowBox[{
       RowBox[{"p", "[", 
        RowBox[{"phen", "[", 
         RowBox[{"ei", ",", "state1"}], "]"}], "]"}], "+", 
       RowBox[{"p", "[", 
        RowBox[{"phen", "[", 
         RowBox[{"ei", ",", "state2"}], "]"}], "]"}]}], ",", 
      RowBox[{"1", "-", 
       RowBox[{"p", "[", 
        RowBox[{"phen", "[", 
         RowBox[{"ei", ",", "state1"}], "]"}], "]"}], "+", "1", "-", 
       RowBox[{"p", "[", 
        RowBox[{"phen", "[", 
         RowBox[{"ei", ",", "state2"}], "]"}], "]"}]}]}], "]"}]}], "+", 
   RowBox[{
    FractionBox["1", "2"], "d", " ", 
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"ex", ",", 
         RowBox[{"statex", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"statex", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ei", "\[Equal]", "1"}], ",", 
         RowBox[{
          RowBox[{"p", "[", 
           RowBox[{"phen", "[", 
            RowBox[{"ex", ",", 
             RowBox[{"statex", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", 
          RowBox[{"p", "[", 
           RowBox[{"phen", "[", 
            RowBox[{"ex", ",", 
             RowBox[{"statex", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"1", "-", 
          RowBox[{"p", "[", 
           RowBox[{"phen", "[", 
            RowBox[{"ex", ",", 
             RowBox[{"statex", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", "1", "-", 
          RowBox[{"p", "[", 
           RowBox[{"phen", "[", 
            RowBox[{"ex", ",", 
             RowBox[{"statex", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}]}], "]"}]}], 
      ",", 
      RowBox[{"{", 
       RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"statex", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"a", ",", "a"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"a", ",", "m"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], 
     "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.682839719870585*^9, 3.682839720051049*^9}, {
  3.682839822464223*^9, 3.6828398757381887`*^9}, {3.6828400587273703`*^9, 
  3.682840294744473*^9}, {3.682840703519944*^9, 3.6828408266472*^9}, {
  3.682841023676312*^9, 3.6828410239780693`*^9}, {3.68284118263155*^9, 
  3.68284118294252*^9}, {3.6850865588763866`*^9, 3.685086559544208*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pa", "[", 
    RowBox[{"1", ",", "a", ",", "m"}], "]"}], "/.", 
   RowBox[{"d", "\[Rule]", "1"}]}], "//", "FullSimplify"}]], "Input",
 CellChangeTimes->{{3.682841188469254*^9, 3.6828411995228653`*^9}, {
   3.682841275411911*^9, 3.682841308552052*^9}, {3.6828415300931807`*^9, 
   3.68284156846031*^9}, 3.682841608403376*^9}],

Cell[BoxData[
 RowBox[{
  FractionBox["1", "2"], " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"2", " ", 
        RowBox[{"f", "[", 
         RowBox[{"1", ",", "a", ",", "a"}], "]"}]}], "+", 
       RowBox[{"f", "[", 
        RowBox[{"1", ",", "a", ",", "m"}], "]"}], "+", 
       RowBox[{"f", "[", 
        RowBox[{"2", ",", "a", ",", "m"}], "]"}], "+", 
       RowBox[{"2", " ", 
        RowBox[{"f", "[", 
         RowBox[{"2", ",", "m", ",", "m"}], "]"}]}]}], ")"}], " ", 
     RowBox[{"p", "[", "1", "]"}]}], "+", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"1", ",", "a", ",", "m"}], "]"}], "+", 
       RowBox[{"2", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"f", "[", 
           RowBox[{"1", ",", "m", ",", "m"}], "]"}], "+", 
          RowBox[{"f", "[", 
           RowBox[{"2", ",", "a", ",", "a"}], "]"}]}], ")"}]}], "+", 
       RowBox[{"f", "[", 
        RowBox[{"2", ",", "a", ",", "m"}], "]"}]}], ")"}], " ", 
     RowBox[{"p", "[", "2", "]"}]}]}], ")"}]}]], "Output",
 CellChangeTimes->{{3.682841192704534*^9, 3.682841199968245*^9}, {
   3.682841276806492*^9, 3.6828413089177113`*^9}, {3.682841533120509*^9, 
   3.682841569209649*^9}, 3.682841608983121*^9, 3.682842910011792*^9, 
   3.682844514397462*^9, 3.6828447159831877`*^9, {3.682844846986526*^9, 
   3.682844863474484*^9}, 3.683199338390189*^9, 3.683200029421755*^9, 
   3.683201000637844*^9, 3.683214380319901*^9, 3.683218276157082*^9, 
   3.68321831135402*^9, {3.683218492739461*^9, 3.6832185218232*^9}, 
   3.683218639399634*^9, 3.6832190357360373`*^9, 3.6832201201193733`*^9, 
   3.6832201774186783`*^9, 3.6832206185877743`*^9, 3.683220690943645*^9, 
   3.683221738944068*^9, 3.68322721826365*^9, 3.683227252590742*^9, 
   3.684999303642604*^9, {3.6850075601117897`*^9, 3.685007579864496*^9}, 
   3.685008286589367*^9, 3.685008494915966*^9, 3.685009967779059*^9, 
   3.685011903600491*^9, 3.685012147782193*^9, 3.685012777041614*^9, 
   3.685012967936809*^9, 3.685013033232036*^9, 3.685013127416522*^9, 
   3.685013245240933*^9, 3.68501360002663*^9, 3.6850136828747272`*^9, 
   3.6850137756613007`*^9, 3.6850748800338306`*^9, 3.685075735933838*^9, 
   3.685075868565686*^9, 3.685075978894773*^9, 3.685076065884923*^9, 
   3.685076249430232*^9, 3.685076349727113*^9, 3.6850764315951347`*^9, 
   3.6850768132988777`*^9, 3.685076898381061*^9, 3.68507729944401*^9, 
   3.6850773555399523`*^9, 3.6850774123274307`*^9, 3.685077799622957*^9, 
   3.6850780879539957`*^9, 3.685081063297488*^9, 3.685081151925584*^9, 
   3.685081442402013*^9, 3.685081849307811*^9, 3.685081945828076*^9, 
   3.685085951391398*^9, 3.6850860372490473`*^9, 3.68508608411896*^9, 
   3.6850861810054617`*^9, 3.685086580088492*^9, {3.685086627857723*^9, 
   3.685086647097645*^9}, 3.685092453529442*^9, 3.685092915983756*^9, 
   3.685092959409892*^9, 3.685093413582841*^9, 3.685094211148366*^9, 
   3.685094964254448*^9, 3.6850959862621737`*^9, 3.685096026953394*^9, 
   3.685096260640827*^9, 3.685099456628468*^9, 3.685104648595625*^9, 
   3.685104835166637*^9, 3.685104993852152*^9, 3.685106504263212*^9, 
   3.6851923780969667`*^9, 3.685192714088077*^9, 3.685193259341174*^9, 
   3.685193930826263*^9, 3.685195318803*^9, 3.685195391139791*^9, 
   3.68520347825112*^9, 3.6852040141854267`*^9, 3.685205503622254*^9, 
   3.6852130462416897`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pa", "[", 
    RowBox[{"1", ",", "a", ",", "a"}], "]"}], "/.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"d", "\[Rule]", "1"}], ",", 
     RowBox[{
      RowBox[{"p", "[", "1", "]"}], "\[Rule]", 
      RowBox[{"1", "/", "2"}]}], ",", 
     RowBox[{
      RowBox[{"p", "[", "2", "]"}], "\[Rule]", 
      RowBox[{"1", "/", "2"}]}]}], "}"}]}], "//", "Simplify"}]], "Input",
 CellChangeTimes->{{3.682841517422905*^9, 3.682841526380045*^9}, {
  3.6828417602481403`*^9, 3.682841851534142*^9}, {3.682841912036694*^9, 
  3.6828419663814487`*^9}}],

Cell[BoxData[
 RowBox[{
  FractionBox["1", "2"], " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "a"}], "]"}], "+", 
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "m"}], "]"}], "+", 
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "m", ",", "m"}], "]"}], "+", 
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "a"}], "]"}], "+", 
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "m"}], "]"}], "+", 
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "m", ",", "m"}], "]"}]}], ")"}]}]], "Output",
 CellChangeTimes->{{3.682841821434124*^9, 3.682841842847329*^9}, {
   3.682841920530855*^9, 3.682841966909236*^9}, 3.6828429100198517`*^9, 
   3.6828445144075203`*^9, 3.682844716011902*^9, {3.682844847024642*^9, 
   3.6828448635076113`*^9}, 3.683199338427557*^9, 3.683200029471447*^9, 
   3.683201000676756*^9, 3.683214380386866*^9, 3.683218276196762*^9, 
   3.683218311403677*^9, {3.6832184927772617`*^9, 3.683218521857522*^9}, 
   3.683218639454995*^9, 3.68321903578629*^9, 3.6832201202632217`*^9, 
   3.683220177477306*^9, 3.683220618636527*^9, 3.683220690985627*^9, 
   3.6832217390121393`*^9, 3.683227218332843*^9, 3.683227252646771*^9, 
   3.684999303685499*^9, {3.685007560159361*^9, 3.6850075799358807`*^9}, 
   3.6850082866462584`*^9, 3.685008494989964*^9, 3.685009967845724*^9, 
   3.685011903664136*^9, 3.685012147850857*^9, 3.685012777113967*^9, 
   3.685012967990906*^9, 3.685013033291245*^9, 3.685013127473474*^9, 
   3.685013245296096*^9, 3.685013600102476*^9, 3.6850136829316587`*^9, 
   3.685013775728223*^9, 3.6850748801383*^9, 3.6850757360228987`*^9, 
   3.68507586862656*^9, 3.685075978903473*^9, 3.685076065947893*^9, 
   3.685076249507657*^9, 3.6850763498020687`*^9, 3.685076431675651*^9, 
   3.685076813430128*^9, 3.68507689844995*^9, 3.685077299517057*^9, 
   3.685077355548881*^9, 3.68507741239686*^9, 3.685077799674364*^9, 
   3.6850780880178747`*^9, 3.685081063367538*^9, 3.685081151980352*^9, 
   3.685081442458097*^9, 3.685081849351707*^9, 3.685081945898109*^9, 
   3.685085951450654*^9, 3.685086037306644*^9, 3.6850860841763477`*^9, 
   3.6850861810654583`*^9, 3.685086580158391*^9, {3.685086627926958*^9, 
   3.685086647270421*^9}, 3.685092453568722*^9, 3.685092916035282*^9, 
   3.685092959479425*^9, 3.685093413649984*^9, 3.685094211190962*^9, 
   3.685094964319703*^9, 3.685095986339053*^9, 3.685096027002777*^9, 
   3.685096260681573*^9, 3.6850994566809187`*^9, 3.6851046486406393`*^9, 
   3.685104835198838*^9, 3.685104993982679*^9, 3.6851065043865557`*^9, 
   3.6851923781390963`*^9, 3.685192714141163*^9, 3.685193259369917*^9, 
   3.685193930903494*^9, 3.6851953188372097`*^9, 3.6851953911740303`*^9, 
   3.685203478285568*^9, 3.6852040142225733`*^9, 3.685205503651813*^9, 
   3.685213046293688*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"pa", "[", 
     RowBox[{"1", ",", "a", ",", "a"}], "]"}], "+", 
    RowBox[{"pa", "[", 
     RowBox[{"1", ",", "m", ",", "m"}], "]"}], "+", 
    RowBox[{"pa", "[", 
     RowBox[{"1", ",", "a", ",", "m"}], "]"}], "+", 
    RowBox[{"pa", "[", 
     RowBox[{"2", ",", "a", ",", "m"}], "]"}], "+", 
    RowBox[{"pa", "[", 
     RowBox[{"2", ",", "a", ",", "a"}], "]"}], "+", 
    RowBox[{"pa", "[", 
     RowBox[{"2", ",", "m", ",", "m"}], "]"}]}], "/.", 
   RowBox[{"d", "\[Rule]", "1"}]}], "/.", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{"p", "[", "1", "]"}], "\[Rule]", 
     RowBox[{"1", "/", "2"}]}], ",", 
    RowBox[{
     RowBox[{"p", "[", "2", "]"}], "\[Rule]", 
     RowBox[{"1", "/", "2"}]}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.682840359525919*^9, 3.682840472752337*^9}, {
   3.68284050478489*^9, 3.6828405078070307`*^9}, {3.682840625326007*^9, 
   3.6828406531702023`*^9}, {3.6828408388166523`*^9, 3.682840855078033*^9}, {
   3.682840895231802*^9, 3.682840895876672*^9}, 3.682841063673695*^9, {
   3.682841159671711*^9, 3.6828411607109137`*^9}, {3.682841340819521*^9, 
   3.682841343826193*^9}, {3.682841779434367*^9, 3.682841783802148*^9}, {
   3.6828418548084707`*^9, 3.682841876119692*^9}}],

Cell[BoxData[
 RowBox[{"3", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "a"}], "]"}], "+", 
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "m"}], "]"}], "+", 
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "m", ",", "m"}], "]"}], "+", 
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "a"}], "]"}], "+", 
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "m"}], "]"}], "+", 
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "m", ",", "m"}], "]"}]}], ")"}]}]], "Output",
 CellChangeTimes->{{3.6828403645828123`*^9, 3.6828403749069357`*^9}, {
   3.682840416467767*^9, 3.6828404197217913`*^9}, 3.682840473560335*^9, 
   3.682840508423678*^9, {3.6828406322184362`*^9, 3.682840653582881*^9}, {
   3.682840809632477*^9, 3.682840855495788*^9}, 3.682840896550845*^9, 
   3.6828410256035547`*^9, 3.6828410644117517`*^9, 3.68284116167943*^9, 
   3.682841344330983*^9, 3.68284178431448*^9, {3.6828418553712053`*^9, 
   3.6828418765709476`*^9}, 3.68284291005037*^9, 3.682844514450981*^9, 
   3.682844716138966*^9, {3.682844847062601*^9, 3.682844863543186*^9}, 
   3.683199338462479*^9, 3.6832000295053663`*^9, 3.683201000741777*^9, 
   3.683214380419036*^9, 3.68321827623742*^9, 3.6832183114414988`*^9, {
   3.6832184928194237`*^9, 3.683218521892448*^9}, 3.683218639517066*^9, 
   3.6832190358324327`*^9, 3.683220120319436*^9, 3.683220177530161*^9, 
   3.683220618677787*^9, 3.683220691021121*^9, 3.683221739060266*^9, 
   3.683227218388176*^9, 3.683227252700585*^9, 3.684999303740405*^9, {
   3.685007560208445*^9, 3.685007579998063*^9}, 3.685008286714221*^9, 
   3.685008495056122*^9, 3.685009967913353*^9, 3.685011903729702*^9, 
   3.685012147919332*^9, 3.6850127771800537`*^9, 3.68501296805023*^9, 
   3.685013033355081*^9, 3.6850131275337763`*^9, 3.685013245346822*^9, 
   3.685013600171372*^9, 3.685013682992012*^9, 3.685013775797236*^9, 
   3.685074880210393*^9, 3.685075736110366*^9, 3.685075868698574*^9, 
   3.685075978967676*^9, 3.685076066025852*^9, 3.685076249583844*^9, 
   3.685076349869388*^9, 3.685076431753357*^9, 3.6850768134974546`*^9, 
   3.685076898529725*^9, 3.685077299600334*^9, 3.68507735555586*^9, 
   3.685077412468491*^9, 3.685077799738387*^9, 3.685078088083767*^9, 
   3.685081063428174*^9, 3.6850811520438538`*^9, 3.685081442512354*^9, 
   3.685081849394587*^9, 3.6850819459595003`*^9, 3.685085951549638*^9, 
   3.6850860373682528`*^9, 3.685086084282722*^9, 3.685086181117704*^9, 
   3.685086580230761*^9, {3.6850866279871492`*^9, 3.6850866473454857`*^9}, 
   3.685092453608584*^9, 3.68509291608119*^9, 3.685092959542161*^9, 
   3.685093413718198*^9, 3.685094211238393*^9, 3.685094964374873*^9, 
   3.6850959863871927`*^9, 3.6850960270563993`*^9, 3.685096260723125*^9, 
   3.685099456722061*^9, 3.685104648648177*^9, 3.68510483528983*^9, 
   3.685104994026232*^9, 3.685106504422119*^9, 3.685192378183195*^9, 
   3.685192714200428*^9, 3.685193259398912*^9, 3.685193930986261*^9, 
   3.685195318869544*^9, 3.685195391207869*^9, 3.685203478316454*^9, 
   3.685204014253077*^9, 3.68520550368015*^9, 3.685213046324086*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
dfaadt - changes in frequency of patches containing two adapted individuals\
\>", "Subsection",
 CellChangeTimes->{{3.685080022316739*^9, 3.685080037484027*^9}}],

Cell["Environmental change", "Text",
 CellChangeTimes->{{3.685079589061872*^9, 3.685079592885844*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dfaadt1", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"Exp", "[", 
     RowBox[{"q", " ", 
      RowBox[{"zs", "[", 
       RowBox[{
        RowBox[{"3", "-", "ei"}], ",", "m"}], "]"}]}], "]"}], 
    RowBox[{"s", "[", 
     RowBox[{"3", "-", "ei"}], "]"}], 
    RowBox[{"f", "[", 
     RowBox[{
      RowBox[{"3", "-", "ei"}], ",", "m", ",", "m"}], "]"}]}], "-", 
   RowBox[{
    RowBox[{"Exp", "[", 
     RowBox[{"q", " ", 
      RowBox[{"zs", "[", 
       RowBox[{"ei", ",", "a"}], "]"}]}], "]"}], 
    RowBox[{"s", "[", "ei", "]"}], 
    RowBox[{"f", "[", 
     RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.685078329231666*^9, 3.685078350433331*^9}, {
   3.685079532325173*^9, 3.68507958589573*^9}, {3.685079674917585*^9, 
   3.685079675956917*^9}, 3.6850800536951027`*^9, {3.685192189396329*^9, 
   3.685192211619975*^9}}],

Cell["\<\
Mortality of maladapted individual in f[ei,a,m] patch, replaced by adapted\
\>", "Text",
 CellChangeTimes->{{3.685079595669931*^9, 3.68507960836557*^9}, {
  3.685079800690548*^9, 3.6850798163937893`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dfaadt2", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   RowBox[{"pa", "[", 
    RowBox[{"ei", ",", "a", ",", "m"}], "]"}], 
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.6850796677101316`*^9, 3.685079682334791*^9}, {
   3.685079728206745*^9, 3.685079753595113*^9}, 3.6850799958536053`*^9, 
   3.685080052854694*^9}],

Cell["Mortality of adapted individual replaced by maladapted", "Text",
 CellChangeTimes->{{3.6850797708899593`*^9, 3.685079798000944*^9}, {
  3.685079856009412*^9, 3.68507986216748*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dfaadt3", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"-", "2"}], 
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", 
     RowBox[{"pa", "[", 
      RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], ")"}], 
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.68507988561872*^9, 3.685079896723215*^9}, {
   3.685079988091125*^9, 3.685079994854566*^9}, 3.6850800521982727`*^9, {
   3.685080086967593*^9, 3.6850800870505447`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dfaadt", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"dfaadt1", "[", "ei", "]"}], "+", 
   RowBox[{"dfaadt2", "[", "ei", "]"}], "+", 
   RowBox[{"dfaadt3", "[", "ei", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.685079999821764*^9, 3.685080007369368*^9}, {
  3.685080040672866*^9, 3.6850800495934668`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
dfamdt - changes in frequency of patches containing one adapted and one \
maladapted breeder\
\>", "Subsection",
 CellChangeTimes->{{3.685080183921131*^9, 3.685080197632658*^9}, 
   3.685081138439829*^9}],

Cell["Environmental change", "Text",
 CellChangeTimes->{{3.685080201192494*^9, 3.685080206231926*^9}, 
   3.685081138440209*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dfamdt1", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"Exp", "[", 
     RowBox[{"q", " ", 
      FractionBox["1", "2"], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"zs", "[", 
         RowBox[{
          RowBox[{"3", "-", "ei"}], ",", "a"}], "]"}], "+", 
        RowBox[{"zs", "[", 
         RowBox[{
          RowBox[{"3", "-", "ei"}], ",", "m"}], "]"}]}], ")"}]}], "]"}], 
    RowBox[{"s", "[", 
     RowBox[{"3", "-", "ei"}], "]"}], 
    RowBox[{"f", "[", 
     RowBox[{
      RowBox[{"3", "-", "ei"}], ",", "a", ",", "m"}], "]"}]}], "-", 
   RowBox[{
    RowBox[{"Exp", "[", 
     RowBox[{"q", 
      FractionBox["1", "2"], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"zs", "[", 
         RowBox[{"ei", ",", "a"}], "]"}], "+", 
        RowBox[{"zs", "[", 
         RowBox[{"ei", ",", "m"}], "]"}]}], ")"}]}], "]"}], 
    RowBox[{"s", "[", "ei", "]"}], 
    RowBox[{"f", "[", 
     RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.6850801082643747`*^9, 3.685080178526833*^9}, 
   3.6850803882960987`*^9, 3.6850811384409122`*^9, {3.685192226822084*^9, 
   3.6851922398527184`*^9}, {3.685192287308612*^9, 3.685192290879471*^9}}],

Cell["\<\
Mortality of a maladapted individual in a f[ei,m,m] patch, replaced by an \
adapted individual\
\>", "Text",
 CellChangeTimes->{{3.685080310053713*^9, 3.685080328653447*^9}, 
   3.685081138442872*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dfamdt2", "[", "ei_", "]"}], ":=", 
  RowBox[{"2", " ", 
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   RowBox[{"pa", "[", 
    RowBox[{"ei", ",", "m", ",", "m"}], "]"}], 
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.685080329798661*^9, 3.685080386740913*^9}, 
   3.685081138443363*^9}],

Cell["\<\
Mortality of an adapted individual in a f[ei,a,a] patch, replaced by a \
maladapted individual\
\>", "Text",
 CellChangeTimes->{{3.6850803990034637`*^9, 3.685080421986698*^9}, 
   3.6850811384451838`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dfamdt3", "[", "ei_", "]"}], ":=", 
  RowBox[{"2", " ", 
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", 
     RowBox[{"pa", "[", 
      RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], ")"}], 
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.685080423015396*^9, 3.685080448634514*^9}, 
   3.685081138445656*^9}],

Cell[TextData[{
 "Mortality of an adapted individual in a ",
 Cell[BoxData[
  FormBox[
   RowBox[{"f", "[", 
    RowBox[{
     SubscriptBox["e", "i"], ",", "a", ",", "m"}], "]"}], TraditionalForm]]],
 " patch, replaced by a maladapted individual"
}], "Text",
 CellChangeTimes->{{3.685080208423974*^9, 3.68508023278393*^9}, 
   3.685081138447915*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dfamdt4", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"-", 
    RowBox[{"mu", "[", "a", "]"}]}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", 
     RowBox[{"pa", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], ")"}], 
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.685080240259932*^9, 3.6850802471164703`*^9}, {
   3.685080287275671*^9, 3.685080307206882*^9}, 3.685080389260743*^9, {
   3.68508050489818*^9, 3.685080505024611*^9}, 3.6850811384483967`*^9}],

Cell["\<\
Mortality of a maladapted individual in a f[ei,a,m] patch, replaced by an \
adapted individual\
\>", "Text",
 CellChangeTimes->{{3.6850805166164427`*^9, 3.6850805366798162`*^9}, 
   3.685081138450787*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dfamdt5", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"-", 
    RowBox[{"mu", "[", "m", "]"}]}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   RowBox[{"pa", "[", 
    RowBox[{"ei", ",", "a", ",", "m"}], "]"}], 
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.685080537632009*^9, 3.6850805632669487`*^9}, 
   3.6850811384512672`*^9}],

Cell["Total change:", "Text",
 CellChangeTimes->{{3.6850806467412663`*^9, 3.685080654316482*^9}, 
   3.685081138453212*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dfamdt", "[", "ei_", "]"}], ":=", 
   RowBox[{
    RowBox[{"dfamdt1", "[", "ei", "]"}], "+", 
    RowBox[{"dfamdt2", "[", "ei", "]"}], "+", 
    RowBox[{"dfamdt3", "[", "ei", "]"}], "+", 
    RowBox[{"dfamdt4", "[", "ei", "]"}], "+", 
    RowBox[{"dfamdt5", "[", "ei", "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.685080579421645*^9, 3.6850806082942553`*^9}, 
   3.685081138453676*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
dfmmdt -  changes in frequency of patches containing two maladapted breeders\
\>", "Subsection",
 CellChangeTimes->{{3.685080714443746*^9, 3.685080728883328*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dfmmdt1", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"Exp", "[", 
     RowBox[{"q", " ", 
      RowBox[{"zs", "[", 
       RowBox[{
        RowBox[{"3", "-", "ei"}], ",", "m"}], "]"}]}], "]"}], 
    RowBox[{"s", "[", 
     RowBox[{"3", "-", "ei"}], "]"}], 
    RowBox[{"f", "[", 
     RowBox[{
      RowBox[{"3", "-", "ei"}], ",", "a", ",", "a"}], "]"}]}], "-", 
   RowBox[{
    RowBox[{"Exp", "[", 
     RowBox[{"q", " ", 
      RowBox[{"zs", "[", 
       RowBox[{"ei", ",", "m"}], "]"}]}], "]"}], 
    RowBox[{"s", "[", "ei", "]"}], 
    RowBox[{"f", "[", 
     RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.685080731020108*^9, 3.685080741751562*^9}, {
  3.685080820126631*^9, 3.6850808545694923`*^9}, {3.685081431046817*^9, 
  3.685081432323371*^9}, {3.685192274177895*^9, 3.685192284836411*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dfmmdt2", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"-", "2"}], 
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   RowBox[{"pa", "[", 
    RowBox[{"ei", ",", "m", ",", "m"}], "]"}], 
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.6850808559780483`*^9, 3.6850808790400047`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dfmmdt3", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", 
     RowBox[{"pa", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], ")"}], 
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.685080879827236*^9, 3.6850809017672853`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dfmmdt", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"dfmmdt1", "[", "ei", "]"}], "+", 
   RowBox[{"dfmmdt2", "[", "ei", "]"}], "+", 
   RowBox[{"dfmmdt3", "[", "ei", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.685080907145267*^9, 3.685080922148411*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Solve for equilibrium patch frequencies", "Subsection",
 CellChangeTimes->{{3.682844188372295*^9, 3.68284419688402*^9}}],

Cell[TextData[{
 "Add the constraint that ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     UnderoverscriptBox["\[Sum]", 
      RowBox[{"i", "=", "o"}], "n"], 
     SubscriptBox["p", "i"]}], "=", "1"}], TraditionalForm]]],
 ":"
}], "Text",
 CellChangeTimes->{{3.6851936967836103`*^9, 3.6851937501920013`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dfdtconst", "=", 
   RowBox[{
    RowBox[{"Total", "[", "patches", "]"}], "\[Equal]", "1"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.682844302412682*^9, 3.6828443146524973`*^9}, {
  3.682844414907618*^9, 3.68284443839462*^9}, {3.685193682485427*^9, 
  3.685193687531497*^9}}],

Cell["Generate system of recursion equations:", "Text",
 CellChangeTimes->{{3.685193743206633*^9, 3.68519374877499*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"syspatch", "=", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"dfaadt", "[", "ei", "]"}], "\[Equal]", "0"}], ",", 
        RowBox[{
         RowBox[{"dfamdt", "[", "ei", "]"}], "\[Equal]", "0"}], ",", 
        RowBox[{
         RowBox[{"dfmmdt", "[", "ei", "]"}], "\[Equal]", "0"}]}], "}"}], ",", 
      
      RowBox[{"{", 
       RowBox[{"ei", ",", "1", ",", "2"}], "}"}]}], "]"}], "//", 
    "Flatten"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.682844484883501*^9, 3.68284455262272*^9}, {
   3.685080963023711*^9, 3.685081012556081*^9}, 3.685081077988969*^9}],

Cell[CellGroupData[{

Cell[BoxData["patches"], "Input",
 CellChangeTimes->{{3.685194866787046*^9, 3.685194867407126*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{"1", ",", "a", ",", "a"}], "]"}], ",", 
   RowBox[{"f", "[", 
    RowBox[{"1", ",", "a", ",", "m"}], "]"}], ",", 
   RowBox[{"f", "[", 
    RowBox[{"1", ",", "m", ",", "m"}], "]"}], ",", 
   RowBox[{"f", "[", 
    RowBox[{"2", ",", "a", ",", "a"}], "]"}], ",", 
   RowBox[{"f", "[", 
    RowBox[{"2", ",", "a", ",", "m"}], "]"}], ",", 
   RowBox[{"f", "[", 
    RowBox[{"2", ",", "m", ",", "m"}], "]"}]}], "}"}]], "Output",
 CellChangeTimes->{3.685194867748021*^9, 3.685195318980809*^9, 
  3.685195391397894*^9, 3.685203478469838*^9, 3.685204014372943*^9, 
  3.6852055037722673`*^9, 3.6852130464587383`*^9}]
}, Open  ]],

Cell["\<\
Make list of recursions, with constraint inserted at different positions. \
These should result in the same solutions, unless something is wrong:\
\>", "Text",
 CellChangeTimes->{{3.6851936068178177`*^9, 3.685193641833178*^9}, {
  3.6851937538308153`*^9, 3.685193754070374*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"syspatch1", "=", 
   RowBox[{"ReplacePart", "[", 
    RowBox[{"syspatch", ",", 
     RowBox[{"1", "\[Rule]", "dfdtconst"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"syspatch2", "=", 
   RowBox[{"ReplacePart", "[", 
    RowBox[{"syspatch", ",", 
     RowBox[{"6", "\[Rule]", "dfdtconst"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.682844554378042*^9, 3.682844578228119*^9}, {
  3.682844859868082*^9, 3.682844861049427*^9}}],

Cell["Prepare system of recursions for export to C", "Text",
 CellChangeTimes->{{3.685193601338025*^9, 3.685193603553784*^9}, {
  3.685193648057824*^9, 3.685193658080552*^9}}],

Cell["\<\
Numerically solve for testing purposes (solving will be done in C for \
scalability)\
\>", "Text",
 CellChangeTimes->{{3.685194314049472*^9, 3.68519432744888*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ansTest", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"mum_", ",", "mua_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"p1_", ",", "p2_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"ds_", ",", "ks_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"s1_", ",", "s2_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"zs1_", ",", "zs2_"}], "}"}], ",", 
    RowBox[{"{", "qs_", "}"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"syspatch1", "/.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"mu", "[", "m", "]"}], "\[Rule]", "mum"}], ",", 
     RowBox[{
      RowBox[{"mu", "[", "a", "]"}], "\[Rule]", "mua"}], ",", 
     RowBox[{
      RowBox[{"p", "[", "1", "]"}], "\[Rule]", "p1"}], ",", 
     RowBox[{
      RowBox[{"p", "[", "2", "]"}], "\[Rule]", "p2"}], ",", 
     RowBox[{"d", "\[Rule]", "ds"}], ",", 
     RowBox[{"k", "\[Rule]", "ks"}], ",", 
     RowBox[{
      RowBox[{"s", "[", "1", "]"}], "\[Rule]", "s1"}], ",", 
     RowBox[{
      RowBox[{"s", "[", "2", "]"}], "\[Rule]", "s2"}], ",", 
     RowBox[{"q", "\[Rule]", "qs"}], ",", 
     RowBox[{
      RowBox[{"zs", "[", "1", "]"}], "\[Rule]", "zs1"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"zs", "[", "2", "]"}], "\[Rule]", "zs2"}], "/.", 
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"1", ",", "a", ",", "a"}], "]"}], "\[Rule]", 
       RowBox[{"1", "/", "6"}]}]}], ",", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"1", ",", "a", ",", "m"}], "]"}], "\[Rule]", 
      RowBox[{"1", "/", "6"}]}], ",", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"1", ",", "m", ",", "m"}], "]"}], "\[Rule]", 
      RowBox[{"1", "/", "6"}]}], ",", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"2", ",", "a", ",", "a"}], "]"}], "\[Rule]", 
      RowBox[{"1", "/", "6"}]}], ",", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"2", ",", "a", ",", "m"}], "]"}], "\[Rule]", 
      RowBox[{"1", "/", "6"}]}], ",", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"2", ",", "m", ",", "m"}], "]"}], "\[Rule]", 
      RowBox[{"1", "/", "6"}]}]}], "}"}]}]}]], "Input",
 CellChangeTimes->{{3.682844199111166*^9, 3.682844224606859*^9}, {
  3.682844441749*^9, 3.682844478975329*^9}, {3.682844531163204*^9, 
  3.6828445315602903`*^9}, {3.682844581072274*^9, 3.682844677536944*^9}, {
  3.682844729987465*^9, 3.682844773807713*^9}, {3.685192306979719*^9, 
  3.685192314054551*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ans", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mum_", ",", "mua_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"p1_", ",", "p2_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"ds_", ",", "ks_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"s1_", ",", "s2_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"zs1_", ",", "zs2_"}], "}"}], ",", 
     RowBox[{"{", "qs_", "}"}]}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"FindRoot", "[", 
    RowBox[{
     RowBox[{"syspatch1", "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"mu", "[", "m", "]"}], "\[Rule]", "mum"}], ",", 
        RowBox[{
         RowBox[{"mu", "[", "a", "]"}], "\[Rule]", "mua"}], ",", 
        RowBox[{
         RowBox[{"p", "[", "1", "]"}], "\[Rule]", "p1"}], ",", 
        RowBox[{
         RowBox[{"p", "[", "2", "]"}], "\[Rule]", "p2"}], ",", 
        RowBox[{"d", "\[Rule]", "ds"}], ",", 
        RowBox[{"k", "\[Rule]", "ks"}], ",", 
        RowBox[{
         RowBox[{"s", "[", "1", "]"}], "\[Rule]", "s1"}], ",", 
        RowBox[{
         RowBox[{"s", "[", "2", "]"}], "\[Rule]", "s2"}], ",", 
        RowBox[{"q", "\[Rule]", "qs"}], ",", 
        RowBox[{
         RowBox[{"zs", "[", 
          RowBox[{"1", ",", "a"}], "]"}], "\[Rule]", "zs1"}], ",", 
        RowBox[{
         RowBox[{"zs", "[", 
          RowBox[{"2", ",", "a"}], "]"}], "\[Rule]", "zs2"}], ",", 
        RowBox[{
         RowBox[{"zs", "[", 
          RowBox[{"1", ",", "m"}], "]"}], "\[Rule]", "zs1"}], ",", 
        RowBox[{
         RowBox[{"zs", "[", 
          RowBox[{"2", ",", "m"}], "]"}], "\[Rule]", "zs2"}]}], "}"}]}], ",", 
     
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"1", ",", "a", ",", "a"}], "]"}], ",", 
         RowBox[{"1", "/", "6"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"1", ",", "a", ",", "m"}], "]"}], ",", 
         RowBox[{"1", "/", "6"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"1", ",", "m", ",", "m"}], "]"}], ",", 
         RowBox[{"1", "/", "6"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"2", ",", "a", ",", "a"}], "]"}], ",", 
         RowBox[{"1", "/", "6"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"2", ",", "a", ",", "m"}], "]"}], ",", 
         RowBox[{"1", "/", "6"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"2", ",", "m", ",", "m"}], "]"}], ",", 
         RowBox[{"1", "/", "6"}]}], "}"}]}], "}"}]}], "]"}]}], ";"}]], "Input",\

 CellChangeTimes->{{3.682844199111166*^9, 3.682844224606859*^9}, {
  3.682844441749*^9, 3.682844478975329*^9}, {3.682844531163204*^9, 
  3.6828445315602903`*^9}, {3.682844581072274*^9, 3.682844677536944*^9}, {
  3.6828447930515327`*^9, 3.682844815210123*^9}, {3.68519231685913*^9, 
  3.685192323720293*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ansAlt", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mum_", ",", "mua_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"p1_", ",", "p2_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"ds_", ",", "ks_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"s1_", ",", "s2_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"zs1_", ",", "zs2_"}], "}"}], ",", 
     RowBox[{"{", "qs_", "}"}]}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"FindRoot", "[", 
    RowBox[{
     RowBox[{"syspatch2", "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"mu", "[", "m", "]"}], "\[Rule]", "mum"}], ",", 
        RowBox[{
         RowBox[{"mu", "[", "a", "]"}], "\[Rule]", "mua"}], ",", 
        RowBox[{
         RowBox[{"p", "[", "1", "]"}], "\[Rule]", "p1"}], ",", 
        RowBox[{
         RowBox[{"p", "[", "2", "]"}], "\[Rule]", "p2"}], ",", 
        RowBox[{"d", "\[Rule]", "ds"}], ",", 
        RowBox[{"k", "\[Rule]", "ks"}], ",", 
        RowBox[{
         RowBox[{"s", "[", "1", "]"}], "\[Rule]", "s1"}], ",", 
        RowBox[{
         RowBox[{"s", "[", "2", "]"}], "\[Rule]", "s2"}], ",", 
        RowBox[{"q", "\[Rule]", "qs"}], ",", 
        RowBox[{
         RowBox[{"zs", "[", 
          RowBox[{"1", ",", "a"}], "]"}], "\[Rule]", "zs1"}], ",", 
        RowBox[{
         RowBox[{"zs", "[", 
          RowBox[{"2", ",", "a"}], "]"}], "\[Rule]", "zs2"}], ",", 
        RowBox[{
         RowBox[{"zs", "[", 
          RowBox[{"1", ",", "m"}], "]"}], "\[Rule]", "zs1"}], ",", 
        RowBox[{
         RowBox[{"zs", "[", 
          RowBox[{"2", ",", "m"}], "]"}], "\[Rule]", "zs2"}]}], "}"}]}], ",", 
     
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"1", ",", "a", ",", "a"}], "]"}], ",", 
         RowBox[{"1", "/", "6"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"1", ",", "a", ",", "m"}], "]"}], ",", 
         RowBox[{"1", "/", "6"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"1", ",", "m", ",", "m"}], "]"}], ",", 
         RowBox[{"1", "/", "6"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"2", ",", "a", ",", "a"}], "]"}], ",", 
         RowBox[{"1", "/", "6"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"2", ",", "a", ",", "m"}], "]"}], ",", 
         RowBox[{"1", "/", "6"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"2", ",", "m", ",", "m"}], "]"}], ",", 
         RowBox[{"1", "/", "6"}]}], "}"}]}], "}"}]}], "]"}]}], ";"}]], "Input",\

 CellChangeTimes->{{3.682844199111166*^9, 3.682844224606859*^9}, {
  3.682844441749*^9, 3.682844478975329*^9}, {3.682844531163204*^9, 
  3.6828445315602903`*^9}, {3.682844581072274*^9, 3.682844688243565*^9}, {
  3.682844832244445*^9, 3.682844834671414*^9}, {3.6851923258501177`*^9, 
  3.685192331566452*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ans", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"2.0", ",", "1.0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.5", ",", "0.3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.2", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.8", ",", "0.3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", "0.5", "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.682844781892026*^9, 3.682844782378977*^9}, {
  3.682844819490077*^9, 3.682844819955771*^9}, {3.682844876997488*^9, 
  3.682844878226667*^9}, {3.6850777646861973`*^9, 3.6850777670015182`*^9}, {
  3.6850780647816143`*^9, 3.685078081227344*^9}, {3.6851923343989363`*^9, 
  3.6851923361906137`*^9}, {3.685192841279498*^9, 3.685192843948432*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "a"}], "]"}], "\[Rule]", 
    "0.05954879195944167`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "m"}], "]"}], "\[Rule]", 
    "0.11762087657362476`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "m", ",", "m"}], "]"}], "\[Rule]", 
    "0.09555760419420622`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "a"}], "]"}], "\[Rule]", 
    "0.41431016124425507`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "m"}], "]"}], "\[Rule]", 
    "0.25218368760407234`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "m", ",", "m"}], "]"}], "\[Rule]", 
    "0.06077887842439989`"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.6828447827654123`*^9, {3.682844821396532*^9, 3.682844878707765*^9}, 
   3.6831993387273903`*^9, 3.683200029893487*^9, 3.683201001140911*^9, 
   3.6832143806598473`*^9, 3.6832182765087013`*^9, 3.68321831169211*^9, {
   3.683218493060857*^9, 3.683218522210465*^9}, 3.683218639826892*^9, 
   3.683219036047797*^9, 3.683220120573119*^9, 3.683220177968446*^9, 
   3.683220619040297*^9, 3.68322069132654*^9, 3.6832217392966213`*^9, 
   3.68322721861211*^9, 3.683227253156739*^9, 3.68499930399527*^9, {
   3.685007560419134*^9, 3.685007580231512*^9}, 3.685008286988879*^9, 
   3.6850084953443747`*^9, 3.685009968185704*^9, 3.6850119040159483`*^9, 
   3.685012148177631*^9, 3.685012777571328*^9, 3.685012968304817*^9, 
   3.685013033685768*^9, 3.6850131278745613`*^9, 3.68501324556518*^9, 
   3.685013600580434*^9, 3.685013683233445*^9, 3.685013776065131*^9, 
   3.6850748805188704`*^9, 3.685075736391295*^9, 3.68507586901478*^9, 
   3.6850759794223547`*^9, 3.685076066306322*^9, 3.685076249852889*^9, 
   3.685076350111226*^9, 3.6850764320211554`*^9, 3.685076813805097*^9, 
   3.6850768987989187`*^9, 3.685077300153605*^9, 3.6850773569110737`*^9, 
   3.685077412782378*^9, 3.68507780007425*^9, 3.685078088424971*^9, 
   3.685081063861752*^9, 3.685081152510149*^9, 3.685081442782928*^9, 
   3.68508184964107*^9, 3.685081946252952*^9, 3.685085952756777*^9, 
   3.685086037710112*^9, 3.685086084769474*^9, 3.685086181358395*^9, 
   3.685086580518042*^9, {3.685086628308524*^9, 3.6850866477324677`*^9}, 
   3.685092453784459*^9, 3.685092916285747*^9, 3.68509295978725*^9, 
   3.6850934139916067`*^9, 3.685094211554818*^9, 3.685094964573463*^9, 
   3.685095986731049*^9, 3.685096027293748*^9, 3.6850962609233007`*^9, 
   3.6850994569022913`*^9, 3.6851046488891773`*^9, 3.685104835423463*^9, 
   3.685104994172699*^9, 3.685106504553814*^9, 3.685192378416411*^9, 
   3.68519271438186*^9, 3.6851928445871477`*^9, 3.68519325951027*^9, 
   3.6851953190740757`*^9, 3.685195391455617*^9, 3.685203478558576*^9, 
   3.685204014436275*^9, 3.685205503829817*^9, 3.685213046528452*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ansAlt", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"2.0", ",", "1.0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.5", ",", "0.3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.2", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.8", ",", "0.3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", "0.5", "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.682844690394718*^9, 3.682844712964632*^9}, {
  3.682844838725485*^9, 3.682844839098769*^9}, {3.682844870750375*^9, 
  3.682844872394734*^9}, {3.685077767894009*^9, 3.685077775554861*^9}, {
  3.685078067478292*^9, 3.68507807981194*^9}, {3.685192339519293*^9, 
  3.6851923424858627`*^9}, {3.685192862500772*^9, 3.685192864173212*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "a"}], "]"}], "\[Rule]", 
    "0.0595487919594417`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "m"}], "]"}], "\[Rule]", 
    "0.11762087657362477`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "m", ",", "m"}], "]"}], "\[Rule]", 
    "0.09555760419420622`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "a"}], "]"}], "\[Rule]", 
    "0.41431016124425507`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "m"}], "]"}], "\[Rule]", 
    "0.25218368760407234`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "m", ",", "m"}], "]"}], "\[Rule]", 
    "0.06077887842439991`"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.682844716599186*^9, {3.6828448395941877`*^9, 3.682844874177581*^9}, 
   3.6831993387641363`*^9, 3.683200029926746*^9, 3.683201001172039*^9, 
   3.6832143806914454`*^9, 3.683218276554338*^9, 3.683218311733917*^9, {
   3.6832184932008963`*^9, 3.683218522251499*^9}, 3.683218639889962*^9, 
   3.683219036099676*^9, 3.6832201206165752`*^9, 3.6832201780165997`*^9, 
   3.683220619083599*^9, 3.683220691367845*^9, 3.683221739347555*^9, 
   3.6832272186566763`*^9, 3.6832272532032633`*^9, 3.684999304043631*^9, {
   3.685007560469062*^9, 3.6850075802857924`*^9}, 3.6850082870569897`*^9, 
   3.685008495420949*^9, 3.685009968250052*^9, 3.6850119040863*^9, 
   3.685012148240642*^9, 3.685012777646031*^9, 3.685012968362817*^9, 
   3.685013033754993*^9, 3.6850131279415092`*^9, 3.685013245620973*^9, 
   3.685013600656406*^9, 3.6850136832925797`*^9, 3.685013776131822*^9, 
   3.685074880600281*^9, 3.685075736477002*^9, 3.685075869088674*^9, 
   3.685075979488834*^9, 3.685076066381819*^9, 3.6850762499299726`*^9, 
   3.685076350177273*^9, 3.685076432091567*^9, 3.6850768138816977`*^9, 
   3.685076898881054*^9, 3.685077300243291*^9, 3.68507735700529*^9, 
   3.685077412860422*^9, 3.6850778001388817`*^9, 3.685078088489896*^9, 
   3.685081063905786*^9, 3.685081152573719*^9, 3.685081442832481*^9, 
   3.68508184968534*^9, 3.685081946307667*^9, 3.685085952842292*^9, 
   3.685086037780876*^9, 3.685086084824038*^9, 3.6850861814157257`*^9, 
   3.685086580589713*^9, {3.68508662837501*^9, 3.685086647816201*^9}, 
   3.685092453821241*^9, 3.6850929163293467`*^9, 3.685092959850953*^9, 
   3.685093414049865*^9, 3.685094211606552*^9, 3.685094964622698*^9, 
   3.6850959867762623`*^9, 3.685096027333662*^9, 3.6850962609669228`*^9, 
   3.685099456956641*^9, 3.685104648935484*^9, 3.685104835454926*^9, 
   3.685104994208764*^9, 3.685106504577187*^9, 3.685192378458057*^9, 
   3.6851927144337587`*^9, 3.685192864650381*^9, 3.6851932595406303`*^9, 
   3.6851953191309137`*^9, 3.685195391486326*^9, 3.6852034785970182`*^9, 
   3.685204014466538*^9, 3.6852055038611813`*^9, 3.685213046558045*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Export patch frequency equations to C\
\>", "Subsection",
 CellChangeTimes->{{3.685194333961053*^9, 3.685194337792637*^9}, {
  3.685203438213744*^9, 3.685203466531927*^9}, {3.685204183114839*^9, 
  3.685204185013172*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"patchvalstplus1", "=", 
  RowBox[{"patches", "/.", 
   RowBox[{"f", "\[Rule]", "ftplus1"}]}]}]], "Input",
 CellChangeTimes->{{3.685212650400878*^9, 3.6852126583226337`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"ftplus1", "[", 
    RowBox[{"1", ",", "a", ",", "a"}], "]"}], ",", 
   RowBox[{"ftplus1", "[", 
    RowBox[{"1", ",", "a", ",", "m"}], "]"}], ",", 
   RowBox[{"ftplus1", "[", 
    RowBox[{"1", ",", "m", ",", "m"}], "]"}], ",", 
   RowBox[{"ftplus1", "[", 
    RowBox[{"2", ",", "a", ",", "a"}], "]"}], ",", 
   RowBox[{"ftplus1", "[", 
    RowBox[{"2", ",", "a", ",", "m"}], "]"}], ",", 
   RowBox[{"ftplus1", "[", 
    RowBox[{"2", ",", "m", ",", "m"}], "]"}]}], "}"}]], "Output",
 CellChangeTimes->{3.6852126589661303`*^9, 3.6852130027139482`*^9, 
  3.685213046562191*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"patchsysRHS", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"f", "[", 
           RowBox[{"ei", ",", "a", ",", "a"}], "]"}], "+", 
          RowBox[{"eul", " ", 
           RowBox[{"dfaadt", "[", "ei", "]"}]}]}], ",", 
         RowBox[{
          RowBox[{"f", "[", 
           RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "+", 
          RowBox[{"eul", " ", 
           RowBox[{"dfamdt", "[", "ei", "]"}]}]}], ",", 
         RowBox[{
          RowBox[{"f", "[", 
           RowBox[{"ei", ",", "m", ",", "m"}], "]"}], "+", 
          RowBox[{"eul", " ", 
           RowBox[{"dfmmdt", "[", "ei", "]"}]}]}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"ei", ",", "1", ",", "2"}], "}"}]}], "]"}], "/.", 
     "subslist"}], "//", "Flatten"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"patchsysRHS", "=", 
   RowBox[{
    RowBox[{"ReplacePart", "[", 
     RowBox[{"patchsysRHS", ",", 
      RowBox[{
       RowBox[{"-", "1"}], "\[Rule]", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"f", "[", 
           RowBox[{"2", ",", "m", ",", "m"}], "]"}], "/.", 
          RowBox[{"Solve", "[", 
           RowBox[{"dfdtconst", ",", 
            RowBox[{"f", "[", 
             RowBox[{"2", ",", "m", ",", "m"}], "]"}]}], "]"}]}], "/.", 
         RowBox[{"f", "\[Rule]", "ftplus1"}]}], ")"}]}]}], "]"}], "//", 
    "Flatten"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.685212665706449*^9, 3.685212716074629*^9}, {
  3.685212822871293*^9, 3.685212945561305*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"strpatchFreq", "=", 
   RowBox[{"recur2c", "[", 
    RowBox[{
    "patchvalstplus1", ",", "patchsysRHS", ",", "patches", ",", "bound01", 
     ",", "True"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6852129491915293`*^9, 3.685212972499621*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
    RowBox[{"cdir", "<>", "\"\<patchrecurs.txt\>\""}], ",", "strpatchFreq"}], 
   "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.685203492229539*^9, 3.685203532381892*^9}, 
   3.685203673044236*^9, 3.68520402268504*^9, 3.685204062963731*^9, 
   3.685213042041252*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Reproductive values", "Section",
 CellChangeTimes->{{3.682844962098281*^9, 3.6828449638582706`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rvals", "=", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{"ex", ",", "statex1", ",", "statex2"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"statex1", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"statex2", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}]}], "]"}], "//", 
    "Flatten"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.683200086190008*^9, 3.683200155658983*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rvalsTest", "=", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"v", "[", 
        RowBox[{"2", ",", "statex1", ",", "statex2"}], "]"}], "\[Rule]", 
       RowBox[{"v", "[", 
        RowBox[{"1", ",", "statex1", ",", "statex2"}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"statex1", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"statex2", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}]}], "]"}], "//", 
    "Flatten"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6832001606051397`*^9, 3.683200179314473*^9}}],

Cell[CellGroupData[{

Cell[TextData[{
 Cell[BoxData[
  FormBox[
   RowBox[{"v", "[", 
    SubscriptBox["e", "i"]}], TraditionalForm]]],
 ",a,m]: Reproductive value of focal adapted individual sharing a environment \
ei patch with a maladapted individual "
}], "Subsection",
 CellChangeTimes->{{3.682845152607973*^9, 3.6828451899586554`*^9}, {
  3.683199373324525*^9, 3.683199405378907*^9}}],

Cell["Environmental change:", "Text",
 CellChangeTimes->{{3.682845239557769*^9, 3.6828452435668077`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvamdt1", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Exp", "[", 
    RowBox[{"q", 
     FractionBox["1", "2"], 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"zs", "[", 
        RowBox[{"ei", ",", "a"}], "]"}], "+", 
       RowBox[{"zs", "[", 
        RowBox[{"ei", ",", "m"}], "]"}]}], ")"}]}], "]"}], 
   RowBox[{"s", "[", "ei", "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{
       RowBox[{"3", "-", "ei"}], ",", "m", ",", "a"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.6828451992130203`*^9, 3.682845246071899*^9}, {
  3.683199347330213*^9, 3.68319940962227*^9}, {3.685192895131504*^9, 
  3.685192897684272*^9}}],

Cell["Mortality of focal, replaced by her own maladapted offspring", "Text",
 CellChangeTimes->{{3.6828452501496277`*^9, 3.68284525658976*^9}, {
  3.682845329972937*^9, 3.682845331604385*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvamdt2", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{"1", "-", 
      RowBox[{"p", "[", 
       RowBox[{"phen", "[", 
        RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ",", 
     RowBox[{"p", "[", 
      RowBox[{"phen", "[", 
       RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "m"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845258154578*^9, 3.682845356278455*^9}, {
   3.683199411005266*^9, 3.683199421837904*^9}, {3.683199452764576*^9, 
   3.68319951112311*^9}, 3.683227210190816*^9}],

Cell["Mortality of focal, replaced by nonfocal offspring", "Text",
 CellChangeTimes->{{3.68284535944386*^9, 3.682845365923882*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvamdt3", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", 
     RowBox[{
      FractionBox["1", "2"], 
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}]}]}], ")"}], 
   RowBox[{"(", 
    RowBox[{"-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845368271618*^9, 3.682845390486068*^9}, {
   3.683199514840802*^9, 3.683199523540876*^9}, 3.683227209011223*^9}],

Cell["Mortality of nonfocal, replaced by focal's offspring", "Text",
 CellChangeTimes->{{3.682845393347591*^9, 3.682845405355267*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvamdt4", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"p", "[", 
       RowBox[{"phen", "[", 
        RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{
         RowBox[{"2", 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], ",", 
        RowBox[{"v", "[", 
         RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}], "]"}]}], "+", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "-", 
        RowBox[{"p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{"v", "[", 
         RowBox[{"ei", ",", "m", ",", "a"}], "]"}], ",", 
        RowBox[{
         RowBox[{"2", 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}]}], "]"}]}]}], 
    ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845406494494*^9, 3.6828454555095787`*^9}, {
  3.6831995261390457`*^9, 3.683199751862639*^9}}],

Cell["\<\
Mortality of nonfocal, replaced by nonfocal offspring of a different type \
than nonfocal\
\>", "Text",
 CellChangeTimes->{{3.682845472978017*^9, 3.6828454882093973`*^9}, {
  3.683199796656701*^9, 3.683199797376515*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvamdt5", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      FractionBox["1", "2"], 
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{"p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "m"}], "]"}], "]"}], ",", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "m"}], "]"}], "]"}]}]}], "]"}]}], "+", 
     RowBox[{
      FractionBox["1", "2"], "d", " ", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"ex", ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
         RowBox[{"(", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ei", "\[Equal]", "1"}], ",", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ",", 
            RowBox[{"1", "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", "1", 
             "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}]}], "]"}], 
          ")"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"statex", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a", ",", "a"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"a", ",", "m"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], "]"}]}]}], 
    ")"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "a"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845489127758*^9, 3.682845652705119*^9}, {
   3.683199761631853*^9, 3.683199902715605*^9}, {3.683200116816619*^9, 
   3.683200118465126*^9}, {3.683200860421144*^9, 3.683200864659851*^9}, 
   3.6832189099756813`*^9, 3.683227206083026*^9}],

Cell["\<\
Mortality of individual in remote patch, replaced by focal's offspring\
\>", "Text",
 CellChangeTimes->{{3.682845684654298*^9, 3.682845694533659*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvamdt6", "[", "ei_", "]"}], ":=", 
  RowBox[{
   FractionBox["1", "2"], "d", " ", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"ex", ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}]}], 
       ")"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"statex", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "a"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"a", ",", "m"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.682845654868635*^9, 3.682845679124524*^9}, {
   3.6831983981408043`*^9, 3.683198481007554*^9}, {3.683198569254446*^9, 
   3.683198631061006*^9}, {3.683198894243639*^9, 3.683199109099525*^9}, 
   3.68319934095358*^9, {3.683199926463127*^9, 3.683199981943626*^9}, {
   3.68320035894034*^9, 3.6832003611335793`*^9}, 3.683218944788011*^9, 
   3.683227204207383*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dvamdt", "[", "ei_", "]"}], ":=", 
   RowBox[{
    RowBox[{"dvamdt1", "[", "ei", "]"}], "+", 
    RowBox[{"dvamdt2", "[", "ei", "]"}], "+", 
    RowBox[{"dvamdt3", "[", "ei", "]"}], "+", 
    RowBox[{"dvamdt4", "[", "ei", "]"}], "+", 
    RowBox[{"dvamdt5", "[", "ei", "]"}], "+", 
    RowBox[{"dvamdt6", "[", "ei", "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.683199311291834*^9, 3.683199335664133*^9}, {
  3.683200008076005*^9, 3.6832000770423727`*^9}, {3.683200190847007*^9, 
  3.683200245334814*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 Cell[BoxData[
  FormBox[
   RowBox[{"v", "[", 
    SubscriptBox["e", "i"]}], TraditionalForm]]],
 ",m,a]: Reproductive value of focal maladapted individual sharing a \
environment ei patch with an adapted individual "
}], "Subsection",
 CellChangeTimes->{{3.682845152607973*^9, 3.6828451899586554`*^9}, {
  3.683199373324525*^9, 3.683199405378907*^9}, {3.683200341720703*^9, 
  3.683200352201293*^9}}],

Cell["Environmental change:", "Text",
 CellChangeTimes->{{3.682845239557769*^9, 3.6828452435668077`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmadt1", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Exp", "[", 
    RowBox[{"q", 
     FractionBox["1", "2"], 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"zs", "[", 
        RowBox[{"ei", ",", "m"}], "]"}], "+", 
       RowBox[{"zs", "[", 
        RowBox[{"ei", ",", "a"}], "]"}]}], ")"}]}], "]"}], 
   RowBox[{"s", "[", "ei", "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{
       RowBox[{"3", "-", "ei"}], ",", "a", ",", "m"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.6828451992130203`*^9, 3.682845246071899*^9}, {
  3.683199347330213*^9, 3.68319940962227*^9}, {3.6832004127359333`*^9, 
  3.68320043309993*^9}, {3.685192906452745*^9, 3.68519290995665*^9}}],

Cell["Mortality of focal, replaced by her own adapted offspring", "Text",
 CellChangeTimes->{{3.6828452501496277`*^9, 3.68284525658976*^9}, {
  3.682845329972937*^9, 3.682845331604385*^9}, {3.683200460076082*^9, 
  3.6832004609474897`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmadt2", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{"p", "[", 
      RowBox[{"phen", "[", 
       RowBox[{"ei", ",", "m"}], "]"}], "]"}], ",", 
     RowBox[{"1", "-", 
      RowBox[{"p", "[", 
       RowBox[{"phen", "[", 
        RowBox[{"ei", ",", "m"}], "]"}], "]"}]}]}], "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "a"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845258154578*^9, 3.682845356278455*^9}, {
   3.683199411005266*^9, 3.683199421837904*^9}, {3.683199452764576*^9, 
   3.68319951112311*^9}, {3.6832004363552237`*^9, 3.683200472657877*^9}, {
   3.683200555700583*^9, 3.6832005768996687`*^9}, 3.683219505299831*^9, 
   3.683227201430964*^9}],

Cell["Mortality of focal, replaced by nonfocal offspring", "Text",
 CellChangeTimes->{{3.68284535944386*^9, 3.682845365923882*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmadt3", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", 
     RowBox[{
      FractionBox["1", "2"], 
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}]}]}], ")"}], 
   RowBox[{"(", 
    RowBox[{"-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845368271618*^9, 3.682845390486068*^9}, {
   3.683199514840802*^9, 3.683199523540876*^9}, {3.68320058014487*^9, 
   3.683200589869781*^9}, 3.683227200189714*^9}],

Cell["Mortality of nonfocal, replaced by focal's offspring", "Text",
 CellChangeTimes->{{3.682845393347591*^9, 3.682845405355267*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmadt4", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"p", "[", 
       RowBox[{"phen", "[", 
        RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{"v", "[", 
         RowBox[{"ei", ",", "a", ",", "m"}], "]"}], ",", 
        RowBox[{
         RowBox[{"2", 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}]}], "]"}]}], "+", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "-", 
        RowBox[{"p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{
         RowBox[{"2", 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}], ",", 
        RowBox[{"v", "[", 
         RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], "]"}]}]}], 
    ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845406494494*^9, 3.6828454555095787`*^9}, {
  3.6831995261390457`*^9, 3.683199751862639*^9}, {3.6832005956307487`*^9, 
  3.683200742417244*^9}, {3.683200801830461*^9, 3.683200802245098*^9}}],

Cell["\<\
Mortality of nonfocal adapted, replaced by nonfocal maladapted offspring\
\>", "Text",
 CellChangeTimes->{{3.682845472978017*^9, 3.6828454882093973`*^9}, {
  3.683199796656701*^9, 3.683199797376515*^9}, {3.683213694530525*^9, 
  3.683213700345112*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmadt5", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      FractionBox["1", "2"], 
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ",", 
        RowBox[{"p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], "]"}]}], "+", 
     RowBox[{
      FractionBox["1", "2"], "d", " ", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"ex", ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
         RowBox[{"(", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ei", "\[Equal]", "1"}], ",", 
            RowBox[{"1", "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", "1", 
             "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}]}], "]"}], 
          ")"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"statex", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a", ",", "a"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"a", ",", "m"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], "]"}]}]}], 
    ")"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "m"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845489127758*^9, 3.682845652705119*^9}, {
   3.683199761631853*^9, 3.683199902715605*^9}, {3.683200116816619*^9, 
   3.683200118465126*^9}, {3.683200754640517*^9, 3.6832008538239202`*^9}, {
   3.6832008997121553`*^9, 3.683200902071858*^9}, 3.6832189925315723`*^9, {
   3.68321984562053*^9, 3.683219862401634*^9}, 3.6832271967477627`*^9}],

Cell["\<\
Mortality of individual in remote patch, replaced by focal's offspring\
\>", "Text",
 CellChangeTimes->{{3.682845684654298*^9, 3.682845694533659*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmadt6", "[", "ei_", "]"}], ":=", 
  RowBox[{
   FractionBox["1", "2"], "d", " ", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"ex", ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}]}], 
       ")"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"statex", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "a"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"a", ",", "m"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.682845654868635*^9, 3.682845679124524*^9}, {
   3.6831983981408043`*^9, 3.683198481007554*^9}, {3.683198569254446*^9, 
   3.683198631061006*^9}, {3.683198894243639*^9, 3.683199109099525*^9}, 
   3.68319934095358*^9, {3.683199926463127*^9, 3.683199981943626*^9}, {
   3.683200927136066*^9, 3.6832009722494783`*^9}, 3.683218996081359*^9, 
   3.683227195001505*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dvmadt", "[", "ei_", "]"}], ":=", 
   RowBox[{
    RowBox[{"dvmadt1", "[", "ei", "]"}], "+", 
    RowBox[{"dvmadt2", "[", "ei", "]"}], "+", 
    RowBox[{"dvmadt3", "[", "ei", "]"}], "+", 
    RowBox[{"dvmadt4", "[", "ei", "]"}], "+", 
    RowBox[{"dvmadt5", "[", "ei", "]"}], "+", 
    RowBox[{"dvmadt6", "[", "ei", "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.683199311291834*^9, 3.683199335664133*^9}, {
  3.683200008076005*^9, 3.6832000770423727`*^9}, {3.683200190847007*^9, 
  3.683200245334814*^9}, {3.683200978950598*^9, 3.6832009932869453`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 Cell[BoxData[
  FormBox[
   RowBox[{"v", "[", 
    RowBox[{
     SubscriptBox["e", "i"], ",", "a", ",", "a"}], "]"}], TraditionalForm]]],
 " reproductive value of focal adapted individual living in a patch with \
another adapted individual"
}], "Subsection",
 CellChangeTimes->{{3.6832132294642563`*^9, 3.683213249847337*^9}}],

Cell["Environmental change", "Text",
 CellChangeTimes->{{3.6832132582712584`*^9, 3.683213260558799*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvaadt1", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Exp", "[", 
    RowBox[{"q", " ", 
     RowBox[{"zs", "[", 
      RowBox[{"ei", ",", "a"}], "]"}]}], "]"}], 
   RowBox[{"s", "[", "ei", "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{
       RowBox[{"3", "-", "ei"}], ",", "m", ",", "m"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.6832132616833057`*^9, 3.683213303386718*^9}, {
   3.6832177969847403`*^9, 3.6832178203628473`*^9}, 3.6832271931226387`*^9, {
   3.6851929164419117`*^9, 3.685192918858774*^9}}],

Cell["Focal adapted dies, replaced by her own maladapted offspring", "Text",
 CellChangeTimes->{{3.6832132809258957`*^9, 3.683213296676857*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvaadt2", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{"1", "-", 
      RowBox[{"p", "[", 
       RowBox[{"phen", "[", 
        RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ",", 
     RowBox[{"p", "[", 
      RowBox[{"phen", "[", 
       RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "a"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.6832133014352007`*^9, 3.683213357824053*^9}, {
   3.683213401879324*^9, 3.683213403911558*^9}, {3.683213534705427*^9, 
   3.683213542979003*^9}, 3.683227192084193*^9}],

Cell["Focal adapted dies, replaced by nonfocal offspring", "Text",
 CellChangeTimes->{{3.68321336010565*^9, 3.683213366625884*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvaadt3", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", 
     RowBox[{
      FractionBox["1", "2"], 
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}]}]}], ")"}], 
   RowBox[{"(", 
    RowBox[{"-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.683213367584035*^9, 3.683213416711776*^9}, 
   3.683227190646262*^9}],

Cell["Nonfocal adapted dies, replaced by focal offspring", "Text",
 CellChangeTimes->{{3.683213418678454*^9, 3.68321342567815*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvaadt4", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"p", "[", 
        RowBox[{"phen", "[", 
         RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
       RowBox[{"v", "[", 
        RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "a"}], "]"}], "+", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], ")"}]}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
       RowBox[{"v", "[", 
        RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], "+", 
      RowBox[{
       RowBox[{"p", "[", 
        RowBox[{"phen", "[", 
         RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "a"}], "]"}], "+", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], ")"}]}]}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.6832134270223827`*^9, 3.683213583469589*^9}, 
   3.683227187898449*^9}],

Cell["\<\
Nonfocal adapted dies, replaced by nonfocal maladapted offspring\
\>", "Text",
 CellChangeTimes->{{3.6832135876560698`*^9, 3.683213597054346*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvaadt5", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ",", 
        RowBox[{"p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], "]"}]}], "+", 
     RowBox[{"d", "*", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"ex", ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
         RowBox[{"(", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ei", "\[Equal]", "1"}], ",", 
            RowBox[{"1", "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", "1", 
             "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}]}], "]"}], 
          ")"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"statex", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a", ",", "a"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"a", ",", "m"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], "]"}]}]}], 
    ")"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.683213598227193*^9, 3.6832137177*^9}, 
   3.6832190029681473`*^9, 3.683220676813352*^9, {3.683224361949139*^9, 
   3.683224364332396*^9}, 3.68322718657099*^9, {3.685005433142889*^9, 
   3.685005439598843*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvaadt6", "[", "ei_", "]"}], ":=", 
  RowBox[{
   FractionBox["1", "2"], "d", " ", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"ex", ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}]}], 
       ")"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"statex", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "a"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"a", ",", "m"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.683213719921734*^9, 3.683213773822291*^9}, 
   3.6832190057815733`*^9, 3.6832271841108418`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dvaadt", "[", "ei_", "]"}], ":=", 
   RowBox[{
    RowBox[{"dvaadt1", "[", "ei", "]"}], "+", 
    RowBox[{"dvaadt2", "[", "ei", "]"}], "+", 
    RowBox[{"dvaadt3", "[", "ei", "]"}], "+", 
    RowBox[{"dvaadt4", "[", "ei", "]"}], "+", 
    RowBox[{"dvaadt5", "[", "ei", "]"}], "+", 
    RowBox[{"dvaadt6", "[", "ei", "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.683213786759811*^9, 3.6832138193694963`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[Cell[BoxData[
 FormBox[
  RowBox[{"v", "[", 
   RowBox[{
    SubscriptBox["e", "i"], ",", "m", ",", "m"}], "]"}], 
  TraditionalForm]]]], "Subsection",
 CellChangeTimes->{{3.6832144102492037`*^9, 3.683214425500306*^9}}],

Cell["Environmental change", "Text",
 CellChangeTimes->{{3.6832177787163754`*^9, 3.683217781747661*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmmdt1", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Exp", "[", 
    RowBox[{"q", " ", 
     RowBox[{"zs", "[", 
      RowBox[{"ei", ",", "m"}], "]"}]}], "]"}], 
   RowBox[{"s", "[", "ei", "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{
       RowBox[{"3", "-", "ei"}], ",", "a", ",", "a"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.683217782423493*^9, 3.683217791529729*^9}, {
   3.683217881336334*^9, 3.683217897056925*^9}, {3.6832271799072657`*^9, 
   3.683227182420065*^9}, 3.6832272429076*^9, {3.685192927521343*^9, 
   3.685192929667186*^9}}],

Cell["Focal dies, replaced by her own adapted offspring", "Text",
 CellChangeTimes->{{3.6832144383815317`*^9, 3.683214453429648*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmmdt2", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{"p", "[", 
      RowBox[{"phen", "[", 
       RowBox[{"ei", ",", "m"}], "]"}], "]"}], ",", 
     RowBox[{"1", "-", 
      RowBox[{"p", "[", 
       RowBox[{"phen", "[", 
        RowBox[{"ei", ",", "m"}], "]"}], "]"}]}]}], "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.683214430586694*^9, 3.6832144562819443`*^9}, {
   3.6832174226063623`*^9, 3.683217427491819*^9}, {3.683217776583317*^9, 
   3.683217776664213*^9}, {3.683217903779244*^9, 3.6832179482178926`*^9}, 
   3.6832271790872507`*^9}],

Cell["Focal dies, replaced by nonfocal offspring", "Text",
 CellChangeTimes->{{3.6832179512898397`*^9, 3.683217958449692*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmmdt3", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", 
     RowBox[{
      FractionBox["1", "2"], 
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}]}]}], ")"}], 
   RowBox[{"(", 
    RowBox[{"-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.683217959347053*^9, 3.683217984452059*^9}, 
   3.6832271776208477`*^9}],

Cell["Nonfocal dies, replaced by focal offspring ", "Text",
 CellChangeTimes->{{3.683217987151927*^9, 3.683217991370469*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmmdt4", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"p", "[", 
        RowBox[{"phen", "[", 
         RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "+", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "a"}], "]"}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], ")"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
       RowBox[{"v", "[", 
        RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "+", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "a"}], "]"}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], ")"}]}], "+", 
      RowBox[{
       RowBox[{"p", "[", 
        RowBox[{"phen", "[", 
         RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
       RowBox[{"v", "[", 
        RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}]}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.683217993904415*^9, 3.6832180563791037`*^9}, {
  3.683218095013372*^9, 3.683218143285419*^9}}],

Cell["\<\
Nonfocal maladapted dies, replaced by nonfocal adapted offspring\
\>", "Text",
 CellChangeTimes->{{3.683218151473761*^9, 3.683218170208146*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmmdt5", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{"p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "m"}], "]"}], "]"}], ",", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "m"}], "]"}], "]"}]}]}], "]"}]}], "+", 
     RowBox[{"d", " ", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"ex", ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
         RowBox[{"(", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ei", "\[Equal]", "1"}], ",", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ",", 
            RowBox[{"1", "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", "1", 
             "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}]}], "]"}], 
          ")"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"statex", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a", ",", "a"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"a", ",", "m"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], "]"}]}]}], 
    ")"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "a"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.683218146483746*^9, 3.683218227381504*^9}, 
   3.683219026276667*^9, 3.683220671511565*^9, 3.683227168476479*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmmdt6", "[", "ei_", "]"}], ":=", 
  RowBox[{
   FractionBox["1", "2"], "d", " ", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"ex", ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}]}], 
       ")"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"statex", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "a"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"a", ",", "m"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.683213719921734*^9, 3.683213773822291*^9}, {
   3.6832182359567204`*^9, 3.683218271839697*^9}, 3.6832190294842663`*^9, 
   3.6832271744595623`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dvmmdt", "[", "ei_", "]"}], ":=", 
   RowBox[{
    RowBox[{"dvmmdt1", "[", "ei", "]"}], "+", 
    RowBox[{"dvmmdt2", "[", "ei", "]"}], "+", 
    RowBox[{"dvmmdt3", "[", "ei", "]"}], "+", 
    RowBox[{"dvmmdt4", "[", "ei", "]"}], "+", 
    RowBox[{"dvmmdt5", "[", "ei", "]"}], "+", 
    RowBox[{"dvmmdt6", "[", "ei", "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.683218278288801*^9, 3.683218309191255*^9}, {
  3.6832185168692217`*^9, 3.68321852724966*^9}, {3.683227169531499*^9, 
  3.6832271732217007`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Find equilibrium reproductive values", "Subsection",
 CellChangeTimes->{{3.683218435956686*^9, 3.683218443140956*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rvsys", "=", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"dvmmdt", "[", "ei", "]"}], "\[Equal]", "0"}], ",", 
        RowBox[{
         RowBox[{"dvaadt", "[", "ei", "]"}], "\[Equal]", "0"}], ",", 
        RowBox[{
         RowBox[{"dvamdt", "[", "ei", "]"}], "\[Equal]", "0"}], ",", 
        RowBox[{
         RowBox[{"dvmadt", "[", "ei", "]"}], "\[Equal]", "0"}]}], "}"}], ",", 
      
      RowBox[{"{", 
       RowBox[{"ei", ",", "1", ",", "2"}], "}"}]}], "]"}], "//", 
    "Flatten"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.683218445813548*^9, 3.6832184889190693`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rvconstraint", "=", 
   RowBox[{
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{"ei", ",", "a", ",", "a"}], "]"}], 
        RowBox[{"v", "[", 
         RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], "+", 
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{"ei", ",", "m", ",", "m"}], "]"}], 
        RowBox[{"v", "[", 
         RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], "+", 
       RowBox[{
        FractionBox["1", "2"], 
        RowBox[{"f", "[", 
         RowBox[{"ei", ",", "a", ",", "m"}], "]"}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "+", 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}], ")"}]}]}], ",", 
      RowBox[{"{", 
       RowBox[{"ei", ",", "1", ",", "2"}], "}"}]}], "]"}], "\[Equal]", 
    "1"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.683218565414443*^9, 3.683218651929019*^9}, {
  3.6832201537093763`*^9, 3.68322017417721*^9}, {3.685007551305884*^9, 
  3.6850075767270184`*^9}}],

Cell[CellGroupData[{

Cell[BoxData["rvconstraint"], "Input",
 CellChangeTimes->{{3.683220139552684*^9, 3.68322014428004*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "a"}], "]"}], " ", 
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "a", ",", "a"}], "]"}]}], "+", 
   RowBox[{
    FractionBox["1", "2"], " ", 
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "m"}], "]"}], " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{"1", ",", "a", ",", "m"}], "]"}], "+", 
      RowBox[{"v", "[", 
       RowBox[{"1", ",", "m", ",", "a"}], "]"}]}], ")"}]}], "+", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "m", ",", "m"}], "]"}], " ", 
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "m", ",", "m"}], "]"}]}], "+", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "a"}], "]"}], " ", 
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "a", ",", "a"}], "]"}]}], "+", 
   RowBox[{
    FractionBox["1", "2"], " ", 
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "m"}], "]"}], " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{"2", ",", "a", ",", "m"}], "]"}], "+", 
      RowBox[{"v", "[", 
       RowBox[{"2", ",", "m", ",", "a"}], "]"}]}], ")"}]}], "+", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "m", ",", "m"}], "]"}], " ", 
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "m", ",", "m"}], "]"}]}]}], "\[Equal]", 
  "1"}]], "Output",
 CellChangeTimes->{
  3.683220144689172*^9, 3.6832201784812193`*^9, 3.68322061962683*^9, 
   3.683220691624185*^9, 3.683221739590584*^9, 3.6832272192975597`*^9, 
   3.683227253672536*^9, 3.684999304334524*^9, {3.68500756073915*^9, 
   3.685007580634136*^9}, 3.685008324204123*^9, 3.685008495781111*^9, 
   3.685009968522624*^9, 3.685011904466653*^9, 3.685012148507814*^9, 
   3.685012778009078*^9, 3.6850129687739697`*^9, 3.685013034178965*^9, 
   3.685013128468617*^9, 3.685013245846919*^9, 3.685013601092149*^9, 
   3.685013683560832*^9, 3.685013776555921*^9, 3.685074880963729*^9, 
   3.685075736890358*^9, 3.685075869879331*^9, 3.685075980476068*^9, 
   3.685076066920776*^9, 3.685076250270548*^9, 3.68507635069657*^9, 
   3.685076432407044*^9, 3.685076814358395*^9, 3.685076899309168*^9, 
   3.685077300764921*^9, 3.68507735730202*^9, 3.685077413248564*^9, 
   3.685086648156271*^9, 3.685092454021798*^9, 3.685092916560483*^9, 
   3.685092960260188*^9, 3.685093414529076*^9, 3.685094211803638*^9, 
   3.685094964843175*^9, 3.685095987464802*^9, 3.6850960275264883`*^9, 
   3.68509626122556*^9, 3.685099457180242*^9, 3.6851046493127117`*^9, 
   3.685104835636804*^9, 3.685104994399272*^9, 3.6851065047456017`*^9, {
   3.685192975488578*^9, 3.685193025675151*^9}, 3.685193259710915*^9, 
   3.685195602468197*^9, 3.685204727560247*^9, 3.685204762310638*^9, 
   3.685205504073303*^9, {3.685212299337327*^9, 3.6852123231885843`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"rvsys1", "=", 
   RowBox[{"ReplacePart", "[", 
    RowBox[{"rvsys", ",", 
     RowBox[{"1", "\[Rule]", "rvconstraint"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rvsys2", "=", 
   RowBox[{"ReplacePart", "[", 
    RowBox[{"rvsys", ",", 
     RowBox[{"5", "\[Rule]", "rvconstraint"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rvinit", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"rvali", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"rvali", ",", "rvals"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"rvinittest", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"rvali", "\[Rule]", "1"}], ",", 
    RowBox[{"{", 
     RowBox[{"rvali", ",", "rvals"}], "}"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.683218669983214*^9, 3.683218692556246*^9}, {
  3.683218752833969*^9, 3.68321877334536*^9}, {3.68321883761534*^9, 
  3.6832188536637487`*^9}, {3.6849992946119757`*^9, 3.6849992947318983`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "a", ",", "a"}], "]"}], "\[Rule]", "1"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "a", ",", "m"}], "]"}], "\[Rule]", "1"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "m", ",", "a"}], "]"}], "\[Rule]", "1"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "m", ",", "m"}], "]"}], "\[Rule]", "1"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "a", ",", "a"}], "]"}], "\[Rule]", "1"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "a", ",", "m"}], "]"}], "\[Rule]", "1"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "m", ",", "a"}], "]"}], "\[Rule]", "1"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "m", ",", "m"}], "]"}], "\[Rule]", "1"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.6832188545809517`*^9, 3.68321903640269*^9, 3.6832201208770123`*^9, 
   3.6832201785361567`*^9, 3.683220619666597*^9, 3.683220691663301*^9, 
   3.683221739647336*^9, 3.683227219348284*^9, 3.6832272537120953`*^9, 
   3.684999304339632*^9, {3.685007560786059*^9, 3.685007580641615*^9}, 
   3.6850083242777033`*^9, 3.685008495787641*^9, 3.685009968678939*^9, 
   3.685011904528977*^9, 3.6850121485151043`*^9, 3.685012778016477*^9, 
   3.6850129687807198`*^9, 3.685013034185869*^9, 3.685013128477092*^9, 
   3.6850132458537493`*^9, 3.6850136010986757`*^9, 3.685013683567915*^9, 
   3.685013776562566*^9, 3.685074880969589*^9, 3.685075736971559*^9, 
   3.6850758698887997`*^9, 3.685075980529332*^9, 3.685076066998007*^9, 
   3.6850762502769403`*^9, 3.685076350770644*^9, 3.685076432479941*^9, 
   3.6850768143647614`*^9, 3.685076899315483*^9, 3.685077300772057*^9, 
   3.685077357308679*^9, 3.685077413313024*^9, 3.685086648163258*^9, 
   3.6850924540285273`*^9, 3.685092916567473*^9, 3.6850929602671328`*^9, 
   3.685093414592883*^9, 3.685094211810199*^9, 3.6850949648931*^9, 
   3.685095987470986*^9, 3.6850960275330553`*^9, 3.6850962612323723`*^9, 
   3.685099457186511*^9, 3.685104649319562*^9, 3.6851048356432533`*^9, 
   3.685104994406191*^9, 3.6851065047524023`*^9, {3.685192975531331*^9, 
   3.685193025681736*^9}, 3.685193259717888*^9, 3.685195602508443*^9, 
   3.685204727584993*^9, 3.685204762342784*^9, 3.685205504104356*^9, {
   3.6852122993596992`*^9, 3.685212323209803*^9}}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"ansRVtest", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"mum_", ",", "mua_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"p1_", ",", "p2_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"ds_", ",", "ks_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"s1_", ",", "s2_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"zs1_", ",", "zs2_"}], "}"}], ",", 
    RowBox[{"{", "qs_", "}"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"rvsys1", "/.", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"mu", "[", "m", "]"}], "\[Rule]", "mum"}], ",", 
       RowBox[{
        RowBox[{"mu", "[", "a", "]"}], "\[Rule]", "mua"}], ",", 
       RowBox[{
        RowBox[{"p", "[", "1", "]"}], "\[Rule]", "p1"}], ",", 
       RowBox[{
        RowBox[{"p", "[", "2", "]"}], "\[Rule]", "p2"}], ",", 
       RowBox[{"d", "\[Rule]", "ds"}], ",", 
       RowBox[{"k", "\[Rule]", "ks"}], ",", 
       RowBox[{
        RowBox[{"s", "[", "1", "]"}], "\[Rule]", "s1"}], ",", 
       RowBox[{
        RowBox[{"s", "[", "2", "]"}], "\[Rule]", "s2"}], ",", 
       RowBox[{"q", "\[Rule]", "qs"}], ",", 
       RowBox[{
        RowBox[{"zs", "[", 
         RowBox[{"1", ",", "a"}], "]"}], "\[Rule]", "zs1"}], ",", 
       RowBox[{
        RowBox[{"zs", "[", 
         RowBox[{"2", ",", "a"}], "]"}], "\[Rule]", "zs2"}], ",", 
       RowBox[{
        RowBox[{"zs", "[", 
         RowBox[{"1", ",", "m"}], "]"}], "\[Rule]", "zs1"}], ",", 
       RowBox[{
        RowBox[{"zs", "[", 
         RowBox[{"2", ",", "m"}], "]"}], "\[Rule]", "zs2"}]}], "}"}]}], "/.", 
    
    RowBox[{"ans", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"mum", ",", "mua"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"p1", ",", "p2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"ds", ",", "ks"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"s1", ",", "s2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"zs1", ",", "zs2"}], "}"}], ",", 
      RowBox[{"{", "qs", "}"}]}], "]"}]}], "/.", "rvinittest"}]}]], "Input",
 CellChangeTimes->{{3.683218665145975*^9, 3.683218751018755*^9}, {
  3.683218834916465*^9, 3.683218865201235*^9}, {3.685192934094782*^9, 
  3.685192948044446*^9}, {3.6851929921427317`*^9, 3.685193023237453*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ansRV", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"mum_", ",", "mua_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"p1_", ",", "p2_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"ds_", ",", "ks_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"s1_", ",", "s2_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"zs1_", ",", "zs2_"}], "}"}], ",", 
    RowBox[{"{", "qs_", "}"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"FindRoot", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"rvsys1", "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"mu", "[", "m", "]"}], "\[Rule]", "mum"}], ",", 
        RowBox[{
         RowBox[{"mu", "[", "a", "]"}], "\[Rule]", "mua"}], ",", 
        RowBox[{
         RowBox[{"p", "[", "1", "]"}], "\[Rule]", "p1"}], ",", 
        RowBox[{
         RowBox[{"p", "[", "2", "]"}], "\[Rule]", "p2"}], ",", 
        RowBox[{"d", "\[Rule]", "ds"}], ",", 
        RowBox[{"k", "\[Rule]", "ks"}], ",", 
        RowBox[{
         RowBox[{"s", "[", "1", "]"}], "\[Rule]", "s1"}], ",", 
        RowBox[{
         RowBox[{"s", "[", "2", "]"}], "\[Rule]", "s2"}], ",", 
        RowBox[{"q", "\[Rule]", "qs"}], ",", 
        RowBox[{
         RowBox[{"zs", "[", 
          RowBox[{"1", ",", "a"}], "]"}], "\[Rule]", "zs1"}], ",", 
        RowBox[{
         RowBox[{"zs", "[", 
          RowBox[{"2", ",", "a"}], "]"}], "\[Rule]", "zs2"}], ",", 
        RowBox[{
         RowBox[{"zs", "[", 
          RowBox[{"1", ",", "m"}], "]"}], "\[Rule]", "zs1"}], ",", 
        RowBox[{
         RowBox[{"zs", "[", 
          RowBox[{"2", ",", "m"}], "]"}], "\[Rule]", "zs2"}]}], "}"}]}], "/.", 
     RowBox[{"ans", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"mum", ",", "mua"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p1", ",", "p2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"ds", ",", "ks"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"s1", ",", "s2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"zs1", ",", "zs2"}], "}"}], ",", 
       RowBox[{"{", "qs", "}"}]}], "]"}]}], ",", "rvinit"}], "]"}]}]], "Input",\

 CellChangeTimes->{{3.683218665145975*^9, 3.683218751018755*^9}, {
   3.685076741218316*^9, 3.6850767416128807`*^9}, 3.685077402475966*^9, {
   3.685192938956091*^9, 3.6851929539738503`*^9}, {3.6851929948325367`*^9, 
   3.685193020365487*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ansRValt", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"mum_", ",", "mua_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"p1_", ",", "p2_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"ds_", ",", "ks_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"s1_", ",", "s2_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"zs1_", ",", "zs2_"}], "}"}], ",", 
    RowBox[{"{", "qs_", "}"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"FindRoot", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"rvsys2", "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"mu", "[", "m", "]"}], "\[Rule]", "mum"}], ",", 
        RowBox[{
         RowBox[{"mu", "[", "a", "]"}], "\[Rule]", "mua"}], ",", 
        RowBox[{
         RowBox[{"p", "[", "1", "]"}], "\[Rule]", "p1"}], ",", 
        RowBox[{
         RowBox[{"p", "[", "2", "]"}], "\[Rule]", "p2"}], ",", 
        RowBox[{"d", "\[Rule]", "ds"}], ",", 
        RowBox[{"k", "\[Rule]", "ks"}], ",", 
        RowBox[{"q", "\[Rule]", "qs"}], ",", 
        RowBox[{
         RowBox[{"s", "[", "1", "]"}], "\[Rule]", "s1"}], ",", 
        RowBox[{
         RowBox[{"s", "[", "2", "]"}], "\[Rule]", "s2"}], ",", 
        RowBox[{
         RowBox[{"zs", "[", 
          RowBox[{"1", ",", "a"}], "]"}], "\[Rule]", "zs1"}], ",", 
        RowBox[{
         RowBox[{"zs", "[", 
          RowBox[{"2", ",", "a"}], "]"}], "\[Rule]", "zs2"}], ",", 
        RowBox[{
         RowBox[{"zs", "[", 
          RowBox[{"1", ",", "m"}], "]"}], "\[Rule]", "zs1"}], ",", 
        RowBox[{
         RowBox[{"zs", "[", 
          RowBox[{"2", ",", "m"}], "]"}], "\[Rule]", "zs2"}]}], "}"}]}], "/.", 
     RowBox[{"ans", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"mum", ",", "mua"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p1", ",", "p2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"ds", ",", "ks"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"s1", ",", "s2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"zs1", ",", "zs2"}], "}"}], ",", 
       RowBox[{"{", "qs", "}"}]}], "]"}]}], ",", "rvinit"}], "]"}]}]], "Input",\

 CellChangeTimes->{{3.683218665145975*^9, 3.683218751018755*^9}, {
   3.683218786439576*^9, 3.6832187887255096`*^9}, 3.68507648246799*^9, {
   3.685076592500215*^9, 3.6850766026439447`*^9}, {3.685076677377842*^9, 
   3.6850767271296663`*^9}, {3.68507738773538*^9, 3.685077388494813*^9}, {
   3.685192942331367*^9, 3.685192957668849*^9}, {3.685192997239044*^9, 
   3.685193017548779*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ansRVtest", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"2.0", ",", "1.0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.5", ",", "0.3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.2", ",", "0.8"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.8", ",", "0.3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.9", ",", "1.1"}], "}"}], ",", 
   RowBox[{"{", "0.5", "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.683218873277813*^9, 3.683218873656055*^9}, {
  3.685192960640976*^9, 3.6851929636481857`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "True", ",", "False", ",", "False", ",", "False", ",", "False", ",", 
   "False", ",", "False", ",", "False"}], "}"}]], "Output",
 CellChangeTimes->{
  3.683218874144144*^9, 3.6832190364721212`*^9, 3.6832201209993773`*^9, 
   3.683220178615947*^9, 3.683220619725257*^9, 3.6832206917760878`*^9, 
   3.683221739749207*^9, 3.6832272194343576`*^9, 3.683227253769411*^9, 
   3.684999304408547*^9, {3.685007561018939*^9, 3.68500758071023*^9}, 
   3.685008324387042*^9, 3.685008495881473*^9, 3.685009968800858*^9, 
   3.685011904704999*^9, 3.685012148679532*^9, 3.685012778113874*^9, 
   3.685012968874452*^9, 3.685013034312097*^9, 3.685013128611377*^9, 
   3.6850132459447393`*^9, 3.6850136012621803`*^9, 3.685013683781107*^9, 
   3.685013776661097*^9, 3.6850748810553713`*^9, 3.685075737112479*^9, 
   3.685075869984694*^9, 3.685075980593357*^9, 3.685076067079996*^9, 
   3.685076250374567*^9, 3.685076350856353*^9, 3.685076432591117*^9, 
   3.685076814663559*^9, 3.685076899523671*^9, 3.685077301002405*^9, 
   3.685077357505937*^9, 3.6850774134127283`*^9, 3.685086648278191*^9, 
   3.685092454086556*^9, 3.6850929166298447`*^9, 3.685092960349992*^9, 
   3.6850934146869*^9, 3.685094211870625*^9, 3.6850949649554863`*^9, 
   3.685095987535314*^9, 3.6850960275877943`*^9, 3.68509626129453*^9, 
   3.685099457253635*^9, 3.685104649450333*^9, 3.685104835686841*^9, 
   3.68510499445448*^9, 3.685106504790185*^9, {3.685192975810932*^9, 
   3.685193025873804*^9}, 3.6851932597601013`*^9, 3.6851956026002502`*^9, 
   3.6852047277051363`*^9, 3.685204762391345*^9, 3.6852055041571417`*^9, {
   3.685212299477137*^9, 3.685212323332427*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"ansRV", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"2.0", ",", "1.0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.2", ",", "0.5"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.5", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.25", ",", "0.5"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1.3", ",", "1.0"}], "}"}], ",", 
   RowBox[{"{", "0.5", "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"ansRValt", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"2.0", ",", "1.0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.2", ",", "0.5"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.5", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.25", ",", "0.5"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1.3", ",", "1.0"}], "}"}], ",", 
   RowBox[{"{", "0.5", "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.683218791144472*^9, 3.68321881675943*^9}, {
  3.683220240564694*^9, 3.683220265978046*^9}, {3.683221745978207*^9, 
  3.683221765136077*^9}, {3.683223041647821*^9, 3.6832230431599407`*^9}, {
  3.6832232866130867`*^9, 3.683223293010501*^9}, {3.683225070973336*^9, 
  3.683225147319675*^9}, {3.683225318184423*^9, 3.683225339070293*^9}, {
  3.68322605298405*^9, 3.683226054412612*^9}, {3.683227258295527*^9, 
  3.683227259794919*^9}, {3.6850012352805843`*^9, 3.685001289517128*^9}, {
  3.685001632534926*^9, 3.685001719569219*^9}, {3.685003121515428*^9, 
  3.685003124570496*^9}, {3.6850040109748507`*^9, 3.685004023541325*^9}, {
  3.685004572899461*^9, 3.685004574433919*^9}, {3.685013868602181*^9, 
  3.685013871573415*^9}, {3.6850760977958*^9, 3.68507610259337*^9}, {
  3.685086654361416*^9, 3.685086656284997*^9}, {3.68519296540308*^9, 
  3.685192970868773*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "a", ",", "a"}], "]"}], "\[Rule]", 
    "1.0923692188220029`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "a", ",", "m"}], "]"}], "\[Rule]", 
    "1.1644365535007482`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "m", ",", "a"}], "]"}], "\[Rule]", 
    "0.817765083135168`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "m", ",", "m"}], "]"}], "\[Rule]", 
    "0.8837491051942825`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "a", ",", "a"}], "]"}], "\[Rule]", 
    "1.0688112730520272`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "a", ",", "m"}], "]"}], "\[Rule]", 
    "1.1257081618536686`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "m", ",", "a"}], "]"}], "\[Rule]", 
    "0.8679254998977237`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "m", ",", "m"}], "]"}], "\[Rule]", 
    "0.919882576277778`"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.683218820594281*^9, 3.683219036538414*^9, 3.6832201210484467`*^9, 
   3.683220178660267*^9, {3.683220243331518*^9, 3.68322026642449*^9}, 
   3.6832206197784853`*^9, 3.6832206918673563`*^9, {3.68322173979817*^9, 
   3.683221765871894*^9}, 3.683223044105772*^9, 3.683223293554968*^9, {
   3.683225075516869*^9, 3.683225147727189*^9}, {3.683225306508679*^9, 
   3.6832253405572767`*^9}, 3.6832260550052843`*^9, 3.683227219481246*^9, {
   3.683227253815124*^9, 3.683227260441658*^9}, 3.684999304466107*^9, {
   3.685001239520643*^9, 3.685001289913117*^9}, {3.685001636255218*^9, 
   3.6850016898553534`*^9}, 3.685001720077265*^9, 3.685003125687276*^9, {
   3.6850040125683928`*^9, 3.685004024006283*^9}, 3.685004574915371*^9, {
   3.6850075610787354`*^9, 3.6850075807699127`*^9}, 3.685008324460988*^9, 
   3.685008495957425*^9, 3.685009968877183*^9, 3.685011904769116*^9, 
   3.685012148764875*^9, 3.685012778238905*^9, 3.6850129689468946`*^9, 
   3.685013034369719*^9, 3.6850131286783133`*^9, 3.685013245999984*^9, 
   3.6850136013315697`*^9, 3.685013683844363*^9, 3.685013776743338*^9, 
   3.685013872164398*^9, 3.6850748811368*^9, 3.68507573721169*^9, 
   3.685075870052024*^9, 3.6850759806634417`*^9, 3.685076067161109*^9, 
   3.685076103168672*^9, 3.6850762504763403`*^9, 3.685076350932088*^9, 
   3.685076432671363*^9, {3.68507673274279*^9, 3.6850767463019037`*^9}, 
   3.68507681473674*^9, 3.685076899593635*^9, 3.685077301071898*^9, 
   3.685077357759632*^9, 3.6850774134896383`*^9, {3.6850866483626957`*^9, 
   3.685086656842175*^9}, 3.685092454134088*^9, 3.6850929166825953`*^9, 
   3.685092960422985*^9, 3.6850934147612963`*^9, 3.6850942119239273`*^9, 
   3.685094965012038*^9, 3.685095987587926*^9, 3.68509602763247*^9, 
   3.6850962613393717`*^9, 3.6850994573073063`*^9, 3.685104649496861*^9, 
   3.685104835720983*^9, 3.6851049944884977`*^9, 3.685106504820263*^9, {
   3.68519297599457*^9, 3.685193025948532*^9}, 3.685193259790923*^9, 
   3.685195602667428*^9, 3.685204727742465*^9, 3.6852047624324093`*^9, 
   3.685205504187049*^9, {3.685212299509021*^9, 3.6852123233620234`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "a", ",", "a"}], "]"}], "\[Rule]", 
    "1.0923692188220029`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "a", ",", "m"}], "]"}], "\[Rule]", 
    "1.1644365535007482`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "m", ",", "a"}], "]"}], "\[Rule]", 
    "0.8177650831351679`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "m", ",", "m"}], "]"}], "\[Rule]", 
    "0.8837491051942823`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "a", ",", "a"}], "]"}], "\[Rule]", 
    "1.0688112730520272`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "a", ",", "m"}], "]"}], "\[Rule]", 
    "1.1257081618536686`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "m", ",", "a"}], "]"}], "\[Rule]", 
    "0.8679254998977237`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "m", ",", "m"}], "]"}], "\[Rule]", 
    "0.9198825762777784`"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.683218820594281*^9, 3.683219036538414*^9, 3.6832201210484467`*^9, 
   3.683220178660267*^9, {3.683220243331518*^9, 3.68322026642449*^9}, 
   3.6832206197784853`*^9, 3.6832206918673563`*^9, {3.68322173979817*^9, 
   3.683221765871894*^9}, 3.683223044105772*^9, 3.683223293554968*^9, {
   3.683225075516869*^9, 3.683225147727189*^9}, {3.683225306508679*^9, 
   3.6832253405572767`*^9}, 3.6832260550052843`*^9, 3.683227219481246*^9, {
   3.683227253815124*^9, 3.683227260441658*^9}, 3.684999304466107*^9, {
   3.685001239520643*^9, 3.685001289913117*^9}, {3.685001636255218*^9, 
   3.6850016898553534`*^9}, 3.685001720077265*^9, 3.685003125687276*^9, {
   3.6850040125683928`*^9, 3.685004024006283*^9}, 3.685004574915371*^9, {
   3.6850075610787354`*^9, 3.6850075807699127`*^9}, 3.685008324460988*^9, 
   3.685008495957425*^9, 3.685009968877183*^9, 3.685011904769116*^9, 
   3.685012148764875*^9, 3.685012778238905*^9, 3.6850129689468946`*^9, 
   3.685013034369719*^9, 3.6850131286783133`*^9, 3.685013245999984*^9, 
   3.6850136013315697`*^9, 3.685013683844363*^9, 3.685013776743338*^9, 
   3.685013872164398*^9, 3.6850748811368*^9, 3.68507573721169*^9, 
   3.685075870052024*^9, 3.6850759806634417`*^9, 3.685076067161109*^9, 
   3.685076103168672*^9, 3.6850762504763403`*^9, 3.685076350932088*^9, 
   3.685076432671363*^9, {3.68507673274279*^9, 3.6850767463019037`*^9}, 
   3.68507681473674*^9, 3.685076899593635*^9, 3.685077301071898*^9, 
   3.685077357759632*^9, 3.6850774134896383`*^9, {3.6850866483626957`*^9, 
   3.685086656842175*^9}, 3.685092454134088*^9, 3.6850929166825953`*^9, 
   3.685092960422985*^9, 3.6850934147612963`*^9, 3.6850942119239273`*^9, 
   3.685094965012038*^9, 3.685095987587926*^9, 3.68509602763247*^9, 
   3.6850962613393717`*^9, 3.6850994573073063`*^9, 3.685104649496861*^9, 
   3.685104835720983*^9, 3.6851049944884977`*^9, 3.685106504820263*^9, {
   3.68519297599457*^9, 3.685193025948532*^9}, 3.685193259790923*^9, 
   3.685195602667428*^9, 3.685204727742465*^9, 3.6852047624324093`*^9, 
   3.685205504187049*^9, {3.685212299509021*^9, 3.6852123233842897`*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Export reproductive value equations to C\
\>", "Subsection",
 CellChangeTimes->{{3.685194333961053*^9, 3.685194337792637*^9}, {
  3.685203438213744*^9, 3.685203466531927*^9}, {3.685204183114839*^9, 
  3.6852042030657663`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rvsysRHS", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "a"}], "]"}], "+", 
          RowBox[{"eul", " ", "*", " ", 
           RowBox[{"dvaadt", "[", "ei", "]"}]}]}], ",", 
         RowBox[{
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "+", 
          RowBox[{"eul", " ", "*", " ", 
           RowBox[{"dvamdt", "[", "ei", "]"}]}]}], ",", 
         RowBox[{
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "a"}], "]"}], "+", 
          RowBox[{"eul", "*", 
           RowBox[{"dvmadt", "[", "ei", "]"}]}]}], ",", 
         RowBox[{
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "m"}], "]"}], "+", 
          RowBox[{"eul", "*", 
           RowBox[{"dvmmdt", "[", "ei", "]"}]}]}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"ei", ",", "1", ",", "2"}], "}"}]}], "]"}], "/.", 
     "subslist"}], "//", "Flatten"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.685195465240106*^9, 3.6851954823424053`*^9}, {
  3.685204130383412*^9, 3.6852041335421543`*^9}, {3.685204232937972*^9, 
  3.68520425585082*^9}, {3.6852043923670053`*^9, 3.68520440343507*^9}, {
  3.6852116911291113`*^9, 3.685211726420169*^9}}],

Cell[TextData[{
 "Add constraint to system of equations, by means of ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     SubscriptBox["v", 
      RowBox[{"t", "+", "1"}]], "[", 
     RowBox[{"2", ",", "m", ",", "m"}], "]"}], "=", "something"}], 
   TraditionalForm]],
  FormatType->"TraditionalForm"],
 "."
}], "Text",
 CellChangeTimes->{{3.685212120257264*^9, 3.685212149928454*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rvsysRHS", "=", 
   RowBox[{
    RowBox[{"ReplacePart", "[", 
     RowBox[{"rvsysRHS", ",", 
      RowBox[{
       RowBox[{"-", "1"}], "\[Rule]", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"v", "[", 
            RowBox[{"2", ",", "m", ",", "m"}], "]"}], "/.", 
           RowBox[{"Solve", "[", 
            RowBox[{"rvconstraint", ",", 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", "m"}], "]"}]}], "]"}]}], ")"}], "/.", 
         RowBox[{"v", "\[Rule]", "vtplus1"}]}], ")"}]}]}], "]"}], "//", 
    "Flatten"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.685211821926579*^9, 3.68521184383467*^9}, {
   3.6852119148561153`*^9, 3.685212008292207*^9}, 3.6852121744269876`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"strRVfreq", "=", 
   RowBox[{"recur2c", "[", 
    RowBox[{
    "rvalstplus1", ",", "rvsysRHS", ",", "rvals", ",", "bound0", ",", 
     "True"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.685211341946301*^9, 3.6852113832257557`*^9}, {
  3.6852116733493423`*^9, 3.685211676722521*^9}, {3.685211752090807*^9, 
  3.6852117528969297`*^9}, {3.685211858148755*^9, 3.6852118667302027`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
    RowBox[{"cdir", "<>", "\"\<repvals.txt\>\""}], ",", "strRVfreq"}], "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.685203492229539*^9, 3.685203532381892*^9}, 
   3.685203673044236*^9, 3.68520402268504*^9, 3.685204062963731*^9, {
   3.6852047183459063`*^9, 3.685204723492091*^9}, 3.6852123650785437`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Relatedness", "Section",
 CellChangeTimes->{{3.683226072084312*^9, 3.6832260732677393`*^9}}],

Cell[CellGroupData[{

Cell["Relatedness between two adapted breeders in environment ei", \
"Subsection",
 CellChangeTimes->{{3.6832263374238577`*^9, 3.683226346135641*^9}}],

Cell["Environmental change", "Text",
 CellChangeTimes->{{3.6832263306240892`*^9, 3.683226332943756*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"draadt1", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{
     RowBox[{"3", "-", "ei"}], ",", "m", ",", "m"}], "]"}], 
   RowBox[{"Exp", "[", 
    RowBox[{"q", " ", 
     RowBox[{"zs", "[", 
      RowBox[{
       RowBox[{"3", "-", "ei"}], ",", "m"}], "]"}]}], "]"}], 
   RowBox[{"s", "[", 
    RowBox[{"3", "-", "ei"}], "]"}], 
   RowBox[{"rmm", "[", 
    RowBox[{"3", "-", "ei"}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"draadt1dn", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{
     RowBox[{"3", "-", "ei"}], ",", "m", ",", "m"}], "]"}], 
   RowBox[{"Exp", "[", 
    RowBox[{"q", " ", 
     RowBox[{"zs", "[", 
      RowBox[{
       RowBox[{"3", "-", "ei"}], ",", "m"}], "]"}]}], "]"}], 
   RowBox[{"s", "[", 
    RowBox[{"3", "-", "ei"}], "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.6832261582550077`*^9, 3.683226162827078*^9}, {
  3.6832262684360447`*^9, 3.68322632821279*^9}, {3.683226847788888*^9, 
  3.683226854548562*^9}, {3.685098248886106*^9, 3.685098262182289*^9}, {
  3.685193079370141*^9, 3.68519308943296*^9}}],

Cell["\<\
Mortality adapted breeder on aa patch, replaced by adapted individual\
\>", "Text",
 CellChangeTimes->{{3.6832263495739717`*^9, 3.6832263569263363`*^9}, {
  3.685098517702417*^9, 3.685098522229147*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"draadt2", "[", "ei_", "]"}], ":=", 
  RowBox[{"2", 
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "a", ",", "a"}], "]"}], 
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{"p", "[", "1", "]"}], ",", 
     RowBox[{"1", "-", 
      RowBox[{"p", "[", "2", "]"}]}]}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "+", 
     RowBox[{"raa", "[", "ei", "]"}]}], ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"draadt2dn", "[", "ei_", "]"}], ":=", 
  RowBox[{"2", 
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "a", ",", "a"}], "]"}], 
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   RowBox[{"pa", "[", 
    RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.6832263579048767`*^9, 3.683226379255753*^9}, {
   3.683226816326398*^9, 3.683226870143228*^9}, {3.683226921548278*^9, 
   3.6832269308218307`*^9}, 3.683226967103812*^9, 3.683227162240233*^9, {
   3.685090823416366*^9, 3.685090826801281*^9}, {3.6850982841999903`*^9, 
   3.6850983315850267`*^9}, 3.6850985102130203`*^9, {3.685098554721959*^9, 
   3.685098587960403*^9}}],

Cell["\<\
Mortality maladapted breeder on a am patch, replaced by an adapted one\
\>", "Text",
 CellChangeTimes->{{3.683226873229813*^9, 3.683226885157148*^9}, {
  3.6832271433886547`*^9, 3.683227147601173*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"draadt3", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "a", ",", "m"}], "]"}], 
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{
      RowBox[{
       FractionBox["1", "2"], 
       RowBox[{"p", "[", "1", "]"}]}], "+", 
      RowBox[{
       FractionBox["1", "2"], 
       RowBox[{"p", "[", "2", "]"}], 
       RowBox[{"ram", "[", "ei", "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       FractionBox["1", "2"], 
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", "2", "]"}]}], ")"}]}], "+", 
      RowBox[{
       FractionBox["1", "2"], 
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", "1", "]"}]}], ")"}], 
       RowBox[{"ram", "[", "ei", "]"}]}]}]}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"draadt3dn", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "a", ",", "m"}], "]"}], 
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   RowBox[{"pa", "[", 
    RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.683226886366371*^9, 3.683227031097077*^9}, {
  3.685089557670961*^9, 3.685089557764073*^9}, {3.68509859470424*^9, 
  3.685098612263892*^9}, {3.685098669144052*^9, 3.6850986810473948`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"draadt", "[", "ei_", "]"}], ":=", 
  FractionBox[
   RowBox[{
    RowBox[{"draadt1", "[", "ei", "]"}], "+", 
    RowBox[{"draadt2", "[", "ei", "]"}], "+", 
    RowBox[{"draadt3", "[", "ei", "]"}]}], 
   RowBox[{
    RowBox[{"draadt1dn", "[", "ei", "]"}], "+", 
    RowBox[{"draadt2dn", "[", "ei", "]"}], "+", 
    RowBox[{"draadt3dn", "[", "ei", "]"}]}]]}]], "Input",
 CellChangeTimes->{{3.685089885269858*^9, 3.685089912820859*^9}, {
  3.685098704945978*^9, 3.685098727658578*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Relatedness between adapted and maladapted breeder in environment ei\
\>", "Subsection",
 CellChangeTimes->{{3.685089922087837*^9, 3.685089933927652*^9}}],

Cell["Environmental change", "Text",
 CellChangeTimes->{{3.685089996646222*^9, 3.6850899985026617`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dramdt1", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{
     RowBox[{"3", "-", "ei"}], ",", "a", ",", "m"}], "]"}], 
   RowBox[{"s", "[", 
    RowBox[{"3", "-", "ei"}], "]"}], 
   RowBox[{"Exp", "[", 
    RowBox[{"q", 
     FractionBox["1", "2"], 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"zs", "[", 
        RowBox[{
         RowBox[{"3", "-", "ei"}], ",", "m"}], "]"}], "+", 
       RowBox[{"zs", "[", 
        RowBox[{
         RowBox[{"3", "-", "ei"}], ",", "a"}], "]"}]}], ")"}]}], "]"}], 
   RowBox[{"ram", "[", 
    RowBox[{"3", "-", "ei"}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dramdt1dn", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{
     RowBox[{"3", "-", "ei"}], ",", "a", ",", "m"}], "]"}], 
   RowBox[{"s", "[", 
    RowBox[{"3", "-", "ei"}], "]"}], 
   RowBox[{"Exp", "[", 
    RowBox[{"q", 
     FractionBox["1", "2"], 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"zs", "[", 
        RowBox[{
         RowBox[{"3", "-", "ei"}], ",", "m"}], "]"}], "+", 
       RowBox[{"zs", "[", 
        RowBox[{
         RowBox[{"3", "-", "ei"}], ",", "a"}], "]"}]}], ")"}]}], 
    "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.685089934993133*^9, 3.685089982936509*^9}, {
  3.685096249234209*^9, 3.6850962510988398`*^9}, {3.685098738011876*^9, 
  3.685098752679182*^9}, {3.685099114024028*^9, 3.6850991164464827`*^9}, {
  3.685193095429319*^9, 3.685193103612153*^9}}],

Cell["\<\
Mortality maladapted breeder on mm patch, replaced by adapted breeder\
\>", "Text",
 CellChangeTimes->{{3.685090001966022*^9, 3.685090009717272*^9}, {
  3.6850900801327887`*^9, 3.685090087171279*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dramdt2", "[", "ei_", "]"}], ":=", 
  RowBox[{"2", 
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "m", ",", "m"}], "]"}], 
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{"p", "[", "2", "]"}], ",", 
     RowBox[{"(", 
      RowBox[{"1", "-", 
       RowBox[{"p", "[", "1", "]"}]}], ")"}]}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "+", 
     RowBox[{"rmm", "[", "ei", "]"}]}], ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dramdt2dn", "[", "ei_", "]"}], ":=", 
  RowBox[{"2", 
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "m", ",", "m"}], "]"}], 
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   RowBox[{"pa", "[", 
    RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.685089985071661*^9, 3.6850899936494904`*^9}, {
  3.6850900547451887`*^9, 3.6850901519150047`*^9}, {3.6850907620697308`*^9, 
  3.68509081803652*^9}, {3.6850909179049473`*^9, 3.685090922982024*^9}, {
  3.685090977740945*^9, 3.6850909778172398`*^9}, {3.68509875776523*^9, 
  3.68509878844495*^9}}],

Cell["\<\
Mortality adapted breeder on aa patch, replaced by maladapted breeder\
\>", "Text",
 CellChangeTimes->{{3.68509080476338*^9, 3.685090811796315*^9}, {
  3.6850909859687366`*^9, 3.68509099029506*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dramdt3", "[", "ei_", "]"}], ":=", 
  RowBox[{"2", " ", 
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "a", ",", "a"}], "]"}], 
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{"1", "-", 
      RowBox[{"p", "[", "1", "]"}]}], ",", 
     RowBox[{"p", "[", "2", "]"}]}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "+", 
     RowBox[{"raa", "[", "ei", "]"}]}], ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dramdt3dn", "[", "ei_", "]"}], ":=", 
  RowBox[{"2", " ", 
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "a", ",", "a"}], "]"}], 
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", 
     RowBox[{"pa", "[", 
      RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], ")"}]}]}]}], "Input",
 CellChangeTimes->{{3.685090932465214*^9, 3.685091014313404*^9}, {
  3.685098806451458*^9, 3.68509883276348*^9}, {3.685099621846566*^9, 
  3.6850996219343767`*^9}}],

Cell["\<\
Mortality maladapted breeder on am patch, replaced by maladapted breeder\
\>", "Text",
 CellChangeTimes->{{3.685091028166535*^9, 3.685091040605706*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dramdt4", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "a", ",", "m"}], "]"}], 
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{
      RowBox[{
       FractionBox["1", "2"], 
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", "1", "]"}]}], ")"}]}], "+", 
      RowBox[{
       FractionBox["1", "2"], 
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", "2", "]"}]}], ")"}], 
       RowBox[{"ram", "[", "ei", "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       FractionBox["1", "2"], 
       RowBox[{"p", "[", "1", "]"}], 
       RowBox[{"ram", "[", "ei", "]"}]}], "+", 
      RowBox[{
       FractionBox["1", "2"], 
       RowBox[{"p", "[", "2", "]"}]}]}]}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dramdt4dn", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "a", ",", "m"}], "]"}], 
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", 
     RowBox[{"pa", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], ")"}]}]}]}], "Input",
 CellChangeTimes->{{3.685091042465046*^9, 3.685091158952574*^9}, {
  3.6850988384220467`*^9, 3.685098855930152*^9}}],

Cell["\<\
Mortality adapted breeder on am patch, replaced by adapted breeder\
\>", "Text",
 CellChangeTimes->{{3.685091165883857*^9, 3.685091170194736*^9}, {
  3.68509127801775*^9, 3.685091286416214*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dramdt5", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "a", ",", "m"}], "]"}], 
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{
      RowBox[{
       FractionBox["1", "2"], 
       RowBox[{"p", "[", "1", "]"}], 
       RowBox[{"ram", "[", "ei", "]"}]}], "+", 
      RowBox[{
       FractionBox["1", "2"], 
       RowBox[{"p", "[", "2", "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       FractionBox["1", "2"], 
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", "1", "]"}]}], ")"}]}], "+", 
      RowBox[{
       FractionBox["1", "2"], 
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", "2", "]"}]}], ")"}], 
       RowBox[{"ram", "[", "ei", "]"}]}]}]}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dramdt5dn", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "a", ",", "m"}], "]"}], 
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   RowBox[{"pa", "[", 
    RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.685091287679926*^9, 3.6850913668868923`*^9}, {
  3.685098859038303*^9, 3.685098874761587*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dramdt", "[", "ei_", "]"}], ":=", 
  FractionBox[
   RowBox[{
    RowBox[{"dramdt1", "[", "ei", "]"}], "+", 
    RowBox[{"dramdt2", "[", "ei", "]"}], "+", 
    RowBox[{"dramdt3", "[", "ei", "]"}], "+", 
    RowBox[{"dramdt4", "[", "ei", "]"}], "+", 
    RowBox[{"dramdt5", "[", "ei", "]"}]}], 
   RowBox[{
    RowBox[{"dramdt1dn", "[", "ei", "]"}], "+", 
    RowBox[{"dramdt2dn", "[", "ei", "]"}], "+", 
    RowBox[{"dramdt3dn", "[", "ei", "]"}], "+", 
    RowBox[{"dramdt4dn", "[", "ei", "]"}], "+", 
    RowBox[{"dramdt5dn", "[", "ei", "]"}]}]]}]], "Input",
 CellChangeTimes->{{3.6850913966211987`*^9, 3.685091430427689*^9}, {
  3.685098879759472*^9, 3.685098903543779*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Relatedness between maladapted breeders in environment ei", "Subsection",
 CellChangeTimes->{{3.685091651384255*^9, 3.685091662719458*^9}}],

Cell["Environmental change ", "Text",
 CellChangeTimes->{{3.685091672735778*^9, 3.685091675151469*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"drmmdt1", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{
     RowBox[{"3", "-", "ei"}], ",", "a", ",", "a"}], "]"}], 
   RowBox[{"s", "[", 
    RowBox[{"3", "-", "ei"}], "]"}], 
   RowBox[{"Exp", "[", 
    RowBox[{"q", " ", 
     RowBox[{"zs", "[", 
      RowBox[{
       RowBox[{"3", "-", "ei"}], ",", "a"}], "]"}]}], "]"}], 
   RowBox[{"raa", "[", 
    RowBox[{"3", "-", "ei"}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"drmmdt1dn", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{
     RowBox[{"3", "-", "ei"}], ",", "a", ",", "a"}], "]"}], 
   RowBox[{"s", "[", 
    RowBox[{"3", "-", "ei"}], "]"}], 
   RowBox[{"Exp", "[", 
    RowBox[{"q", " ", 
     RowBox[{"zs", "[", 
      RowBox[{
       RowBox[{"3", "-", "ei"}], ",", "a"}], "]"}]}], "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.685091690650779*^9, 3.68509172666856*^9}, {
  3.685096239561246*^9, 3.6850962425777607`*^9}, {3.68509891406322*^9, 
  3.6850989257109413`*^9}, {3.6851931172564096`*^9, 3.685193126655311*^9}}],

Cell["\<\
Mortality adapted breeder on a am patch, replaced by maladapted breeder\
\>", "Text",
 CellChangeTimes->{{3.685091732470581*^9, 3.6850917692082443`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"drmmdt2", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "a", ",", "m"}], "]"}], 
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", "1", "]"}]}], ")"}], 
       RowBox[{"ram", "[", "ei", "]"}]}], "+", 
      RowBox[{"(", 
       RowBox[{"1", "-", 
        RowBox[{"p", "[", "2", "]"}]}], ")"}]}], ",", 
     RowBox[{
      RowBox[{"p", "[", "1", "]"}], "+", 
      RowBox[{
       RowBox[{"p", "[", "2", "]"}], 
       RowBox[{"ram", "[", "ei", "]"}]}]}]}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"drmmdt2dn", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "a", ",", "m"}], "]"}], 
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", 
     RowBox[{"pa", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], ")"}]}]}]}], "Input",
 CellChangeTimes->{{3.685091770257729*^9, 3.685091774744981*^9}, {
  3.6850919273919287`*^9, 3.685091969155692*^9}, {3.6850921769791603`*^9, 
  3.685092231617579*^9}, {3.685094944637187*^9, 3.685094946745343*^9}, {
  3.685098931338243*^9, 3.685098966113645*^9}}],

Cell["\<\
Mortality maladapted breeder on a mm patch, replaced by maladapted breeder\
\>", "Text",
 CellChangeTimes->{{3.68509223449899*^9, 3.6850922827052526`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"drmmdt3", "[", "ei_", "]"}], ":=", 
  RowBox[{"2", 
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "m", ",", "m"}], "]"}], 
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{"(", 
      RowBox[{"1", "-", 
       RowBox[{"p", "[", "2", "]"}]}], ")"}], ",", 
     RowBox[{"p", "[", "1", "]"}]}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "+", 
     RowBox[{"rmm", "[", "ei", "]"}]}], ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"drmmdt3dn", "[", "ei_", "]"}], ":=", 
  RowBox[{"2", 
   RowBox[{"f", "[", 
    RowBox[{"ei", ",", "m", ",", "m"}], "]"}], 
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", 
     RowBox[{"pa", "[", 
      RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], ")"}]}]}]}], "Input",
 CellChangeTimes->{{3.685092284100492*^9, 3.685092362495736*^9}, 
   3.685094185621488*^9, {3.6850989712965927`*^9, 3.685098981708987*^9}, {
   3.6850990164261017`*^9, 3.685099019886153*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"drmmdt", "[", "ei_", "]"}], ":=", 
  FractionBox[
   RowBox[{
    RowBox[{"drmmdt1", "[", "ei", "]"}], "+", 
    RowBox[{"drmmdt2", "[", "ei", "]"}], "+", 
    RowBox[{"drmmdt3", "[", "ei", "]"}]}], 
   RowBox[{
    RowBox[{"drmmdt1dn", "[", "ei", "]"}], "+", 
    RowBox[{"drmmdt2dn", "[", "ei", "]"}], "+", 
    RowBox[{"drmmdt3dn", "[", "ei", "]"}]}]]}]], "Input",
 CellChangeTimes->{{3.6850923895306797`*^9, 3.685092389706258*^9}, {
  3.685092427104746*^9, 3.685092450338788*^9}, {3.685099031930873*^9, 
  3.685099058297925*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Numerical solutions", "Subsection",
 CellChangeTimes->{{3.685204798302215*^9, 3.685204800036888*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"relsys", "=", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"draadt", "[", "ei", "]"}], "\[Equal]", 
         RowBox[{"raa", "[", "ei", "]"}]}], ",", 
        RowBox[{
         RowBox[{"dramdt", "[", "ei", "]"}], "\[Equal]", 
         RowBox[{"ram", "[", "ei", "]"}]}], ",", 
        RowBox[{
         RowBox[{"drmmdt", "[", "ei", "]"}], "\[Equal]", 
         RowBox[{"rmm", "[", "ei", "]"}]}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"ei", ",", "1", ",", "2"}], "}"}]}], "]"}], "//", 
    "Flatten"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6850926359834538`*^9, 3.685092668024541*^9}, {
  3.685092742056924*^9, 3.685092743292324*^9}, {3.6850929459744053`*^9, 
  3.685092956339739*^9}, {3.685099076227552*^9, 3.685099078977872*^9}, {
  3.6852048384139137`*^9, 3.685204839188608*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ansrel", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"mum_", ",", "mua_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"p1_", ",", "p2_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"ds_", ",", "ks_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"s1_", ",", "s2_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"zs1_", ",", "zs2_"}], "}"}], ",", 
    RowBox[{"{", "qs_", "}"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"FindRoot", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"relsys", "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"mu", "[", "m", "]"}], "\[Rule]", "mum"}], ",", 
        RowBox[{
         RowBox[{"mu", "[", "a", "]"}], "\[Rule]", "mua"}], ",", 
        RowBox[{
         RowBox[{"p", "[", "1", "]"}], "\[Rule]", "p1"}], ",", 
        RowBox[{
         RowBox[{"p", "[", "2", "]"}], "\[Rule]", "p2"}], ",", 
        RowBox[{"d", "\[Rule]", "ds"}], ",", 
        RowBox[{"k", "\[Rule]", "ks"}], ",", 
        RowBox[{
         RowBox[{"s", "[", "1", "]"}], "\[Rule]", "s1"}], ",", 
        RowBox[{
         RowBox[{"s", "[", "2", "]"}], "\[Rule]", "s2"}], ",", 
        RowBox[{"q", "\[Rule]", "qs"}], ",", 
        RowBox[{
         RowBox[{"zs", "[", 
          RowBox[{"1", ",", "a"}], "]"}], "\[Rule]", "zs1"}], ",", 
        RowBox[{
         RowBox[{"zs", "[", 
          RowBox[{"2", ",", "a"}], "]"}], "\[Rule]", "zs2"}], ",", 
        RowBox[{
         RowBox[{"zs", "[", 
          RowBox[{"1", ",", "m"}], "]"}], "\[Rule]", "zs1"}], ",", 
        RowBox[{
         RowBox[{"zs", "[", 
          RowBox[{"2", ",", "m"}], "]"}], "\[Rule]", "zs2"}]}], "}"}]}], "/.", 
     RowBox[{"ans", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"mum", ",", "mua"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p1", ",", "p2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"ds", ",", "ks"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"s1", ",", "s2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"zs1", ",", "zs2"}], "}"}], ",", 
       RowBox[{"{", "qs", "}"}]}], "]"}]}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"rmm", "[", "1", "]"}], ",", "0.1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"rmm", "[", "2", "]"}], ",", "0.1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ram", "[", "1", "]"}], ",", "0.1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ram", "[", "2", "]"}], ",", "0.1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"raa", "[", "1", "]"}], ",", "0.1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"raa", "[", "2", "]"}], ",", "0.1"}], "}"}]}], "}"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.685092747142345*^9, 3.685092767098814*^9}, {
  3.685092869369681*^9, 3.685092907163373*^9}, {3.685193133105699*^9, 
  3.685193145389797*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ansrel", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"2.0", ",", "1.0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.5", ",", "0.3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.1", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.3", ",", "0.1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"10", ",", "10"}], "}"}], ",", 
   RowBox[{"{", "0.5", "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.6850929707350483`*^9, 3.685092987561624*^9}, {
  3.685093328974547*^9, 3.685093330794835*^9}, {3.685193146739462*^9, 
  3.685193173868232*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"rmm", "[", "1", "]"}], "\[Rule]", "0.8257051649577959`"}], ",", 
   RowBox[{
    RowBox[{"rmm", "[", "2", "]"}], "\[Rule]", "0.8484551790711358`"}], ",", 
   RowBox[{
    RowBox[{"ram", "[", "1", "]"}], "\[Rule]", "0.7998541711235747`"}], ",", 
   RowBox[{
    RowBox[{"ram", "[", "2", "]"}], "\[Rule]", "0.799891413193792`"}], ",", 
   RowBox[{
    RowBox[{"raa", "[", "1", "]"}], "\[Rule]", "0.8481745574923306`"}], ",", 
   RowBox[{
    RowBox[{"raa", "[", "2", "]"}], "\[Rule]", "0.8255988246924791`"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.685092987930316*^9, 3.685093415247221*^9, 3.685093608148032*^9, 
   3.685094212309642*^9, 3.685094965536878*^9, 3.6850959877808847`*^9, 
   3.685096027978581*^9, 3.685096261765202*^9, {3.6850990904019547`*^9, 
   3.685099120204673*^9}, 3.685099457624255*^9, 3.685099640154479*^9, 
   3.685104649663999*^9, 3.685104835853153*^9, 3.685104994621853*^9, 
   3.685106504922574*^9, {3.6851931525827103`*^9, 3.685193174371293*^9}, 
   3.685193259914027*^9, 3.6852051763521833`*^9, 3.685205504351398*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Export relatedness equations to C\
\>", "Subsection",
 CellChangeTimes->{{3.685194333961053*^9, 3.685194337792637*^9}, {
  3.685203438213744*^9, 3.685203466531927*^9}, {3.685204183114839*^9, 
  3.6852042030657663`*^9}, {3.685204784135746*^9, 3.685204785270811*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"relsysC", "=", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"draadt", "[", "ei", "]"}], ",", 
        RowBox[{"dramdt", "[", "ei", "]"}], ",", 
        RowBox[{"drmmdt", "[", "ei", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"ei", ",", "1", ",", "2"}], "}"}]}], "]"}], "//", 
    "Flatten"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"relvals", "=", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"raa", "[", "ei", "]"}], ",", 
        RowBox[{"ram", "[", "ei", "]"}], ",", 
        RowBox[{"rmm", "[", "ei", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"ei", ",", "1", ",", "2"}], "}"}]}], "]"}], "//", 
    "Flatten"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.685195465240106*^9, 3.6851954823424053`*^9}, {
  3.685204130383412*^9, 3.6852041335421543`*^9}, {3.685204232937972*^9, 
  3.68520425585082*^9}, {3.6852043923670053`*^9, 3.68520440343507*^9}, {
  3.685204843520138*^9, 3.685204908380836*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Export patch frequency equations to C\
\>", "Subsection",
 CellChangeTimes->{{3.685194333961053*^9, 3.685194337792637*^9}, {
  3.685203438213744*^9, 3.685203466531927*^9}, {3.685204183114839*^9, 
  3.685204185013172*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"relvalstplus1", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"raatplus1", "[", "ei", "]"}], ",", 
        RowBox[{"ramtplus1", "[", "ei", "]"}], ",", 
        RowBox[{"rmmtplus", "[", "ei", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"ei", ",", "1", ",", "2"}], "}"}]}], "]"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.685212650400878*^9, 3.6852126583226337`*^9}, {
  3.685213235903267*^9, 3.685213243783313*^9}, {3.685213550514761*^9, 
  3.685213581096352*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"patchsysRHS", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"f", "[", 
           RowBox[{"ei", ",", "a", ",", "a"}], "]"}], "+", 
          RowBox[{"eul", " ", 
           RowBox[{"dfaadt", "[", "ei", "]"}]}]}], ",", 
         RowBox[{
          RowBox[{"f", "[", 
           RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "+", 
          RowBox[{"eul", " ", 
           RowBox[{"dfamdt", "[", "ei", "]"}]}]}], ",", 
         RowBox[{
          RowBox[{"f", "[", 
           RowBox[{"ei", ",", "m", ",", "m"}], "]"}], "+", 
          RowBox[{"eul", " ", 
           RowBox[{"dfmmdt", "[", "ei", "]"}]}]}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"ei", ",", "1", ",", "2"}], "}"}]}], "]"}], "/.", 
     "subslist"}], "//", "Flatten"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"patchsysRHS", "=", 
   RowBox[{
    RowBox[{"ReplacePart", "[", 
     RowBox[{"patchsysRHS", ",", 
      RowBox[{
       RowBox[{"-", "1"}], "\[Rule]", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"f", "[", 
           RowBox[{"2", ",", "m", ",", "m"}], "]"}], "/.", 
          RowBox[{"Solve", "[", 
           RowBox[{"dfdtconst", ",", 
            RowBox[{"f", "[", 
             RowBox[{"2", ",", "m", ",", "m"}], "]"}]}], "]"}]}], "/.", 
         RowBox[{"f", "\[Rule]", "ftplus1"}]}], ")"}]}]}], "]"}], "//", 
    "Flatten"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.685212665706449*^9, 3.685212716074629*^9}, {
  3.685212822871293*^9, 3.685212945561305*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"strpatchFreq", "=", 
   RowBox[{"recur2c", "[", 
    RowBox[{
    "patchvalstplus1", ",", "patchsysRHS", ",", "patches", ",", "bound01", 
     ",", "True"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6852129491915293`*^9, 3.685212972499621*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
    RowBox[{"cdir", "<>", "\"\<patchrecurs.txt\>\""}], ",", "strpatchFreq"}], 
   "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.685203492229539*^9, 3.685203532381892*^9}, 
   3.685203673044236*^9, 3.68520402268504*^9, 3.685204062963731*^9, 
   3.685213042041252*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"strRELFreq", "=", "\"\<\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"For", "[", 
   RowBox[{
    RowBox[{"iter", "=", "1"}], ",", 
    RowBox[{"iter", "\[LessEqual]", 
     RowBox[{"Length", "[", "relvals", "]"}]}], ",", 
    RowBox[{"iter", "++"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"strRELFreq", "=", 
      RowBox[{"strRELFreq", "<>", "\"\<double \>\"", "<>", 
       RowBox[{"tc", "[", 
        RowBox[{"relvals", "[", 
         RowBox[{"[", "iter", "]"}], "]"}], "]"}], "<>", 
       "\"\<tplus1;\\n\\n\>\""}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"strRELFreq", "=", 
   RowBox[{
   "strRELFreq", "<>", 
    "\"\<for (int iter = 0; iter<1e08; ++iter) {\\n\\n\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"iter", "=", "1"}], ",", 
   RowBox[{"iter", "\[LessEqual]", 
    RowBox[{"Length", "[", "relvals", "]"}]}], ",", 
   RowBox[{"iter", "++"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"strRELFreq", "=", 
     RowBox[{"strRELFreq", "<>", 
      RowBox[{"tc", "[", 
       RowBox[{"relvals", "[", 
        RowBox[{"[", "iter", "]"}], "]"}], "]"}], "<>", 
      "\"\<tplus1 = bound0(\>\"", "<>", 
      RowBox[{"tc", "[", 
       RowBox[{"relvals", "[", 
        RowBox[{"[", "iter", "]"}], "]"}], "]"}], "<>", "\"\< + eul * (\>\"", 
      "<>", 
      RowBox[{"tc", "[", 
       RowBox[{"relsysC", "[", 
        RowBox[{"[", "iter", "]"}], "]"}], "]"}], "<>", 
      "\"\<));\\n\\n\>\""}]}], ";"}]}], "\[IndentingNewLine]", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"iter", "=", "1"}], ",", 
   RowBox[{"iter", "\[LessEqual]", 
    RowBox[{"Length", "[", "relvals", "]"}]}], ",", 
   RowBox[{"iter", "++"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"strRELFreq", "=", 
     RowBox[{"strRELFreq", "<>", 
      RowBox[{"tc", "[", 
       RowBox[{"relvals", "[", 
        RowBox[{"[", "iter", "]"}], "]"}], "]"}], "<>", "\"\<=\>\"", "<>", 
      RowBox[{"tc", "[", 
       RowBox[{"relvals", "[", 
        RowBox[{"[", "iter", "]"}], "]"}], "]"}], "<>", 
      "\"\<tplus1;\\n\\n\>\""}]}], ";"}]}], "\[IndentingNewLine]", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"strRELFreq", "=", 
   RowBox[{"strRELFreq", "<>", "\"\<}\\n\\n\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"iter", "=", "1"}], ",", 
   RowBox[{"iter", "\[LessEqual]", 
    RowBox[{"Length", "[", "relvals", "]"}]}], ",", 
   RowBox[{"iter", "++"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"strRELFreq", "=", 
     RowBox[{
      RowBox[{"strRELFreq", "<>", "\"\<gsl_vector_set(f,\>\""}], 
      RowBox[{"tc", "[", 
       RowBox[{"iter", "-", "1"}], "]"}], 
      RowBox[{"\"\<,\>\"", "<>", 
       RowBox[{"tc", "[", 
        RowBox[{"relvals", "[", 
         RowBox[{"[", "iter", "]"}], "]"}], "]"}], "<>", 
       "\"\<);\\n\\n\>\""}]}]}], ";"}]}], "\[IndentingNewLine]", 
  "]"}]}], "Input",
 CellChangeTimes->{{3.685194339703689*^9, 3.68519439772134*^9}, {
   3.685194569763988*^9, 3.685194580323552*^9}, {3.6851946981927567`*^9, 
   3.685194850274843*^9}, {3.6851949211006527`*^9, 3.6851951448539124`*^9}, {
   3.6851951798061934`*^9, 3.685195304572442*^9}, {3.68519542709031*^9, 
   3.6851954319303493`*^9}, 3.685195488170581*^9, {3.685195523444703*^9, 
   3.685195524193801*^9}, {3.685204423160718*^9, 3.6852044659740057`*^9}, {
   3.685204498995893*^9, 3.685204565372795*^9}, {3.685204689176736*^9, 
   3.685204710551108*^9}, 3.6852047592671843`*^9, {3.685204879172587*^9, 
   3.6852048812343616`*^9}, {3.6852049128309526`*^9, 3.685204933064886*^9}, {
   3.685205041783862*^9, 3.685205150745636*^9}, {3.685206155325116*^9, 
   3.685206261085876*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
    RowBox[{"cdir", "<>", "\"\<relvals.txt\>\""}], ",", "strRELFreq"}], "]"}],
   ";"}]], "Input",
 CellChangeTimes->{{3.685203492229539*^9, 3.685203532381892*^9}, 
   3.685203673044236*^9, 3.68520402268504*^9, 3.685204062963731*^9, {
   3.6852047183459063`*^9, 3.685204723492091*^9}, {3.685205154970559*^9, 
   3.685205172138235*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Selection gradient p1, p2", "Section",
 CellChangeTimes->{{3.682844962098281*^9, 3.6828449638582706`*^9}, {
  3.685099872496736*^9, 3.685099875478538*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rvals", "=", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{"ex", ",", "statex1", ",", "statex2"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"statex1", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"statex2", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}]}], "]"}], "//", 
    "Flatten"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.683200086190008*^9, 3.683200155658983*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rvalsTest", "=", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"v", "[", 
        RowBox[{"2", ",", "statex1", ",", "statex2"}], "]"}], "\[Rule]", 
       RowBox[{"v", "[", 
        RowBox[{"1", ",", "statex1", ",", "statex2"}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"statex1", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"statex2", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}]}], "]"}], "//", 
    "Flatten"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6832001606051397`*^9, 3.683200179314473*^9}}],

Cell[CellGroupData[{

Cell[TextData[{
 Cell[BoxData[
  FormBox[
   RowBox[{"dv", "[", 
    SubscriptBox["e", "i"]}], TraditionalForm]]],
 ",a,m]/d\[Delta]p"
}], "Subsection",
 CellChangeTimes->{{3.682845152607973*^9, 3.6828451899586554`*^9}, {
  3.683199373324525*^9, 3.683199405378907*^9}, {3.68509979054459*^9, 
  3.685099805196212*^9}, {3.6852052274422092`*^9, 3.685205230890399*^9}}],

Cell["Environmental change:", "Text",
 CellChangeTimes->{{3.682845239557769*^9, 3.6828452435668077`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvamdt1\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Exp", "[", 
    RowBox[{"q", 
     FractionBox["1", "2"], 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"zs", "[", 
        RowBox[{"ei", ",", "a"}], "]"}], "+", 
       RowBox[{"zs", "[", 
        RowBox[{"ei", ",", "m"}], "]"}]}], ")"}]}], "]"}], 
   RowBox[{"s", "[", "ei", "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{
       RowBox[{"3", "-", "ei"}], ",", "m", ",", "a"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.6828451992130203`*^9, 3.682845246071899*^9}, {
  3.683199347330213*^9, 3.68319940962227*^9}, {3.685099888146659*^9, 
  3.68509988919601*^9}, {3.685193183238106*^9, 3.685193186525836*^9}}],

Cell["Mortality of focal, replaced by her own maladapted offspring", "Text",
 CellChangeTimes->{{3.6828452501496277`*^9, 3.68284525658976*^9}, {
  3.682845329972937*^9, 3.682845331604385*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvamdt2\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{"1", "-", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
        RowBox[{"\[Delta]p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}]}], ",", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"p", "[", 
        RowBox[{"phen", "[", 
         RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
       RowBox[{"\[Delta]p", "[", 
        RowBox[{"phen", "[", 
         RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}]}], "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "m"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845258154578*^9, 3.682845356278455*^9}, {
   3.683199411005266*^9, 3.683199421837904*^9}, {3.683199452764576*^9, 
   3.68319951112311*^9}, 3.683227210190816*^9, {3.685099892127275*^9, 
   3.6850999220778933`*^9}}],

Cell["Mortality of focal, replaced by nonfocal offspring", "Text",
 CellChangeTimes->{{3.68284535944386*^9, 3.682845365923882*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvamdt3\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", 
     RowBox[{
      FractionBox["1", "2"], 
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}]}]}], ")"}], 
   RowBox[{"(", 
    RowBox[{"-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845368271618*^9, 3.682845390486068*^9}, {
   3.683199514840802*^9, 3.683199523540876*^9}, 3.683227209011223*^9, {
   3.685099932084655*^9, 3.685099932817914*^9}}],

Cell["Mortality of nonfocal, replaced by focal's offspring", "Text",
 CellChangeTimes->{{3.682845393347591*^9, 3.682845405355267*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvamdt4\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
        RowBox[{"\[Delta]p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{
         RowBox[{"2", 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], ",", 
        RowBox[{"v", "[", 
         RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}], "]"}]}], "+", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "-", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"p", "[", 
           RowBox[{"phen", "[", 
            RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
          RowBox[{"\[Delta]p", "[", 
           RowBox[{"phen", "[", 
            RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}]}], ")"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{"v", "[", 
         RowBox[{"ei", ",", "m", ",", "a"}], "]"}], ",", 
        RowBox[{
         RowBox[{"2", 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}]}], "]"}]}]}], 
    ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845406494494*^9, 3.6828454555095787`*^9}, {
   3.6831995261390457`*^9, 3.683199751862639*^9}, {3.6851000075329237`*^9, 
   3.6851000083426437`*^9}, {3.68510008674711*^9, 3.685100099681864*^9}, 
   3.68510013414925*^9}],

Cell["\<\
Mortality of nonfocal, replaced by nonfocal offspring of a different type \
than nonfocal\
\>", "Text",
 CellChangeTimes->{{3.682845472978017*^9, 3.6828454882093973`*^9}, {
  3.683199796656701*^9, 3.683199797376515*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvamdt5\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      FractionBox["1", "2"], 
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"p", "[", 
           RowBox[{"phen", "[", 
            RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
          RowBox[{
           RowBox[{"ram", "[", "ei", "]"}], 
           RowBox[{"\[Delta]p", "[", 
            RowBox[{"phen", "[", 
             RowBox[{"ei", ",", "m"}], "]"}], "]"}]}]}], ")"}], ",", 
        RowBox[{"1", "-", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"p", "[", 
            RowBox[{"phen", "[", 
             RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
           RowBox[{
            RowBox[{"ram", "[", "ei", "]"}], 
            RowBox[{"\[Delta]p", "[", 
             RowBox[{"phen", "[", 
              RowBox[{"ei", ",", "m"}], "]"}], "]"}]}]}], ")"}]}]}], "]"}]}], 
     "+", 
     RowBox[{
      FractionBox["1", "2"], "d", " ", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"ex", ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
         RowBox[{"(", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ei", "\[Equal]", "1"}], ",", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ",", 
            RowBox[{"1", "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", "1", 
             "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}]}], "]"}], 
          ")"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"statex", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a", ",", "a"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"a", ",", "m"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], "]"}]}]}], 
    ")"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "a"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845489127758*^9, 3.682845652705119*^9}, {
   3.683199761631853*^9, 3.683199902715605*^9}, {3.683200116816619*^9, 
   3.683200118465126*^9}, {3.683200860421144*^9, 3.683200864659851*^9}, 
   3.6832189099756813`*^9, 3.683227206083026*^9, {3.68510026532806*^9, 
   3.685100289394421*^9}, {3.68510056693756*^9, 3.685100576394641*^9}}],

Cell["\<\
Mortality of individual in remote patch, replaced by focal's offspring\
\>", "Text",
 CellChangeTimes->{{3.682845684654298*^9, 3.682845694533659*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvamdt6\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   FractionBox["1", "2"], "d", " ", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"ex", ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
               RowBox[{"\[Delta]p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
                 RowBox[{"\[Delta]p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
               RowBox[{"\[Delta]p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
                 RowBox[{"\[Delta]p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
               RowBox[{"\[Delta]p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
                 RowBox[{"\[Delta]p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
               RowBox[{"\[Delta]p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
                 RowBox[{"\[Delta]p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}]}], 
       ")"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"statex", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "a"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"a", ",", "m"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.682845654868635*^9, 3.682845679124524*^9}, {
   3.6831983981408043`*^9, 3.683198481007554*^9}, {3.683198569254446*^9, 
   3.683198631061006*^9}, {3.683198894243639*^9, 3.683199109099525*^9}, 
   3.68319934095358*^9, {3.683199926463127*^9, 3.683199981943626*^9}, {
   3.68320035894034*^9, 3.6832003611335793`*^9}, 3.683218944788011*^9, 
   3.683227204207383*^9, {3.6851005887706623`*^9, 3.685100641127967*^9}, {
   3.68510069960653*^9, 3.685100703478928*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dvamdt\[Delta]p", "[", "ei_", "]"}], ":=", 
   RowBox[{
    RowBox[{"dvamdt1\[Delta]p", "[", "ei", "]"}], "+", 
    RowBox[{"dvamdt2\[Delta]p", "[", "ei", "]"}], "+", 
    RowBox[{"dvamdt3\[Delta]p", "[", "ei", "]"}], "+", 
    RowBox[{"dvamdt4\[Delta]p", "[", "ei", "]"}], "+", 
    RowBox[{"dvamdt5\[Delta]p", "[", "ei", "]"}], "+", 
    RowBox[{"dvamdt6\[Delta]p", "[", "ei", "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.683199311291834*^9, 3.683199335664133*^9}, {
  3.683200008076005*^9, 3.6832000770423727`*^9}, {3.683200190847007*^9, 
  3.683200245334814*^9}, {3.685103747530366*^9, 3.685103789406893*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 Cell[BoxData[
  FormBox[
   RowBox[{"dv", "[", 
    SubscriptBox["e", "i"]}], TraditionalForm]]],
 ",m,a]/",
 "d\[Delta]p"
}], "Subsection",
 CellChangeTimes->{{3.682845152607973*^9, 3.6828451899586554`*^9}, {
  3.683199373324525*^9, 3.683199405378907*^9}, {3.683200341720703*^9, 
  3.683200352201293*^9}, {3.685103822521986*^9, 3.685103827806457*^9}, {
  3.685205215780604*^9, 3.685205234292453*^9}}],

Cell["Environmental change:", "Text",
 CellChangeTimes->{{3.682845239557769*^9, 3.6828452435668077`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmadt1\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Exp", "[", 
    RowBox[{"q", 
     FractionBox["1", "2"], 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"zs", "[", 
        RowBox[{"ei", ",", "m"}], "]"}], "+", 
       RowBox[{"zs", "[", 
        RowBox[{"ei", ",", "a"}], "]"}]}], ")"}]}], "]"}], 
   RowBox[{"s", "[", "ei", "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{
       RowBox[{"3", "-", "ei"}], ",", "a", ",", "m"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.6828451992130203`*^9, 3.682845246071899*^9}, {
  3.683199347330213*^9, 3.68319940962227*^9}, {3.6832004127359333`*^9, 
  3.68320043309993*^9}, {3.68510386446531*^9, 3.6851038653904552`*^9}, {
  3.685193195174513*^9, 3.6851931979504833`*^9}}],

Cell["Mortality of focal, replaced by her own adapted offspring", "Text",
 CellChangeTimes->{{3.6828452501496277`*^9, 3.68284525658976*^9}, {
  3.682845329972937*^9, 3.682845331604385*^9}, {3.683200460076082*^9, 
  3.6832004609474897`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmadt2\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{
      RowBox[{"p", "[", 
       RowBox[{"phen", "[", 
        RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
      RowBox[{"\[Delta]p", "[", 
       RowBox[{"phen", "[", 
        RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ",", 
     RowBox[{"1", "-", 
      RowBox[{"p", "[", 
       RowBox[{"phen", "[", 
        RowBox[{"ei", ",", "m"}], "]"}], "]"}], "-", 
      RowBox[{"\[Delta]p", "[", 
       RowBox[{"phen", "[", 
        RowBox[{"ei", ",", "m"}], "]"}], "]"}]}]}], "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "a"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845258154578*^9, 3.682845356278455*^9}, {
   3.683199411005266*^9, 3.683199421837904*^9}, {3.683199452764576*^9, 
   3.68319951112311*^9}, {3.6832004363552237`*^9, 3.683200472657877*^9}, {
   3.683200555700583*^9, 3.6832005768996687`*^9}, 3.683219505299831*^9, 
   3.683227201430964*^9, {3.6851038747967176`*^9, 3.6851039099299517`*^9}}],

Cell["Mortality of focal, replaced by nonfocal offspring", "Text",
 CellChangeTimes->{{3.68284535944386*^9, 3.682845365923882*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmadt3\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", 
     RowBox[{
      FractionBox["1", "2"], 
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}]}]}], ")"}], 
   RowBox[{"(", 
    RowBox[{"-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845368271618*^9, 3.682845390486068*^9}, {
   3.683199514840802*^9, 3.683199523540876*^9}, {3.68320058014487*^9, 
   3.683200589869781*^9}, 3.683227200189714*^9, {3.685104085495924*^9, 
   3.68510408668926*^9}}],

Cell["Mortality of nonfocal, replaced by focal's offspring", "Text",
 CellChangeTimes->{{3.682845393347591*^9, 3.682845405355267*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmadt4\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
        RowBox[{"\[Delta]p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{"v", "[", 
         RowBox[{"ei", ",", "a", ",", "m"}], "]"}], ",", 
        RowBox[{
         RowBox[{"2", 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}]}], "]"}]}], "+", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "-", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"p", "[", 
           RowBox[{"phen", "[", 
            RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
          RowBox[{"\[Delta]p", "[", 
           RowBox[{"phen", "[", 
            RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}]}], ")"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{
         RowBox[{"2", 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}], ",", 
        RowBox[{"v", "[", 
         RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], "]"}]}]}], 
    ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845406494494*^9, 3.6828454555095787`*^9}, {
   3.6831995261390457`*^9, 3.683199751862639*^9}, {3.6832005956307487`*^9, 
   3.683200742417244*^9}, {3.683200801830461*^9, 3.683200802245098*^9}, {
   3.685103952285736*^9, 3.68510397022288*^9}, 3.685104089978538*^9}],

Cell["\<\
Mortality of nonfocal adapted, replaced by nonfocal maladapted offspring\
\>", "Text",
 CellChangeTimes->{{3.682845472978017*^9, 3.6828454882093973`*^9}, {
  3.683199796656701*^9, 3.683199797376515*^9}, {3.683213694530525*^9, 
  3.683213700345112*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmadt5\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      FractionBox["1", "2"], 
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{"1", "-", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"p", "[", 
            RowBox[{"phen", "[", 
             RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
           RowBox[{
            RowBox[{"ram", "[", "ei", "]"}], " ", 
            RowBox[{"\[Delta]p", "[", 
             RowBox[{"phen", "[", 
              RowBox[{"ei", ",", "a"}], "]"}], "]"}]}]}], ")"}]}], ",", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"p", "[", 
           RowBox[{"phen", "[", 
            RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
          RowBox[{
           RowBox[{"ram", "[", "ei", "]"}], " ", 
           RowBox[{"\[Delta]p", "[", 
            RowBox[{"phen", "[", 
             RowBox[{"ei", ",", "a"}], "]"}], "]"}]}]}], ")"}]}], "]"}]}], 
     "+", 
     RowBox[{
      FractionBox["1", "2"], "d", " ", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"ex", ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
         RowBox[{"(", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ei", "\[Equal]", "1"}], ",", 
            RowBox[{"1", "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", "1", 
             "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}]}], "]"}], 
          ")"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"statex", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a", ",", "a"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"a", ",", "m"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], "]"}]}]}], 
    ")"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "m"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845489127758*^9, 3.682845652705119*^9}, {
   3.683199761631853*^9, 3.683199902715605*^9}, {3.683200116816619*^9, 
   3.683200118465126*^9}, {3.683200754640517*^9, 3.6832008538239202`*^9}, {
   3.6832008997121553`*^9, 3.683200902071858*^9}, 3.6832189925315723`*^9, {
   3.68321984562053*^9, 3.683219862401634*^9}, 3.6832271967477627`*^9, {
   3.6851039745740433`*^9, 3.6851040064771423`*^9}, 3.685104092123537*^9, {
   3.685105104042547*^9, 3.6851051093775063`*^9}}],

Cell["\<\
Mortality of individual in remote patch, replaced by focal's offspring\
\>", "Text",
 CellChangeTimes->{{3.682845684654298*^9, 3.682845694533659*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmadt6\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   FractionBox["1", "2"], "d", " ", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"ex", ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
               RowBox[{"\[Delta]p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
                 RowBox[{"\[Delta]p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
               RowBox[{"\[Delta]p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
                 RowBox[{"\[Delta]p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
               RowBox[{"\[Delta]p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
                 RowBox[{"\[Delta]p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
               RowBox[{"\[Delta]p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
                 RowBox[{"\[Delta]p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}]}], 
       ")"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"statex", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "a"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"a", ",", "m"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.682845654868635*^9, 3.682845679124524*^9}, {
   3.6831983981408043`*^9, 3.683198481007554*^9}, {3.683198569254446*^9, 
   3.683198631061006*^9}, {3.683198894243639*^9, 3.683199109099525*^9}, 
   3.68319934095358*^9, {3.683199926463127*^9, 3.683199981943626*^9}, {
   3.683200927136066*^9, 3.6832009722494783`*^9}, 3.683218996081359*^9, 
   3.683227195001505*^9, {3.6851040319656553`*^9, 3.685104094192264*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dvmadt\[Delta]p", "[", "ei_", "]"}], ":=", 
   RowBox[{
    RowBox[{"dvmadt1\[Delta]p", "[", "ei", "]"}], "+", 
    RowBox[{"dvmadt2\[Delta]p", "[", "ei", "]"}], "+", 
    RowBox[{"dvmadt3\[Delta]p", "[", "ei", "]"}], "+", 
    RowBox[{"dvmadt4\[Delta]p", "[", "ei", "]"}], "+", 
    RowBox[{"dvmadt5\[Delta]p", "[", "ei", "]"}], "+", 
    RowBox[{"dvmadt6\[Delta]p", "[", "ei", "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.683199311291834*^9, 3.683199335664133*^9}, {
  3.683200008076005*^9, 3.6832000770423727`*^9}, {3.683200190847007*^9, 
  3.683200245334814*^9}, {3.683200978950598*^9, 3.6832009932869453`*^9}, {
  3.6851040967204742`*^9, 3.6851041075759087`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 "d",
 Cell[BoxData[
  FormBox[
   RowBox[{"v", "[", 
    RowBox[{
     SubscriptBox["e", "i"], ",", "a", ",", "a"}], "]"}], TraditionalForm]]],
 "/",
 "d\[Delta]p"
}], "Subsection",
 CellChangeTimes->{{3.6832132294642563`*^9, 3.683213249847337*^9}, {
  3.6852052179393387`*^9, 3.685205236755865*^9}}],

Cell["Environmental change", "Text",
 CellChangeTimes->{{3.6832132582712584`*^9, 3.683213260558799*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvaadt1\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Exp", "[", 
    RowBox[{"q", " ", 
     RowBox[{"zs", "[", 
      RowBox[{"ei", ",", "a"}], "]"}]}], "]"}], 
   RowBox[{"s", "[", "ei", "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{
       RowBox[{"3", "-", "ei"}], ",", "m", ",", "m"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.6832132616833057`*^9, 3.683213303386718*^9}, {
   3.6832177969847403`*^9, 3.6832178203628473`*^9}, 3.6832271931226387`*^9, {
   3.685104118171009*^9, 3.685104121023273*^9}, {3.685193201540094*^9, 
   3.685193204012808*^9}}],

Cell["Focal adapted dies, replaced by her own maladapted offspring", "Text",
 CellChangeTimes->{{3.6832132809258957`*^9, 3.683213296676857*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvaadt2\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{"1", "-", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
        RowBox[{"\[Delta]p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}]}], ",", 
     RowBox[{
      RowBox[{"p", "[", 
       RowBox[{"phen", "[", 
        RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
      RowBox[{"\[Delta]p", "[", 
       RowBox[{"phen", "[", 
        RowBox[{"ei", ",", "a"}], "]"}], "]"}]}]}], "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "a"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.6832133014352007`*^9, 3.683213357824053*^9}, {
   3.683213401879324*^9, 3.683213403911558*^9}, {3.683213534705427*^9, 
   3.683213542979003*^9}, 3.683227192084193*^9, 3.685104123596192*^9, {
   3.685104216120593*^9, 3.685104230052704*^9}}],

Cell["Focal adapted dies, replaced by nonfocal offspring", "Text",
 CellChangeTimes->{{3.68321336010565*^9, 3.683213366625884*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvaadt3\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", 
     RowBox[{
      FractionBox["1", "2"], 
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}]}]}], ")"}], 
   RowBox[{"(", 
    RowBox[{"-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.683213367584035*^9, 3.683213416711776*^9}, 
   3.683227190646262*^9, 3.6851041252833643`*^9}],

Cell["Nonfocal adapted dies, replaced by focal offspring", "Text",
 CellChangeTimes->{{3.683213418678454*^9, 3.68321342567815*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvaadt4\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
         RowBox[{"\[Delta]p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
       RowBox[{"v", "[", 
        RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"p", "[", 
            RowBox[{"phen", "[", 
             RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
           RowBox[{"\[Delta]p", "[", 
            RowBox[{"phen", "[", 
             RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}]}], ")"}], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "a"}], "]"}], "+", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], ")"}]}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"p", "[", 
            RowBox[{"phen", "[", 
             RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
           RowBox[{"\[Delta]p", "[", 
            RowBox[{"phen", "[", 
             RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}]}], ")"}], 
       RowBox[{"v", "[", 
        RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
         RowBox[{"\[Delta]p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "a"}], "]"}], "+", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], ")"}]}]}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.6832134270223827`*^9, 3.683213583469589*^9}, 
   3.683227187898449*^9, 3.685104127171273*^9, {3.68510424073841*^9, 
   3.685104264090149*^9}}],

Cell["\<\
Nonfocal adapted dies, replaced by nonfocal maladapted offspring\
\>", "Text",
 CellChangeTimes->{{3.6832135876560698`*^9, 3.683213597054346*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvaadt5\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{"1", "-", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"p", "[", 
            RowBox[{"phen", "[", 
             RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
           RowBox[{
            RowBox[{"raa", "[", "ei", "]"}], 
            RowBox[{"\[Delta]p", "[", 
             RowBox[{"phen", "[", 
              RowBox[{"ei", ",", "a"}], "]"}], "]"}]}]}], ")"}]}], ",", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"p", "[", 
           RowBox[{"phen", "[", 
            RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
          RowBox[{
           RowBox[{"raa", "[", "ei", "]"}], 
           RowBox[{"\[Delta]p", "[", 
            RowBox[{"phen", "[", 
             RowBox[{"ei", ",", "a"}], "]"}], "]"}]}]}], ")"}]}], "]"}]}], 
     "+", 
     RowBox[{"d", "*", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"ex", ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
         RowBox[{"(", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ei", "\[Equal]", "1"}], ",", 
            RowBox[{"1", "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", "1", 
             "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}]}], "]"}], 
          ")"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"statex", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a", ",", "a"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"a", ",", "m"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], "]"}]}]}], 
    ")"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.683213598227193*^9, 3.6832137177*^9}, 
   3.6832190029681473`*^9, 3.683220676813352*^9, {3.683224361949139*^9, 
   3.683224364332396*^9}, 3.68322718657099*^9, {3.685005433142889*^9, 
   3.685005439598843*^9}, 3.6851041305766077`*^9, {3.68510428454543*^9, 
   3.6851043177177896`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvaadt6\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   FractionBox["1", "2"], "d", " ", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"ex", ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
               RowBox[{"\[Delta]p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
                 RowBox[{"\[Delta]p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
               RowBox[{"\[Delta]p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
                 RowBox[{"\[Delta]p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
               RowBox[{"\[Delta]p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
                 RowBox[{"\[Delta]p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
               RowBox[{"\[Delta]p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "a"}], "]"}], "]"}], "+", 
                 RowBox[{"\[Delta]p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}]}], 
       ")"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"statex", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "a"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"a", ",", "m"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.683213719921734*^9, 3.683213773822291*^9}, 
   3.6832190057815733`*^9, 3.6832271841108418`*^9, 3.685104133311658*^9, {
   3.685104334406159*^9, 3.685104363443533*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dvaadt\[Delta]p", "[", "ei_", "]"}], ":=", 
   RowBox[{
    RowBox[{"dvaadt1\[Delta]p", "[", "ei", "]"}], "+", 
    RowBox[{"dvaadt2\[Delta]p", "[", "ei", "]"}], "+", 
    RowBox[{"dvaadt3\[Delta]p", "[", "ei", "]"}], "+", 
    RowBox[{"dvaadt4\[Delta]p", "[", "ei", "]"}], "+", 
    RowBox[{"dvaadt5\[Delta]p", "[", "ei", "]"}], "+", 
    RowBox[{"dvaadt6\[Delta]p", "[", "ei", "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.683213786759811*^9, 3.6832138193694963`*^9}, 
   3.68510413546329*^9, {3.685104369290401*^9, 3.685104393844062*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 "d",
 Cell[BoxData[
  FormBox[
   RowBox[{"v", "[", 
    RowBox[{
     SubscriptBox["e", "i"], ",", "m", ",", "m"}], "]"}], TraditionalForm]]],
 "/",
 "d\[Delta]p"
}], "Subsection",
 CellChangeTimes->{{3.6832144102492037`*^9, 3.683214425500306*^9}, {
  3.685205223164042*^9, 3.6852052386999063`*^9}}],

Cell["Environmental change", "Text",
 CellChangeTimes->{{3.6832177787163754`*^9, 3.683217781747661*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmmdt1\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Exp", "[", 
    RowBox[{"q", " ", 
     RowBox[{"zs", "[", 
      RowBox[{"ei", ",", "m"}], "]"}]}], "]"}], 
   RowBox[{"s", "[", "ei", "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{
       RowBox[{"3", "-", "ei"}], ",", "a", ",", "a"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.683217782423493*^9, 3.683217791529729*^9}, {
   3.683217881336334*^9, 3.683217897056925*^9}, {3.6832271799072657`*^9, 
   3.683227182420065*^9}, 3.6832272429076*^9, {3.685104806744871*^9, 
   3.685104807642209*^9}, {3.685193208051794*^9, 3.685193210179565*^9}}],

Cell["Focal dies, replaced by her own adapted offspring", "Text",
 CellChangeTimes->{{3.6832144383815317`*^9, 3.683214453429648*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmmdt2\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"p", "[", 
        RowBox[{"phen", "[", 
         RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
       RowBox[{"\[Delta]p", "[", 
        RowBox[{"phen", "[", 
         RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], ",", 
     RowBox[{"1", "-", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
        RowBox[{"\[Delta]p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}]}]}], "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.683214430586694*^9, 3.6832144562819443`*^9}, {
   3.6832174226063623`*^9, 3.683217427491819*^9}, {3.683217776583317*^9, 
   3.683217776664213*^9}, {3.683217903779244*^9, 3.6832179482178926`*^9}, 
   3.6832271790872507`*^9, {3.685104417748333*^9, 3.6851044387025146`*^9}, {
   3.6851048044381123`*^9, 3.685104805049736*^9}}],

Cell["Focal dies, replaced by nonfocal offspring", "Text",
 CellChangeTimes->{{3.6832179512898397`*^9, 3.683217958449692*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmmdt3\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", 
     RowBox[{
      FractionBox["1", "2"], 
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}]}]}], ")"}], 
   RowBox[{"(", 
    RowBox[{"-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.683217959347053*^9, 3.683217984452059*^9}, 
   3.6832271776208477`*^9, {3.685104801545739*^9, 3.685104802332456*^9}}],

Cell["Nonfocal dies, replaced by focal offspring ", "Text",
 CellChangeTimes->{{3.683217987151927*^9, 3.683217991370469*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmmdt4\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
         RowBox[{"\[Delta]p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "+", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "a"}], "]"}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], ")"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"p", "[", 
            RowBox[{"phen", "[", 
             RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
           RowBox[{"\[Delta]p", "[", 
            RowBox[{"phen", "[", 
             RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}]}], ")"}], 
       RowBox[{"v", "[", 
        RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"p", "[", 
            RowBox[{"phen", "[", 
             RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
           RowBox[{"\[Delta]p", "[", 
            RowBox[{"phen", "[", 
             RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}]}], ")"}], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "+", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "a"}], "]"}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], ")"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
         RowBox[{"\[Delta]p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
       RowBox[{"v", "[", 
        RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}]}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.683217993904415*^9, 3.6832180563791037`*^9}, {
  3.683218095013372*^9, 3.683218143285419*^9}, {3.685104457573469*^9, 
  3.6851044702038918`*^9}, {3.6851047961068573`*^9, 3.685104799038278*^9}}],

Cell["\<\
Nonfocal maladapted dies, replaced by nonfocal adapted offspring\
\>", "Text",
 CellChangeTimes->{{3.683218151473761*^9, 3.683218170208146*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmmdt5\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{"zs", "[", 
     RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"p", "[", 
           RowBox[{"phen", "[", 
            RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
          RowBox[{
           RowBox[{"rmm", "[", "ei", "]"}], 
           RowBox[{"\[Delta]p", "[", 
            RowBox[{"phen", "[", 
             RowBox[{"ei", ",", "m"}], "]"}], "]"}]}]}], ")"}], ",", 
        RowBox[{"1", "-", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"p", "[", 
            RowBox[{"phen", "[", 
             RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
           RowBox[{
            RowBox[{"rmm", "[", "ei", "]"}], 
            RowBox[{"\[Delta]p", "[", 
             RowBox[{"phen", "[", 
              RowBox[{"ei", ",", "m"}], "]"}], "]"}]}]}], ")"}]}]}], "]"}]}], 
     "+", 
     RowBox[{"d", " ", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"ex", ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
         RowBox[{"(", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ei", "\[Equal]", "1"}], ",", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ",", 
            RowBox[{"1", "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", "1", 
             "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}]}], "]"}], 
          ")"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"statex", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a", ",", "a"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"a", ",", "m"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], "]"}]}]}], 
    ")"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "a"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.683218146483746*^9, 3.683218227381504*^9}, 
   3.683219026276667*^9, 3.683220671511565*^9, 3.683227168476479*^9, {
   3.685104499586337*^9, 3.685104513800539*^9}, {3.6851047934683723`*^9, 
   3.685104794183606*^9}, {3.6851049123080273`*^9, 3.685104916056225*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmmdt6\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   FractionBox["1", "2"], "d", " ", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"ex", ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
               RowBox[{"\[Delta]p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
                 RowBox[{"\[Delta]p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
               RowBox[{"\[Delta]p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
                 RowBox[{"\[Delta]p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
               RowBox[{"\[Delta]p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
                 RowBox[{"\[Delta]p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
               RowBox[{"\[Delta]p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "m"}], "]"}], "]"}], "+", 
                 RowBox[{"\[Delta]p", "[", 
                  RowBox[{"phen", "[", 
                   RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}]}], 
       ")"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"statex", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "a"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"a", ",", "m"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.683213719921734*^9, 3.683213773822291*^9}, {
   3.6832182359567204`*^9, 3.683218271839697*^9}, 3.6832190294842663`*^9, 
   3.6832271744595623`*^9, {3.685104524104491*^9, 3.685104548092345*^9}, {
   3.6851047882312937`*^9, 3.685104788887375*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dvmmdt\[Delta]p", "[", "ei_", "]"}], ":=", 
   RowBox[{
    RowBox[{"dvmmdt1\[Delta]p", "[", "ei", "]"}], "+", 
    RowBox[{"dvmmdt2\[Delta]p", "[", "ei", "]"}], "+", 
    RowBox[{"dvmmdt3\[Delta]p", "[", "ei", "]"}], "+", 
    RowBox[{"dvmmdt4\[Delta]p", "[", "ei", "]"}], "+", 
    RowBox[{"dvmmdt5\[Delta]p", "[", "ei", "]"}], "+", 
    RowBox[{"dvmmdt6\[Delta]p", "[", "ei", "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.683218278288801*^9, 3.683218309191255*^9}, {
  3.6832185168692217`*^9, 3.68321852724966*^9}, {3.683227169531499*^9, 
  3.6832271732217007`*^9}, {3.685104551855403*^9, 3.6851045672550097`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"selgrad", "[", "x_", "]"}], ":=", 
  RowBox[{"D", "[", 
   RowBox[{
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"2", " ", 
        RowBox[{"f", "[", 
         RowBox[{"ei", ",", "a", ",", "a"}], "]"}], 
        RowBox[{"dvaadt\[Delta]p", "[", "ei", "]"}]}], "+", 
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{"ei", ",", "a", ",", "m"}], "]"}], 
        RowBox[{"dvamdt\[Delta]p", "[", "ei", "]"}]}], "+", 
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{"ei", ",", "a", ",", "m"}], "]"}], 
        RowBox[{"dvmadt\[Delta]p", "[", "ei", "]"}]}], "+", 
       RowBox[{"2", 
        RowBox[{"f", "[", 
         RowBox[{"ei", ",", "m", ",", "m"}], "]"}], 
        RowBox[{"dvmmdt\[Delta]p", "[", "ei", "]"}]}]}], ",", 
      RowBox[{"{", 
       RowBox[{"ei", ",", "1", ",", "2"}], "}"}]}], "]"}], ",", "x"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.6851047139388113`*^9, 3.685104768776784*^9}, {
  3.6851048310097923`*^9, 3.68510486210417*^9}, {3.685105060331935*^9, 
  3.6851050710027227`*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Selection gradient zs1, zs2", "Section",
 CellChangeTimes->{{3.682844962098281*^9, 3.6828449638582706`*^9}, {
  3.685105285124785*^9, 3.685105291371434*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rvals", "=", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{"ex", ",", "statex1", ",", "statex2"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"statex1", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"statex2", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}]}], "]"}], "//", 
    "Flatten"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.683200086190008*^9, 3.683200155658983*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rvalsTest", "=", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"v", "[", 
        RowBox[{"2", ",", "statex1", ",", "statex2"}], "]"}], "\[Rule]", 
       RowBox[{"v", "[", 
        RowBox[{"1", ",", "statex1", ",", "statex2"}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"statex1", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"statex2", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}]}], "]"}], "//", 
    "Flatten"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6832001606051397`*^9, 3.683200179314473*^9}}],

Cell[CellGroupData[{

Cell[TextData[{
 "d",
 Cell[BoxData[
  FormBox[
   RowBox[{"v", "[", 
    SubscriptBox["e", "i"]}], TraditionalForm]]],
 ",a,m]/d\[Delta]z"
}], "Subsection",
 CellChangeTimes->{{3.682845152607973*^9, 3.6828451899586554`*^9}, {
   3.683199373324525*^9, 3.683199405378907*^9}, {3.685105299869849*^9, 
   3.685105310740342*^9}, 3.6852054002343283`*^9}],

Cell["Environmental change:", "Text",
 CellChangeTimes->{{3.682845239557769*^9, 3.6828452435668077`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvamdt1\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Exp", "[", 
    RowBox[{"q", 
     FractionBox["1", "2"], 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"zs", "[", 
        RowBox[{"ei", ",", "a"}], "]"}], "+", 
       RowBox[{"\[Delta]zs", "[", 
        RowBox[{"ei", ",", "a"}], "]"}], "+", 
       RowBox[{"zs", "[", 
        RowBox[{"ei", ",", "m"}], "]"}], "+", 
       RowBox[{
        RowBox[{"ram", "[", "ei", "]"}], 
        RowBox[{"\[Delta]zs", "[", 
         RowBox[{"ei", ",", "m"}], "]"}]}]}], ")"}]}], "]"}], 
   RowBox[{"s", "[", "ei", "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{
       RowBox[{"3", "-", "ei"}], ",", "m", ",", "a"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.6828451992130203`*^9, 3.682845246071899*^9}, {
  3.683199347330213*^9, 3.68319940962227*^9}, {3.685105313696069*^9, 
  3.685105340351347*^9}, {3.685105413108971*^9, 3.685105415318947*^9}, {
  3.68519321581007*^9, 3.685193221360756*^9}}],

Cell["Mortality of focal, replaced by her own maladapted offspring", "Text",
 CellChangeTimes->{{3.6828452501496277`*^9, 3.68284525658976*^9}, {
  3.682845329972937*^9, 3.682845331604385*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvamdt2\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"ei", ",", "a"}], "]"}], "+", 
     RowBox[{"\[Delta]zs", "[", 
      RowBox[{"ei", ",", "a"}], "]"}]}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{"1", "-", 
      RowBox[{"p", "[", 
       RowBox[{"phen", "[", 
        RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ",", 
     RowBox[{"p", "[", 
      RowBox[{"phen", "[", 
       RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "m"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845258154578*^9, 3.682845356278455*^9}, {
   3.683199411005266*^9, 3.683199421837904*^9}, {3.683199452764576*^9, 
   3.68319951112311*^9}, 3.683227210190816*^9, {3.685105358112289*^9, 
   3.685105359351172*^9}, {3.6851054011181803`*^9, 3.685105406070928*^9}}],

Cell["Mortality of focal, replaced by nonfocal offspring", "Text",
 CellChangeTimes->{{3.68284535944386*^9, 3.682845365923882*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvamdt3\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"ei", ",", "a"}], "]"}], "+", 
     RowBox[{"\[Delta]zs", "[", 
      RowBox[{"ei", ",", "a"}], "]"}]}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", 
     RowBox[{
      FractionBox["1", "2"], 
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}]}]}], ")"}], 
   RowBox[{"(", 
    RowBox[{"-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845368271618*^9, 3.682845390486068*^9}, {
   3.683199514840802*^9, 3.683199523540876*^9}, 3.683227209011223*^9, 
   3.685105427949265*^9, 3.6851056103200006`*^9}],

Cell["Mortality of nonfocal, replaced by focal's offspring", "Text",
 CellChangeTimes->{{3.682845393347591*^9, 3.682845405355267*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvamdt4\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"ei", ",", "m"}], "]"}], "+", 
     RowBox[{
      RowBox[{"ram", "[", "ei", "]"}], " ", 
      RowBox[{"\[Delta]zs", "[", 
       RowBox[{"ei", ",", "m"}], "]"}]}]}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"p", "[", 
       RowBox[{"phen", "[", 
        RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{
         RowBox[{"2", 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], ",", 
        RowBox[{"v", "[", 
         RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}], "]"}]}], "+", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "-", 
        RowBox[{"p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{"v", "[", 
         RowBox[{"ei", ",", "m", ",", "a"}], "]"}], ",", 
        RowBox[{
         RowBox[{"2", 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}]}], "]"}]}]}], 
    ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845406494494*^9, 3.6828454555095787`*^9}, {
   3.6831995261390457`*^9, 3.683199751862639*^9}, {3.6851054331221533`*^9, 
   3.685105437160469*^9}, {3.685105468871879*^9, 3.685105478049226*^9}, 
   3.6851056127398777`*^9}],

Cell["\<\
Mortality of nonfocal, replaced by nonfocal offspring of a different type \
than nonfocal\
\>", "Text",
 CellChangeTimes->{{3.682845472978017*^9, 3.6828454882093973`*^9}, {
  3.683199796656701*^9, 3.683199797376515*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvamdt5\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"ei", ",", "m"}], "]"}], "+", 
     RowBox[{
      RowBox[{"ram", "[", "ei", "]"}], " ", 
      RowBox[{"\[Delta]zs", "[", 
       RowBox[{"ei", ",", "m"}], "]"}]}]}], "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      FractionBox["1", "2"], 
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{"p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "m"}], "]"}], "]"}], ",", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "m"}], "]"}], "]"}]}]}], "]"}]}], "+", 
     RowBox[{
      FractionBox["1", "2"], "d", " ", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"ex", ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
         RowBox[{"(", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ei", "\[Equal]", "1"}], ",", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ",", 
            RowBox[{"1", "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", "1", 
             "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}]}], "]"}], 
          ")"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"statex", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a", ",", "a"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"a", ",", "m"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], "]"}]}]}], 
    ")"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "a"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845489127758*^9, 3.682845652705119*^9}, {
   3.683199761631853*^9, 3.683199902715605*^9}, {3.683200116816619*^9, 
   3.683200118465126*^9}, {3.683200860421144*^9, 3.683200864659851*^9}, 
   3.6832189099756813`*^9, 3.683227206083026*^9, {3.6851054606675777`*^9, 
   3.6851054821521063`*^9}, 3.6851056081810093`*^9}],

Cell["\<\
Mortality of individual in remote patch, replaced by focal's offspring\
\>", "Text",
 CellChangeTimes->{{3.682845684654298*^9, 3.682845694533659*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvamdt6\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   FractionBox["1", "2"], "d", " ", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"ex", ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}]}], 
       ")"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"statex", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "a"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"a", ",", "m"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.682845654868635*^9, 3.682845679124524*^9}, {
   3.6831983981408043`*^9, 3.683198481007554*^9}, {3.683198569254446*^9, 
   3.683198631061006*^9}, {3.683198894243639*^9, 3.683199109099525*^9}, 
   3.68319934095358*^9, {3.683199926463127*^9, 3.683199981943626*^9}, {
   3.68320035894034*^9, 3.6832003611335793`*^9}, 3.683218944788011*^9, 
   3.683227204207383*^9, 3.685105605557281*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dvamdt\[Delta]z", "[", "ei_", "]"}], ":=", 
   RowBox[{
    RowBox[{"dvamdt1\[Delta]z", "[", "ei", "]"}], "+", 
    RowBox[{"dvamdt2\[Delta]z", "[", "ei", "]"}], "+", 
    RowBox[{"dvamdt3\[Delta]z", "[", "ei", "]"}], "+", 
    RowBox[{"dvamdt4\[Delta]z", "[", "ei", "]"}], "+", 
    RowBox[{"dvamdt5\[Delta]z", "[", "ei", "]"}], "+", 
    RowBox[{"dvamdt6\[Delta]z", "[", "ei", "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.683199311291834*^9, 3.683199335664133*^9}, {
  3.683200008076005*^9, 3.6832000770423727`*^9}, {3.683200190847007*^9, 
  3.683200245334814*^9}, {3.685105588079419*^9, 3.6851056032380857`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"D", "[", 
  RowBox[{
   RowBox[{"dvamdt\[Delta]z", "[", "1", "]"}], ",", 
   RowBox[{"\[Delta]zs", "[", 
    RowBox[{"1", ",", "a"}], "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.68510562811147*^9, 3.6851056838973017`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   FractionBox["1", "2"], " ", 
   SuperscriptBox["\[ExponentialE]", 
    RowBox[{
     FractionBox["1", "2"], " ", "q", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"zs", "[", 
        RowBox[{"1", ",", "a"}], "]"}], "+", 
       RowBox[{"zs", "[", 
        RowBox[{"1", ",", "m"}], "]"}], "+", 
       RowBox[{"\[Delta]zs", "[", 
        RowBox[{"1", ",", "a"}], "]"}], "+", 
       RowBox[{
        RowBox[{"ram", "[", "1", "]"}], " ", 
        RowBox[{"\[Delta]zs", "[", 
         RowBox[{"1", ",", "m"}], "]"}]}]}], ")"}]}]], " ", "q", " ", 
   RowBox[{"s", "[", "1", "]"}], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", 
      RowBox[{"v", "[", 
       RowBox[{"1", ",", "a", ",", "m"}], "]"}]}], "+", 
     RowBox[{"v", "[", 
      RowBox[{"2", ",", "m", ",", "a"}], "]"}]}], ")"}]}], "-", 
  RowBox[{"2", " ", 
   RowBox[{"(", 
    RowBox[{"1", "+", 
     RowBox[{
      FractionBox["1", "2"], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"-", "1"}], "+", "d"}], ")"}]}]}], ")"}], " ", "k", " ", 
   RowBox[{"mu", "[", "a", "]"}], " ", 
   RowBox[{"v", "[", 
    RowBox[{"1", ",", "a", ",", "m"}], "]"}], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"1", ",", "a"}], "]"}], "+", 
     RowBox[{"\[Delta]zs", "[", 
      RowBox[{"1", ",", "a"}], "]"}]}], ")"}]}], "+", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], " ", "k", " ", 
   RowBox[{"mu", "[", "a", "]"}], " ", 
   RowBox[{"(", 
    RowBox[{"1", "-", 
     RowBox[{"p", "[", "1", "]"}]}], ")"}], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", 
      RowBox[{"v", "[", 
       RowBox[{"1", ",", "a", ",", "m"}], "]"}]}], "+", 
     RowBox[{"v", "[", 
      RowBox[{"1", ",", "m", ",", "m"}], "]"}]}], ")"}], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"1", ",", "a"}], "]"}], "+", 
     RowBox[{"\[Delta]zs", "[", 
      RowBox[{"1", ",", "a"}], "]"}]}], ")"}]}]}]], "Output",
 CellChangeTimes->{{3.685105645115741*^9, 3.685105684664744*^9}, 
   3.68510650518358*^9, 3.685193260133572*^9, 3.685205504657777*^9}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 "d",
 Cell[BoxData[
  FormBox[
   RowBox[{"v", "[", 
    SubscriptBox["e", "i"]}], TraditionalForm]]],
 ",m,a]/d\[Delta]z"
}], "Subsection",
 CellChangeTimes->{{3.682845152607973*^9, 3.6828451899586554`*^9}, {
  3.683199373324525*^9, 3.683199405378907*^9}, {3.683200341720703*^9, 
  3.683200352201293*^9}, {3.685205402275049*^9, 3.6852054088745728`*^9}}],

Cell["Environmental change:", "Text",
 CellChangeTimes->{{3.682845239557769*^9, 3.6828452435668077`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmadt1\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Exp", "[", 
    RowBox[{"q", 
     FractionBox["1", "2"], 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"zs", "[", 
        RowBox[{"ei", ",", "m"}], "]"}], "+", 
       RowBox[{"\[Delta]zs", "[", 
        RowBox[{"ei", ",", "m"}], "]"}], "+", 
       RowBox[{"zs", "[", 
        RowBox[{"ei", ",", "a"}], "]"}], "+", 
       RowBox[{
        RowBox[{"ram", "[", "ei", "]"}], 
        RowBox[{"\[Delta]zs", "[", 
         RowBox[{"ei", ",", "a"}], "]"}]}]}], ")"}]}], "]"}], 
   RowBox[{"s", "[", "ei", "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{
       RowBox[{"3", "-", "ei"}], ",", "a", ",", "m"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.6828451992130203`*^9, 3.682845246071899*^9}, {
   3.683199347330213*^9, 3.68319940962227*^9}, {3.6832004127359333`*^9, 
   3.68320043309993*^9}, 3.685105618855906*^9, {3.685105843592907*^9, 
   3.685105887463728*^9}, {3.6851932355671263`*^9, 3.685193240999161*^9}}],

Cell["Mortality of focal, replaced by her own adapted offspring", "Text",
 CellChangeTimes->{{3.6828452501496277`*^9, 3.68284525658976*^9}, {
  3.682845329972937*^9, 3.682845331604385*^9}, {3.683200460076082*^9, 
  3.6832004609474897`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmadt2\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"ei", ",", "m"}], "]"}], "+", 
     RowBox[{"\[Delta]zs", "[", 
      RowBox[{"ei", ",", "m"}], "]"}]}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{"p", "[", 
      RowBox[{"phen", "[", 
       RowBox[{"ei", ",", "m"}], "]"}], "]"}], ",", 
     RowBox[{"1", "-", 
      RowBox[{"p", "[", 
       RowBox[{"phen", "[", 
        RowBox[{"ei", ",", "m"}], "]"}], "]"}]}]}], "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "a"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845258154578*^9, 3.682845356278455*^9}, {
   3.683199411005266*^9, 3.683199421837904*^9}, {3.683199452764576*^9, 
   3.68319951112311*^9}, {3.6832004363552237`*^9, 3.683200472657877*^9}, {
   3.683200555700583*^9, 3.6832005768996687`*^9}, 3.683219505299831*^9, 
   3.683227201430964*^9, {3.685105894164751*^9, 3.68510589820173*^9}, 
   3.6851059480515823`*^9}],

Cell["Mortality of focal, replaced by nonfocal offspring", "Text",
 CellChangeTimes->{{3.68284535944386*^9, 3.682845365923882*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmadt3\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"ei", ",", "m"}], "]"}], "+", 
     RowBox[{"\[Delta]zs", "[", 
      RowBox[{"ei", ",", "m"}], "]"}]}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", 
     RowBox[{
      FractionBox["1", "2"], 
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}]}]}], ")"}], 
   RowBox[{"(", 
    RowBox[{"-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845368271618*^9, 3.682845390486068*^9}, {
   3.683199514840802*^9, 3.683199523540876*^9}, {3.68320058014487*^9, 
   3.683200589869781*^9}, 3.683227200189714*^9, 3.685105903865139*^9, 
   3.685105949998584*^9}],

Cell["Mortality of nonfocal, replaced by focal's offspring", "Text",
 CellChangeTimes->{{3.682845393347591*^9, 3.682845405355267*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmadt4\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"ei", ",", "a"}], "]"}], "+", 
     RowBox[{
      RowBox[{"ram", "[", "ei", "]"}], 
      RowBox[{"\[Delta]zs", "[", 
       RowBox[{"ei", ",", "a"}], "]"}]}]}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"p", "[", 
       RowBox[{"phen", "[", 
        RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{"v", "[", 
         RowBox[{"ei", ",", "a", ",", "m"}], "]"}], ",", 
        RowBox[{
         RowBox[{"2", 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}]}], "]"}]}], "+", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "-", 
        RowBox[{"p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{
         RowBox[{"2", 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}], ",", 
        RowBox[{"v", "[", 
         RowBox[{"ei", ",", "a", ",", "m"}], "]"}]}], "]"}]}]}], 
    ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845406494494*^9, 3.6828454555095787`*^9}, {
   3.6831995261390457`*^9, 3.683199751862639*^9}, {3.6832005956307487`*^9, 
   3.683200742417244*^9}, {3.683200801830461*^9, 3.683200802245098*^9}, {
   3.68510590764001*^9, 3.685105914387108*^9}, 3.685105952438374*^9}],

Cell["\<\
Mortality of nonfocal adapted, replaced by nonfocal maladapted offspring\
\>", "Text",
 CellChangeTimes->{{3.682845472978017*^9, 3.6828454882093973`*^9}, {
  3.683199796656701*^9, 3.683199797376515*^9}, {3.683213694530525*^9, 
  3.683213700345112*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmadt5\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"ei", ",", "a"}], "]"}], "+", 
     RowBox[{
      RowBox[{"ram", "[", "ei", "]"}], 
      RowBox[{"\[Delta]zs", "[", 
       RowBox[{"ei", ",", "a"}], "]"}]}]}], "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      FractionBox["1", "2"], 
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ",", 
        RowBox[{"p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], "]"}]}], "+", 
     RowBox[{
      FractionBox["1", "2"], "d", " ", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"ex", ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
         RowBox[{"(", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ei", "\[Equal]", "1"}], ",", 
            RowBox[{"1", "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", "1", 
             "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}]}], "]"}], 
          ")"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"statex", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a", ",", "a"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"a", ",", "m"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], "]"}]}]}], 
    ")"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "m"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.682845489127758*^9, 3.682845652705119*^9}, {
   3.683199761631853*^9, 3.683199902715605*^9}, {3.683200116816619*^9, 
   3.683200118465126*^9}, {3.683200754640517*^9, 3.6832008538239202`*^9}, {
   3.6832008997121553`*^9, 3.683200902071858*^9}, 3.6832189925315723`*^9, {
   3.68321984562053*^9, 3.683219862401634*^9}, 3.6832271967477627`*^9, {
   3.685105931998399*^9, 3.685105954879033*^9}}],

Cell["\<\
Mortality of individual in remote patch, replaced by focal's offspring\
\>", "Text",
 CellChangeTimes->{{3.682845684654298*^9, 3.682845694533659*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmadt6\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   FractionBox["1", "2"], "d", " ", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"ex", ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}]}], 
       ")"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"statex", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "a"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"a", ",", "m"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.682845654868635*^9, 3.682845679124524*^9}, {
   3.6831983981408043`*^9, 3.683198481007554*^9}, {3.683198569254446*^9, 
   3.683198631061006*^9}, {3.683198894243639*^9, 3.683199109099525*^9}, 
   3.68319934095358*^9, {3.683199926463127*^9, 3.683199981943626*^9}, {
   3.683200927136066*^9, 3.6832009722494783`*^9}, 3.683218996081359*^9, 
   3.683227195001505*^9, 3.685105959516412*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dvmadt\[Delta]z", "[", "ei_", "]"}], ":=", 
   RowBox[{
    RowBox[{"dvmadt1\[Delta]z", "[", "ei", "]"}], "+", 
    RowBox[{"dvmadt2\[Delta]z", "[", "ei", "]"}], "+", 
    RowBox[{"dvmadt3\[Delta]z", "[", "ei", "]"}], "+", 
    RowBox[{"dvmadt4\[Delta]z", "[", "ei", "]"}], "+", 
    RowBox[{"dvmadt5\[Delta]z", "[", "ei", "]"}], "+", 
    RowBox[{"dvmadt6\[Delta]z", "[", "ei", "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.683199311291834*^9, 3.683199335664133*^9}, {
  3.683200008076005*^9, 3.6832000770423727`*^9}, {3.683200190847007*^9, 
  3.683200245334814*^9}, {3.683200978950598*^9, 3.6832009932869453`*^9}, {
  3.6851059630188303`*^9, 3.685105975094479*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 "d",
 Cell[BoxData[
  FormBox[
   RowBox[{"v", "[", 
    RowBox[{
     SubscriptBox["e", "i"], ",", "a", ",", "a"}], "]"}], TraditionalForm]]],
 "/d\[Delta]z"
}], "Subsection",
 CellChangeTimes->{{3.6832132294642563`*^9, 3.683213249847337*^9}, {
  3.685205410218521*^9, 3.685205417657596*^9}}],

Cell["Environmental change", "Text",
 CellChangeTimes->{{3.6832132582712584`*^9, 3.683213260558799*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvaadt1\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Exp", "[", 
    RowBox[{"q", 
     FractionBox["1", "2"], 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"zs", "[", 
        RowBox[{"ei", ",", "a"}], "]"}], "+", 
       RowBox[{"\[Delta]zs", "[", 
        RowBox[{"ei", ",", "a"}], "]"}], "+", 
       RowBox[{"zs", "[", 
        RowBox[{"ei", ",", "a"}], "]"}], "+", 
       RowBox[{
        RowBox[{"raa", "[", "ei", "]"}], 
        RowBox[{"\[Delta]zs", "[", 
         RowBox[{"ei", ",", "a"}], "]"}]}]}], ")"}]}], "]"}], 
   RowBox[{"s", "[", "ei", "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{
       RowBox[{"3", "-", "ei"}], ",", "m", ",", "m"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.6832132616833057`*^9, 3.683213303386718*^9}, {
   3.6832177969847403`*^9, 3.6832178203628473`*^9}, 3.6832271931226387`*^9, {
   3.685106052132043*^9, 3.685106114524485*^9}, {3.685193243950995*^9, 
   3.685193246222458*^9}}],

Cell["Focal adapted dies, replaced by her own maladapted offspring", "Text",
 CellChangeTimes->{{3.6832132809258957`*^9, 3.683213296676857*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvaadt2\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"ei", ",", "a"}], "]"}], "+", 
     RowBox[{"\[Delta]zs", "[", 
      RowBox[{"ei", ",", "a"}], "]"}]}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{"1", "-", 
      RowBox[{"p", "[", 
       RowBox[{"phen", "[", 
        RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ",", 
     RowBox[{"p", "[", 
      RowBox[{"phen", "[", 
       RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "a"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.6832133014352007`*^9, 3.683213357824053*^9}, {
   3.683213401879324*^9, 3.683213403911558*^9}, {3.683213534705427*^9, 
   3.683213542979003*^9}, 3.683227192084193*^9, 3.685106054455937*^9, 
   3.685106123869409*^9}],

Cell["Focal adapted dies, replaced by nonfocal offspring", "Text",
 CellChangeTimes->{{3.68321336010565*^9, 3.683213366625884*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvaadt3\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"ei", ",", "a"}], "]"}], "+", 
     RowBox[{"\[Delta]zs", "[", 
      RowBox[{"ei", ",", "a"}], "]"}]}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", 
     RowBox[{
      FractionBox["1", "2"], 
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}]}]}], ")"}], 
   RowBox[{"(", 
    RowBox[{"-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.683213367584035*^9, 3.683213416711776*^9}, 
   3.683227190646262*^9, 3.685106056397469*^9, 3.685106127131112*^9}],

Cell["Nonfocal adapted dies, replaced by focal offspring", "Text",
 CellChangeTimes->{{3.683213418678454*^9, 3.68321342567815*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvaadt4\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"ei", ",", "a"}], "]"}], "+", 
     RowBox[{
      RowBox[{"raa", "[", "ei", "]"}], 
      RowBox[{"\[Delta]zs", "[", 
       RowBox[{"ei", ",", "a"}], "]"}]}]}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"p", "[", 
        RowBox[{"phen", "[", 
         RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
       RowBox[{"v", "[", 
        RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "a"}], "]"}], "+", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], ")"}]}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
       RowBox[{"v", "[", 
        RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], "+", 
      RowBox[{
       RowBox[{"p", "[", 
        RowBox[{"phen", "[", 
         RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "a"}], "]"}], "+", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], ")"}]}]}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.6832134270223827`*^9, 3.683213583469589*^9}, 
   3.683227187898449*^9, 3.685106058393654*^9, {3.6851061333958883`*^9, 
   3.685106137359034*^9}}],

Cell["\<\
Nonfocal adapted dies, replaced by nonfocal maladapted offspring\
\>", "Text",
 CellChangeTimes->{{3.6832135876560698`*^9, 3.683213597054346*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvaadt5\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "a", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"ei", ",", "a"}], "]"}], "+", 
     RowBox[{
      RowBox[{"raa", "[", "ei", "]"}], 
      RowBox[{"\[Delta]zs", "[", 
       RowBox[{"ei", ",", "a"}], "]"}]}]}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ",", 
        RowBox[{"p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], "]"}]}], "+", 
     RowBox[{"d", "*", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"ex", ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
         RowBox[{"(", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ei", "\[Equal]", "1"}], ",", 
            RowBox[{"1", "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", "1", 
             "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}]}], "]"}], 
          ")"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"statex", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a", ",", "a"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"a", ",", "m"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], "]"}]}]}], 
    ")"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "a"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.683213598227193*^9, 3.6832137177*^9}, 
   3.6832190029681473`*^9, 3.683220676813352*^9, {3.683224361949139*^9, 
   3.683224364332396*^9}, 3.68322718657099*^9, {3.685005433142889*^9, 
   3.685005439598843*^9}, 3.6851060606351757`*^9, 3.685106155825282*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvaadt6\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   FractionBox["1", "2"], "d", " ", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"ex", ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "a"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "a"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}]}], 
       ")"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"statex", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "a"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"a", ",", "m"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.683213719921734*^9, 3.683213773822291*^9}, 
   3.6832190057815733`*^9, 3.6832271841108418`*^9, 3.685106062965802*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dvaadt\[Delta]z", "[", "ei_", "]"}], ":=", 
   RowBox[{
    RowBox[{"dvaadt1\[Delta]z", "[", "ei", "]"}], "+", 
    RowBox[{"dvaadt2\[Delta]z", "[", "ei", "]"}], "+", 
    RowBox[{"dvaadt3\[Delta]z", "[", "ei", "]"}], "+", 
    RowBox[{"dvaadt4\[Delta]z", "[", "ei", "]"}], "+", 
    RowBox[{"dvaadt5\[Delta]z", "[", "ei", "]"}], "+", 
    RowBox[{"dvaadt6\[Delta]z", "[", "ei", "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.683213786759811*^9, 3.6832138193694963`*^9}, {
  3.6851061634742603`*^9, 3.685106193511704*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 "d",
 Cell[BoxData[
  FormBox[
   RowBox[{"v", "[", 
    RowBox[{
     SubscriptBox["e", "i"], ",", "m", ",", "m"}], "]"}], TraditionalForm]]],
 "/d\[Delta]z"
}], "Subsection",
 CellChangeTimes->{{3.6832144102492037`*^9, 3.683214425500306*^9}, {
  3.685205419008654*^9, 3.685205422162251*^9}}],

Cell["Environmental change", "Text",
 CellChangeTimes->{{3.6832177787163754`*^9, 3.683217781747661*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmmdt1\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Exp", "[", 
    RowBox[{"q", 
     FractionBox["1", "2"], 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"zs", "[", 
        RowBox[{"ei", ",", "m"}], "]"}], "+", 
       RowBox[{"\[Delta]zs", "[", 
        RowBox[{"ei", ",", "m"}], "]"}], "+", 
       RowBox[{"zs", "[", 
        RowBox[{"ei", ",", "m"}], "]"}], "+", 
       RowBox[{
        RowBox[{"rmm", "[", "ei", "]"}], 
        RowBox[{"\[Delta]zs", "[", 
         RowBox[{"ei", ",", "m"}], "]"}]}]}], ")"}]}], "]"}], 
   RowBox[{"s", "[", "ei", "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{
       RowBox[{"3", "-", "ei"}], ",", "a", ",", "a"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.683217782423493*^9, 3.683217791529729*^9}, {
   3.683217881336334*^9, 3.683217897056925*^9}, {3.6832271799072657`*^9, 
   3.683227182420065*^9}, 3.6832272429076*^9, {3.6851061968845654`*^9, 
   3.685106197710475*^9}, {3.685106258694045*^9, 3.68510627479255*^9}, {
   3.685193251727318*^9, 3.6851932546949663`*^9}}],

Cell["Focal dies, replaced by her own adapted offspring", "Text",
 CellChangeTimes->{{3.6832144383815317`*^9, 3.683214453429648*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmmdt2\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"ei", ",", "m"}], "]"}], "+", 
     RowBox[{"\[Delta]zs", "[", 
      RowBox[{"ei", ",", "m"}], "]"}]}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{"p", "[", 
      RowBox[{"phen", "[", 
       RowBox[{"ei", ",", "m"}], "]"}], "]"}], ",", 
     RowBox[{"1", "-", 
      RowBox[{"p", "[", 
       RowBox[{"phen", "[", 
        RowBox[{"ei", ",", "m"}], "]"}], "]"}]}]}], "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.683214430586694*^9, 3.6832144562819443`*^9}, {
   3.6832174226063623`*^9, 3.683217427491819*^9}, {3.683217776583317*^9, 
   3.683217776664213*^9}, {3.683217903779244*^9, 3.6832179482178926`*^9}, 
   3.6832271790872507`*^9, {3.685106200083531*^9, 3.6851062010572443`*^9}, 
   3.685106286417898*^9}],

Cell["Focal dies, replaced by nonfocal offspring", "Text",
 CellChangeTimes->{{3.6832179512898397`*^9, 3.683217958449692*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmmdt3\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"ei", ",", "m"}], "]"}], "+", 
     RowBox[{"\[Delta]zs", "[", 
      RowBox[{"ei", ",", "m"}], "]"}]}], "]"}], 
   RowBox[{"(", 
    RowBox[{"1", "-", 
     RowBox[{
      FractionBox["1", "2"], 
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}]}]}], ")"}], 
   RowBox[{"(", 
    RowBox[{"-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.683217959347053*^9, 3.683217984452059*^9}, 
   3.6832271776208477`*^9, {3.685106203146194*^9, 3.685106204008687*^9}, 
   3.685106289239203*^9}],

Cell["Nonfocal dies, replaced by focal offspring ", "Text",
 CellChangeTimes->{{3.683217987151927*^9, 3.683217991370469*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmmdt4\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"ei", ",", "m"}], "]"}], "+", 
     RowBox[{
      RowBox[{"rmm", "[", "ei", "]"}], 
      RowBox[{"\[Delta]zs", "[", 
       RowBox[{"ei", ",", "m"}], "]"}]}]}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"p", "[", 
        RowBox[{"phen", "[", 
         RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "+", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "a"}], "]"}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], ")"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
       RowBox[{"v", "[", 
        RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "a", ",", "m"}], "]"}], "+", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "a"}], "]"}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], ")"}]}], "+", 
      RowBox[{
       RowBox[{"p", "[", 
        RowBox[{"phen", "[", 
         RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
       RowBox[{"v", "[", 
        RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}]}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.683217993904415*^9, 3.6832180563791037`*^9}, {
  3.683218095013372*^9, 3.683218143285419*^9}, {3.685106206498041*^9, 
  3.6851062074328814`*^9}, {3.685106293553238*^9, 3.685106305592475*^9}}],

Cell["\<\
Nonfocal maladapted dies, replaced by nonfocal adapted offspring\
\>", "Text",
 CellChangeTimes->{{3.683218151473761*^9, 3.683218170208146*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmmdt5\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{"mu", "[", "m", "]"}], 
   RowBox[{"nu", "[", 
    RowBox[{
     RowBox[{"zs", "[", 
      RowBox[{"ei", ",", "m"}], "]"}], "+", 
     RowBox[{
      RowBox[{"rmm", "[", "ei", "]"}], 
      RowBox[{"\[Delta]zs", "[", 
       RowBox[{"ei", ",", "m"}], "]"}]}]}], "]"}], 
   FractionBox["1", "2"], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{"p", "[", 
         RowBox[{"phen", "[", 
          RowBox[{"ei", ",", "m"}], "]"}], "]"}], ",", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", 
          RowBox[{"phen", "[", 
           RowBox[{"ei", ",", "m"}], "]"}], "]"}]}]}], "]"}]}], "+", 
     RowBox[{"d", " ", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"ex", ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"statex", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
         RowBox[{"(", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ei", "\[Equal]", "1"}], ",", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ",", 
            RowBox[{"1", "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "+", "1", 
             "-", 
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ex", ",", 
                RowBox[{"statex", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}]}], "]"}], 
          ")"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"statex", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a", ",", "a"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"a", ",", "m"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], "]"}]}]}], 
    ")"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "a"}], "]"}], "-", 
     RowBox[{"v", "[", 
      RowBox[{"ei", ",", "m", ",", "m"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.683218146483746*^9, 3.683218227381504*^9}, 
   3.683219026276667*^9, 3.683220671511565*^9, 3.683227168476479*^9, {
   3.685106220917781*^9, 3.685106222677141*^9}, 3.685106314942418*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmmdt6\[Delta]z", "[", "ei_", "]"}], ":=", 
  RowBox[{
   FractionBox["1", "2"], "d", " ", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"ex", ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"statex", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}], "+", 
        RowBox[{
         RowBox[{"mu", "[", 
          RowBox[{"statex", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], 
         RowBox[{"nu", "[", 
          RowBox[{"zs", "[", 
           RowBox[{"ex", ",", 
            RowBox[{"statex", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ex", "\[Equal]", "1"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"1", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"phen", "[", 
               RowBox[{"ei", ",", "m"}], "]"}], "]"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "m", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"p", "[", 
                RowBox[{"phen", "[", 
                 RowBox[{"ei", ",", "m"}], "]"}], "]"}]}], ")"}], 
             RowBox[{"v", "[", 
              RowBox[{"2", ",", "a", ",", 
               RowBox[{"statex", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}]}], "]"}]}]}], 
       ")"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"statex", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "a"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"a", ",", "m"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "m"}], "}"}]}], "}"}]}], "}"}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.683213719921734*^9, 3.683213773822291*^9}, {
   3.6832182359567204`*^9, 3.683218271839697*^9}, 3.6832190294842663`*^9, 
   3.6832271744595623`*^9, {3.685106225065007*^9, 3.6851062263339233`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dvmmdt\[Delta]z", "[", "ei_", "]"}], ":=", 
   RowBox[{
    RowBox[{"dvmmdt1\[Delta]z", "[", "ei", "]"}], "+", 
    RowBox[{"dvmmdt2\[Delta]z", "[", "ei", "]"}], "+", 
    RowBox[{"dvmmdt3\[Delta]z", "[", "ei", "]"}], "+", 
    RowBox[{"dvmmdt4\[Delta]z", "[", "ei", "]"}], "+", 
    RowBox[{"dvmmdt5\[Delta]z", "[", "ei", "]"}], "+", 
    RowBox[{"dvmmdt6\[Delta]z", "[", "ei", "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.683218278288801*^9, 3.683218309191255*^9}, {
  3.6832185168692217`*^9, 3.68321852724966*^9}, {3.683227169531499*^9, 
  3.6832271732217007`*^9}, {3.685106228712351*^9, 3.68510624517472*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"selgrad\[Delta]z", "[", "x_", "]"}], ":=", 
  RowBox[{"D", "[", 
   RowBox[{
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"2", " ", 
        RowBox[{"f", "[", 
         RowBox[{"ei", ",", "a", ",", "a"}], "]"}], 
        RowBox[{"dvaadt\[Delta]z", "[", "ei", "]"}]}], "+", 
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{"ei", ",", "a", ",", "m"}], "]"}], 
        RowBox[{"dvamdt\[Delta]z", "[", "ei", "]"}]}], "+", 
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{"ei", ",", "a", ",", "m"}], "]"}], 
        RowBox[{"dvmadt\[Delta]z", "[", "ei", "]"}]}], "+", 
       RowBox[{"2", 
        RowBox[{"f", "[", 
         RowBox[{"ei", ",", "m", ",", "m"}], "]"}], 
        RowBox[{"dvmmdt\[Delta]z", "[", "ei", "]"}]}]}], ",", 
      RowBox[{"{", 
       RowBox[{"ei", ",", "1", ",", "2"}], "}"}]}], "]"}], ",", "x"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.6851047139388113`*^9, 3.685104768776784*^9}, {
  3.6851048310097923`*^9, 3.68510486210417*^9}, {3.685105060331935*^9, 
  3.6851050710027227`*^9}, {3.685106481422261*^9, 3.685106499899653*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dze1", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"selgrad\[Delta]z", "[", 
      RowBox[{"\[Delta]zs", "[", 
       RowBox[{"1", ",", "m"}], "]"}], "]"}], "+", 
     RowBox[{"selgrad\[Delta]z", "[", 
      RowBox[{"\[Delta]zs", "[", 
       RowBox[{"1", ",", "a"}], "]"}], "]"}]}], "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"\[Delta]zs", "[", 
        RowBox[{"1", ",", "m"}], "]"}], "\[Rule]", "0"}], ",", 
      RowBox[{
       RowBox[{"\[Delta]zs", "[", 
        RowBox[{"1", ",", "a"}], "]"}], "\[Rule]", "0"}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dze2", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"selgrad\[Delta]z", "[", 
      RowBox[{"\[Delta]zs", "[", 
       RowBox[{"2", ",", "m"}], "]"}], "]"}], "+", 
     RowBox[{"selgrad\[Delta]z", "[", 
      RowBox[{"\[Delta]zs", "[", 
       RowBox[{"2", ",", "a"}], "]"}], "]"}]}], "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"\[Delta]zs", "[", 
        RowBox[{"2", ",", "m"}], "]"}], "\[Rule]", "0"}], ",", 
      RowBox[{
       RowBox[{"\[Delta]zs", "[", 
        RowBox[{"2", ",", "a"}], "]"}], "\[Rule]", "0"}]}], "}"}]}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.68510669417272*^9, 3.6851068155406017`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Export selection gradients to C\
\>", "Subsection",
 CellChangeTimes->{{3.6852052550872498`*^9, 3.6852052596237097`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"strselgrads", "=", "\"\<\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"strselgrads", "=", 
   RowBox[{
   "strselgrads", "<>", "\"\<double p1tplus1 = bound01(p1 + eul * (\>\"", "<>", 
    RowBox[{"tc", "[", 
     RowBox[{"selgrad", "[", 
      RowBox[{"\[Delta]p", "[", "1", "]"}], "]"}], "]"}], "<>", 
    "\"\<));\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"strselgrads", "=", 
   RowBox[{
   "strselgrads", "<>", "\"\<double p2tplus1 = bound01(p2 + eul * (\>\"", "<>", 
    RowBox[{"tc", "[", 
     RowBox[{"selgrad", "[", 
      RowBox[{"\[Delta]p", "[", "2", "]"}], "]"}], "]"}], "<>", 
    "\"\<));\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"strselgrads", "=", 
   RowBox[{"strselgrads", "<>", "\"\<double z1tplus1 = z1 + eul * (\>\"", "<>", 
    RowBox[{"tc", "[", "dze1", "]"}], "<>", "\"\<);\\n\\n\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"strselgrads", "=", 
   RowBox[{"strselgrads", "<>", "\"\<double z2tplus1 = z2 + eul * (\>\"", "<>", 
    RowBox[{"tc", "[", "dze2", "]"}], "<>", "\"\<);\\n\\n\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"strselgrads", "=", 
   RowBox[{
   "strselgrads", "<>", "\"\<gsl_vector_set(f, 0, p1tplus1);\\n\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"strselgrads", "=", 
   RowBox[{
   "strselgrads", "<>", "\"\<gsl_vector_set(f, 1, p2tplus1);\\n\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"strselgrads", "=", 
   RowBox[{
   "strselgrads", "<>", "\"\<gsl_vector_set(f, 2, z1tplus1);\\n\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"strselgrads", "=", 
   RowBox[{
   "strselgrads", "<>", "\"\<gsl_vector_set(f, 3, z2tplus1);\\n\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
    RowBox[{"cdir", "<>", "\"\<selgrad.txt\>\""}], ",", "strselgrads"}], 
   "]"}], ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.6852052797178383`*^9, 3.685205381692547*^9}, {
  3.685205443115889*^9, 3.685205585962865*^9}, {3.685205666605548*^9, 
  3.685205716667718*^9}}]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1449, 1028},
WindowMargins->{{18, Automatic}, {Automatic, -10}},
PrivateNotebookOptions->{"VersionedStylesheet"->{"Default.nb"[8.] -> False}},
Magnification->1.25,
FrontEndVersion->"9.0 for Linux x86 (64-bit) (January 25, 2013)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[567, 22, 133, 1, 183, "Title"],
Cell[CellGroupData[{
Cell[725, 27, 150, 2, 98, "Section"],
Cell[878, 31, 139, 2, 38, "Input"],
Cell[1020, 35, 239, 4, 37, "Text"],
Cell[1262, 41, 469, 10, 40, "Input"],
Cell[1734, 53, 187, 6, 37, "Text"],
Cell[1924, 61, 265, 6, 38, "Input"],
Cell[2192, 69, 112, 1, 38, "Text"],
Cell[2307, 72, 240, 7, 38, "Input"],
Cell[2550, 81, 101, 1, 37, "Text"],
Cell[CellGroupData[{
Cell[2676, 86, 677, 20, 38, "Input"],
Cell[3356, 108, 629, 19, 38, "Output"]
}, Open  ]],
Cell[4000, 130, 126, 3, 38, "Text"],
Cell[4129, 135, 6583, 152, 889, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[10749, 292, 151, 2, 98, "Section"],
Cell[10903, 296, 203, 4, 37, "Text"],
Cell[CellGroupData[{
Cell[11131, 304, 103, 1, 54, "Subsection"],
Cell[CellGroupData[{
Cell[11259, 309, 798, 24, 38, "Input"],
Cell[12060, 335, 2214, 38, 38, "Output"]
}, Open  ]],
Cell[14289, 376, 246, 7, 39, "Text"],
Cell[14538, 385, 682, 21, 38, "Input"],
Cell[15223, 408, 653, 20, 63, "Text"],
Cell[15879, 430, 2940, 81, 171, "Input"],
Cell[CellGroupData[{
Cell[18844, 515, 371, 8, 38, "Input"],
Cell[19218, 525, 3406, 66, 56, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[22661, 596, 587, 16, 38, "Input"],
Cell[23251, 614, 2792, 48, 56, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[26080, 667, 1282, 31, 38, "Input"],
Cell[27365, 700, 3100, 51, 38, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[30514, 757, 171, 3, 54, "Subsection"],
Cell[30688, 762, 102, 1, 37, "Text"],
Cell[30793, 765, 914, 26, 38, "Input"],
Cell[31710, 793, 214, 4, 37, "Text"],
Cell[31927, 799, 531, 14, 38, "Input"],
Cell[32461, 815, 186, 2, 37, "Text"],
Cell[32650, 819, 631, 17, 38, "Input"],
Cell[33284, 838, 343, 8, 38, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[33664, 851, 214, 5, 43, "Subsection"],
Cell[33881, 858, 128, 2, 55, "Text"],
Cell[34012, 862, 1231, 36, 156, "Input"],
Cell[35246, 900, 210, 5, 55, "Text"],
Cell[35459, 907, 465, 13, 57, "Input"],
Cell[35927, 922, 214, 5, 55, "Text"],
Cell[36144, 929, 518, 15, 57, "Input"],
Cell[36665, 946, 349, 10, 55, "Text"],
Cell[37017, 958, 649, 17, 57, "Input"],
Cell[37669, 977, 214, 5, 55, "Text"],
Cell[37886, 984, 479, 14, 57, "Input"],
Cell[38368, 1000, 123, 2, 55, "Text"],
Cell[38494, 1004, 437, 11, 57, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[38968, 1020, 172, 3, 43, "Subsection"],
Cell[39143, 1025, 887, 25, 57, "Input"],
Cell[40033, 1052, 457, 13, 57, "Input"],
Cell[40493, 1067, 484, 14, 57, "Input"],
Cell[40980, 1083, 292, 7, 57, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[41309, 1095, 126, 1, 43, "Subsection"],
Cell[41438, 1098, 318, 11, 41, "Text"],
Cell[41759, 1111, 314, 8, 38, "Input"],
Cell[42076, 1121, 120, 1, 37, "Text"],
Cell[42199, 1124, 676, 19, 38, "Input"],
Cell[CellGroupData[{
Cell[42900, 1147, 99, 1, 38, "Input"],
Cell[43002, 1150, 681, 17, 38, "Output"]
}, Open  ]],
Cell[43698, 1170, 288, 5, 37, "Text"],
Cell[43989, 1177, 493, 13, 64, "Input"],
Cell[44485, 1192, 175, 2, 37, "Text"],
Cell[44663, 1196, 173, 4, 37, "Text"],
Cell[44839, 1202, 2439, 66, 114, "Input"],
Cell[47281, 1270, 3106, 86, 114, "Input"],
Cell[50390, 1358, 3110, 86, 114, "Input"],
Cell[CellGroupData[{
Cell[53525, 1448, 768, 18, 38, "Input"],
Cell[54296, 1468, 2919, 56, 64, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[57252, 1529, 762, 18, 38, "Input"],
Cell[58017, 1549, 2932, 56, 64, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[60998, 1611, 231, 5, 55, "Subsection"],
Cell[CellGroupData[{
Cell[61254, 1620, 197, 4, 38, "Input"],
Cell[61454, 1626, 626, 16, 38, "Output"]
}, Open  ]],
Cell[62095, 1645, 1633, 46, 89, "Input"],
Cell[63731, 1693, 286, 7, 38, "Input"],
Cell[64020, 1702, 328, 8, 38, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[64397, 1716, 106, 1, 98, "Section"],
Cell[64506, 1719, 642, 19, 38, "Input"],
Cell[65151, 1740, 720, 21, 64, "Input"],
Cell[CellGroupData[{
Cell[65896, 1765, 368, 9, 87, "Subsection"],
Cell[66267, 1776, 105, 1, 55, "Text"],
Cell[66375, 1779, 780, 23, 86, "Input"],
Cell[67158, 1804, 192, 2, 55, "Text"],
Cell[67353, 1808, 1005, 29, 86, "Input"],
Cell[68361, 1839, 131, 1, 55, "Text"],
Cell[68495, 1842, 633, 19, 86, "Input"],
Cell[69131, 1863, 134, 1, 55, "Text"],
Cell[69268, 1866, 1566, 47, 165, "Input"],
Cell[70837, 1915, 230, 5, 55, "Text"],
Cell[71070, 1922, 3053, 85, 415, "Input"],
Cell[74126, 2009, 160, 3, 55, "Text"],
Cell[74289, 2014, 5072, 135, 428, "Input"],
Cell[79364, 2151, 556, 13, 57, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[79957, 2169, 418, 10, 76, "Subsection"],
Cell[80378, 2181, 105, 1, 55, "Text"],
Cell[80486, 2184, 826, 23, 86, "Input"],
Cell[81315, 2209, 240, 3, 55, "Text"],
Cell[81558, 2214, 1131, 31, 86, "Input"],
Cell[82692, 2247, 131, 1, 55, "Text"],
Cell[82826, 2250, 682, 20, 86, "Input"],
Cell[83511, 2272, 134, 1, 55, "Text"],
Cell[83648, 2275, 1663, 48, 203, "Input"],
Cell[85314, 2325, 262, 5, 55, "Text"],
Cell[85579, 2332, 3154, 86, 415, "Input"],
Cell[88736, 2420, 160, 3, 55, "Text"],
Cell[88899, 2425, 5073, 135, 428, "Input"],
Cell[93975, 2562, 604, 13, 57, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[94616, 2580, 343, 9, 76, "Subsection"],
Cell[94962, 2591, 104, 1, 55, "Text"],
Cell[95069, 2594, 668, 18, 57, "Input"],
Cell[95740, 2614, 144, 1, 55, "Text"],
Cell[95887, 2617, 1008, 29, 86, "Input"],
Cell[96898, 2648, 131, 1, 55, "Text"],
Cell[97032, 2651, 587, 19, 86, "Input"],
Cell[97622, 2672, 131, 1, 55, "Text"],
Cell[97756, 2675, 1918, 58, 203, "Input"],
Cell[99677, 2735, 156, 3, 55, "Text"],
Cell[99836, 2740, 2990, 84, 316, "Input"],
Cell[102829, 2826, 4806, 131, 428, "Input"],
Cell[107638, 2959, 458, 11, 57, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[108133, 2975, 233, 6, 45, "Subsection"],
Cell[108369, 2983, 104, 1, 55, "Text"],
Cell[108476, 2986, 708, 19, 57, "Input"],
Cell[109187, 3007, 133, 1, 55, "Text"],
Cell[109323, 3010, 1064, 30, 86, "Input"],
Cell[110390, 3042, 126, 1, 55, "Text"],
Cell[110519, 3045, 589, 19, 86, "Input"],
Cell[111111, 3066, 125, 1, 55, "Text"],
Cell[111239, 3069, 1936, 57, 165, "Input"],
Cell[113178, 3128, 154, 3, 55, "Text"],
Cell[113335, 3133, 2894, 82, 316, "Input"],
Cell[116232, 3217, 4858, 132, 428, "Input"],
Cell[121093, 3351, 557, 13, 57, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[121687, 3369, 124, 1, 43, "Subsection"],
Cell[121814, 3372, 691, 20, 38, "Input"],
Cell[122508, 3394, 1135, 32, 63, "Input"],
Cell[CellGroupData[{
Cell[123668, 3430, 103, 1, 38, "Input"],
Cell[123774, 3433, 2809, 64, 100, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[126620, 3502, 1050, 30, 114, "Input"],
Cell[127673, 3534, 2412, 49, 38, "Output"]
}, Open  ]],
Cell[130100, 3586, 2290, 63, 89, "Input"],
Cell[132393, 3651, 2390, 65, 114, "Input"],
Cell[134786, 3718, 2537, 67, 114, "Input"],
Cell[CellGroupData[{
Cell[137348, 3789, 533, 15, 38, "Input"],
Cell[137884, 3806, 1669, 26, 38, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[139590, 3837, 1714, 39, 64, "Input"],
Cell[141307, 3878, 3199, 64, 64, "Output"],
Cell[144509, 3944, 3201, 64, 64, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[147759, 4014, 236, 5, 55, "Subsection"],
Cell[147998, 4021, 1376, 35, 89, "Input"],
Cell[149377, 4058, 391, 13, 39, "Text"],
Cell[149771, 4073, 791, 21, 38, "Input"],
Cell[150565, 4096, 423, 9, 38, "Input"],
Cell[150991, 4107, 370, 8, 38, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[151410, 4121, 98, 1, 98, "Section"],
Cell[CellGroupData[{
Cell[151533, 4126, 150, 2, 54, "Subsection"],
Cell[151686, 4130, 104, 1, 55, "Text"],
Cell[151793, 4133, 1126, 32, 96, "Input"],
Cell[152922, 4167, 212, 4, 55, "Text"],
Cell[153137, 4173, 1424, 38, 127, "Input"],
Cell[154564, 4213, 211, 4, 55, "Text"],
Cell[154778, 4219, 1610, 49, 166, "Input"],
Cell[156391, 4270, 517, 13, 92, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[156945, 4288, 164, 3, 43, "Subsection"],
Cell[157112, 4293, 104, 1, 55, "Text"],
Cell[157219, 4296, 1487, 45, 156, "Input"],
Cell[158709, 4343, 210, 4, 55, "Text"],
Cell[158922, 4349, 1377, 38, 127, "Input"],
Cell[160302, 4389, 208, 4, 55, "Text"],
Cell[160513, 4395, 1260, 37, 127, "Input"],
Cell[161776, 4434, 162, 3, 55, "Text"],
Cell[161941, 4439, 1564, 49, 166, "Input"],
Cell[163508, 4490, 204, 4, 55, "Text"],
Cell[163715, 4496, 1516, 48, 166, "Input"],
Cell[165234, 4546, 711, 17, 92, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[165982, 4568, 145, 1, 43, "Subsection"],
Cell[166130, 4571, 103, 1, 37, "Text"],
Cell[166236, 4574, 1079, 31, 64, "Input"],
Cell[167318, 4607, 163, 3, 37, "Text"],
Cell[167484, 4612, 1580, 47, 92, "Input"],
Cell[169067, 4661, 165, 3, 37, "Text"],
Cell[169235, 4666, 1305, 38, 92, "Input"],
Cell[170543, 4706, 568, 14, 67, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[171148, 4725, 107, 1, 54, "Subsection"],
Cell[171258, 4728, 909, 23, 38, "Input"],
Cell[172170, 4753, 2957, 84, 139, "Input"],
Cell[CellGroupData[{
Cell[175152, 4841, 575, 16, 38, "Input"],
Cell[175730, 4859, 1116, 23, 38, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[176895, 4888, 275, 5, 55, "Subsection"],
Cell[177173, 4895, 1097, 30, 64, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[178307, 4930, 231, 5, 55, "Subsection"],
Cell[178541, 4937, 602, 16, 38, "Input"],
Cell[179146, 4955, 1633, 46, 89, "Input"],
Cell[180782, 5003, 286, 7, 38, "Input"],
Cell[181071, 5012, 328, 8, 38, "Input"],
Cell[181402, 5022, 3829, 95, 414, "Input"],
Cell[185234, 5119, 397, 9, 38, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[185680, 5134, 161, 2, 98, "Section"],
Cell[185844, 5138, 642, 19, 38, "Input"],
Cell[186489, 5159, 720, 21, 64, "Input"],
Cell[CellGroupData[{
Cell[187234, 5184, 365, 9, 56, "Subsection"],
Cell[187602, 5195, 105, 1, 55, "Text"],
Cell[187710, 5198, 834, 23, 86, "Input"],
Cell[188547, 5223, 192, 2, 55, "Text"],
Cell[188742, 5227, 1407, 40, 166, "Input"],
Cell[190152, 5269, 131, 1, 55, "Text"],
Cell[190286, 5272, 692, 20, 86, "Input"],
Cell[190981, 5294, 134, 1, 55, "Text"],
Cell[191118, 5297, 2056, 59, 203, "Input"],
Cell[193177, 5358, 230, 5, 55, "Text"],
Cell[193410, 5365, 3673, 101, 415, "Input"],
Cell[197086, 5468, 160, 3, 55, "Text"],
Cell[197249, 5473, 6882, 176, 578, "Input"],
Cell[204134, 5651, 665, 13, 57, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[204836, 5669, 418, 11, 45, "Subsection"],
Cell[205257, 5682, 105, 1, 55, "Text"],
Cell[205365, 5685, 888, 24, 86, "Input"],
Cell[206256, 5711, 240, 3, 55, "Text"],
Cell[206499, 5716, 1441, 38, 166, "Input"],
Cell[207943, 5756, 131, 1, 55, "Text"],
Cell[208077, 5759, 740, 21, 86, "Input"],
Cell[208820, 5782, 134, 1, 55, "Text"],
Cell[208957, 5785, 2101, 59, 203, "Input"],
Cell[211061, 5846, 262, 5, 55, "Text"],
Cell[211326, 5853, 3818, 103, 415, "Input"],
Cell[215147, 5958, 160, 3, 55, "Text"],
Cell[215310, 5963, 6834, 175, 578, "Input"],
Cell[222147, 6140, 720, 14, 57, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[222904, 6159, 317, 11, 45, "Subsection"],
Cell[223224, 6172, 104, 1, 55, "Text"],
Cell[223331, 6175, 725, 19, 57, "Input"],
Cell[224059, 6196, 144, 1, 55, "Text"],
Cell[224206, 6199, 1397, 39, 166, "Input"],
Cell[225606, 6240, 131, 1, 55, "Text"],
Cell[225740, 6243, 620, 19, 86, "Input"],
Cell[226363, 6264, 131, 1, 55, "Text"],
Cell[226497, 6267, 2730, 79, 278, "Input"],
Cell[229230, 6348, 156, 3, 55, "Text"],
Cell[229389, 6353, 3591, 100, 316, "Input"],
Cell[232983, 6455, 6591, 172, 578, "Input"],
Cell[239577, 6629, 592, 12, 57, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[240206, 6646, 317, 11, 45, "Subsection"],
Cell[240526, 6659, 104, 1, 37, "Text"],
Cell[240633, 6662, 763, 19, 38, "Input"],
Cell[241399, 6683, 133, 1, 37, "Text"],
Cell[241535, 6686, 1514, 41, 118, "Input"],
Cell[243052, 6729, 126, 1, 37, "Text"],
Cell[243181, 6732, 644, 19, 63, "Input"],
Cell[243828, 6753, 125, 1, 37, "Text"],
Cell[243956, 6756, 2776, 78, 193, "Input"],
Cell[246735, 6836, 154, 3, 37, "Text"],
Cell[246892, 6841, 3570, 99, 243, "Input"],
Cell[250465, 6942, 6669, 173, 343, "Input"],
Cell[257137, 7117, 668, 13, 38, "Input"],
Cell[257808, 7132, 1084, 29, 64, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[258941, 7167, 163, 2, 98, "Section"],
Cell[259107, 7171, 642, 19, 38, "Input"],
Cell[259752, 7192, 720, 21, 64, "Input"],
Cell[CellGroupData[{
Cell[260497, 7217, 349, 10, 56, "Subsection"],
Cell[260849, 7229, 105, 1, 55, "Text"],
Cell[260957, 7232, 1109, 30, 86, "Input"],
Cell[262069, 7264, 192, 2, 55, "Text"],
Cell[262264, 7268, 1207, 33, 127, "Input"],
Cell[263474, 7303, 131, 1, 55, "Text"],
Cell[263608, 7306, 787, 23, 86, "Input"],
Cell[264398, 7331, 134, 1, 55, "Text"],
Cell[264535, 7334, 1860, 54, 165, "Input"],
Cell[266398, 7390, 230, 5, 55, "Text"],
Cell[266631, 7397, 3298, 91, 377, "Input"],
Cell[269932, 7490, 160, 3, 55, "Text"],
Cell[270095, 7495, 5103, 135, 428, "Input"],
Cell[275201, 7632, 667, 13, 57, "Input"],
Cell[CellGroupData[{
Cell[275893, 7649, 250, 6, 57, "Input"],
Cell[276146, 7657, 2128, 65, 70, "Output"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[278323, 7728, 371, 10, 45, "Subsection"],
Cell[278697, 7740, 105, 1, 55, "Text"],
Cell[278805, 7743, 1138, 30, 86, "Input"],
Cell[279946, 7775, 240, 3, 55, "Text"],
Cell[280189, 7780, 1308, 35, 127, "Input"],
Cell[281500, 7817, 131, 1, 55, "Text"],
Cell[281634, 7820, 834, 24, 86, "Input"],
Cell[282471, 7846, 134, 1, 55, "Text"],
Cell[282608, 7849, 1898, 54, 165, "Input"],
Cell[284509, 7905, 262, 5, 55, "Text"],
Cell[284774, 7912, 3366, 92, 377, "Input"],
Cell[288143, 8006, 160, 3, 55, "Text"],
Cell[288306, 8011, 5104, 135, 428, "Input"],
Cell[293413, 8148, 718, 14, 57, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[294168, 8167, 310, 10, 45, "Subsection"],
Cell[294481, 8179, 104, 1, 55, "Text"],
Cell[294588, 8182, 1096, 30, 86, "Input"],
Cell[295687, 8214, 144, 1, 55, "Text"],
Cell[295834, 8217, 1160, 33, 127, "Input"],
Cell[296997, 8252, 131, 1, 55, "Text"],
Cell[297131, 8255, 735, 22, 86, "Input"],
Cell[297869, 8279, 131, 1, 55, "Text"],
Cell[298003, 8282, 2154, 64, 165, "Input"],
Cell[300160, 8348, 156, 3, 55, "Text"],
Cell[300319, 8353, 3198, 89, 277, "Input"],
Cell[303520, 8444, 4837, 131, 428, "Input"],
Cell[308360, 8577, 572, 12, 57, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[308969, 8594, 310, 10, 45, "Subsection"],
Cell[309282, 8606, 104, 1, 37, "Text"],
Cell[309389, 8609, 1187, 31, 63, "Input"],
Cell[310579, 8642, 133, 1, 37, "Text"],
Cell[310715, 8645, 1242, 34, 92, "Input"],
Cell[311960, 8681, 126, 1, 37, "Text"],
Cell[312089, 8684, 765, 23, 63, "Input"],
Cell[312857, 8709, 125, 1, 37, "Text"],
Cell[312985, 8712, 2195, 63, 117, "Input"],
Cell[315183, 8777, 154, 3, 37, "Text"],
Cell[315340, 8782, 3128, 88, 217, "Input"],
Cell[318471, 8872, 4915, 132, 293, "Input"],
Cell[323389, 9006, 665, 13, 38, "Input"],
Cell[324057, 9021, 1139, 29, 64, "Input"],
Cell[325199, 9052, 1294, 39, 64, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[326530, 9096, 131, 3, 55, "Subsection"],
Cell[326664, 9101, 2156, 56, 289, "Input"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
